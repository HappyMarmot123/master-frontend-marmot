# 상태 (State)

## 개요

상태(State) 패턴은 **객체의 내부 상태에 따라 객체의 행동을 변경할 수 있게 하는** 행동 디자인 패턴입니다. 마치 한 객체가 마치 여러 클래스의 인스턴스인 것처럼 행동하게 만들죠.

객체의 상태에 따라 행동이 바뀌는복잡한 상태 변화를 구현할 때, `if-else` 구문 쓰지 않고 상태 객체로 분리하여 코드를 깔끔하게 만듭니다. 새로운 상태를 추가하거나 기존 상태의 행동을 변경할 때, 기존 코드를 수정하지 않고 새로운 상태 클래스를 추가하는 것만으로 가능합니다.

## ⭐ 프론트엔드 활용 아이디어 ⭐

- **진행 상태가 있는 UI 컴포넌트**: 파일 업로드, 결제 프로세스, 회원 가입
- **요청 상태**: loading/success/error 제어

## 백엔드/전체 활용 아이디어

- **승인 워크플로우**: 초안→검토→발행, 주문 상태 관리
- **주문 처리 시스템**

## React 예제 (회원가입 프로세스)

```javascript
// --- 구체 상태 컴포넌트들 (Concrete State Components) ---
// 각 상태(단계)에 해당하는 컴포넌트를 정의합니다.
const Step1PersonalInfo = ({ onNext, onPrev, formData, setFormData }) => (
  <div>
    <h2>1단계: 기본 정보</h2>
    <input
      type="text"
      placeholder="이름"
      value={formData.name || ""}
      onChange={(e) => setFormData({ ...formData, name: e.target.value })}
    />
    <div>
      <button onClick={onNext}>다음</button>
    </div>
  </div>
);

// --- 컨텍스트 (Context) 컴포넌트 ---
// 상태를 관리하고, 현재 상태에 해당하는 컴포넌트를 렌더링합니다.
const FormContext = () => {
  const [currentStep, setCurrentStep] = useState(0);
  const [formData, setFormData] = useState({});

  const steps = [
    Step1PersonalInfo,
    // ...스탭 컴포넌트들
  ];

  // 현재 상태에 해당하는 컴포넌트를 가져옵니다.
  const CurrentStepComponent = steps[currentStep];

  const handleNext = () => {
    if (currentStep < steps.length - 1) {
      setCurrentStep(currentStep + 1);
    }
  };

  const handlePrev = () => {
    if (currentStep > 0) {
      setCurrentStep(currentStep - 1);
    }
  };

  return (
    <div>
      <CurrentStepComponent
        onNext={handleNext}
        onPrev={handlePrev}
        formData={formData}
        setFormData={setFormData}
      />
    </div>
  );
};
```

## React 예제 (loading/success/error 제어)

```javascript
// 유휴(Idle) 상태: 데이터 요청 전의 초기 상태
const IdleState = ({ onFetchData }) => (
  <div className="flex flex-col items-center justify-center p-6 bg-gray-100 rounded-lg">
    <p className="text-gray-600 mb-4">버튼을 눌러 데이터를 불러오세요.</p>
    <button
      onClick={onFetchData}
      className="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-full hover:bg-indigo-700 transition shadow-lg"
    >
      데이터 가져오기
    </button>
  </div>
);

// 로딩(Loading) 상태: 데이터 요청 중
const LoadingState = () => (
  <p className="text-blue-700 mt-4 font-medium">데이터를 불러오는 중...</p>
);

// 성공(Success) 상태: 데이터 요청 성공
const SuccessState = () => (
  <h3 className="text-xl font-bold text-green-700 mb-2">
    ✅ 데이터 로드 성공!
  </h3>
);

// 오류(Error) 상태: 데이터 요청 실패
const ErrorState = () => (
  <h3 className="text-xl font-bold text-red-700 mb-2">❌ 데이터 로드 실패</h3>
);

// --- 컨텍스트 (Context) 컴포넌트 ---
const DataLoaderContext = () => {
  const [status, setStatus] = useState("idle");
  const [data, setData] = useState(null);

  const statusComponentMap = {
    idle: IdleState,
    loading: LoadingState,
    success: SuccessState,
    error: ErrorState,
  };

  const CurrentStatusComponent = statusComponentMap[status];

  const fetchData = () => {
    setStatus("loading");
    setTimeout(() => {
      const success = Math.random() > 0.5;
      if (success) {
        setData({
          message: "성공적으로 데이터를 불러왔습니다.",
          items: ["사과", "바나나", "딸기"],
        });
        setStatus("success");
      } else {
        setStatus("error");
      }
    }, 2000);
  };

  // 현재 상태에 따라 다른 컴포넌트를 렌더링합니다.
  // props를 전달하여 각 상태 컴포넌트가 독립적으로 작동하게 합니다.
  return (
    <CurrentStatusComponent
      onFetchData={fetchData}
      data={data}
      message="네트워크 오류가 발생했습니다."
    />
  );
};
```

## JavaScript 예제

```javascript
// 상태 인터페이스
class OrderState {
  handlePayment(order) {
    throw new Error("이 메서드는 구현되어야 합니다.");
  }
  handleCancel(order) {
    throw new Error("이 메서드는 구현되어야 합니다.");
  }
}

---

// 결제 대기 상태
class PendingPaymentState extends OrderState {
  handlePayment(order) {
    console.log("✅ 결제 처리 중... 다음 상태: 배송 준비 중");
    order.setState(new ReadyForShippingState());
  }
  handleCancel(order) {
    console.log("❌ 주문이 취소되었습니다.");
    order.setState(new CanceledState());
  }
}

// 배송 준비 중 상태
class ReadyForShippingState extends OrderState {
  handlePayment(order) {
    console.log("⚠️ 이미 결제가 완료되었습니다.");
  }
  handleCancel(order) {
    console.log("❌ 배송 준비 중인 주문이 취소되었습니다.");
    order.setState(new CanceledState());
  }
}

// 취소된 상태
class CanceledState extends OrderState {
  handlePayment(order) {
    console.log("⚠️ 이미 취소된 주문입니다.");
  }
  handleCancel(order) {
    console.log("⚠️ 이미 취소된 주문입니다.");
  }
}

---

// 컨텍스트: 주문 객체
class Order {
  constructor() {
    this.state = new PendingPaymentState(); // 초기 상태 설정
  }

  // 상태 변경 메서드
  setState(state) {
    this.state = state;
  }

  // 행동을 현재 상태 객체로 위임
  requestPayment() {
    this.state.handlePayment(this);
  }

  requestCancel() {
    this.state.handleCancel(this);
  }
}

---

const order = new Order();

// 1단계: 결제 요청 (현재 상태: PendingPaymentState)
console.log("--- 1. 결제 요청 ---");
order.requestPayment();
// 출력: ✅ 결제 처리 중... 다음 상태: 배송 준비 중

// 2단계: 다시 결제 요청 (현재 상태: ReadyForShippingState)
console.log("\n--- 2. 다시 결제 요청 ---");
order.requestPayment();
// 출력: ⚠️ 이미 결제가 완료되었습니다.

// 3단계: 취소 요청
console.log("\n--- 3. 취소 요청 ---");
order.requestCancel();
// 출력: ❌ 배송 준비 중인 주문이 취소되었습니다.

// 4단계: 취소된 주문 다시 취소 요청 (현재 상태: CanceledState)
console.log("\n--- 4. 다시 취소 요청 ---");
order.requestCancel();
// 출력: ⚠️ 이미 취소된 주문입니다.
```
