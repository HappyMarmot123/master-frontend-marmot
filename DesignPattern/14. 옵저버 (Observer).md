# 옵저버 (Observer)

## 개요

**한 객체(주제, Subject)의 상태가 변경될 때, 그 객체를 관찰하고 있는 모든 객체(옵저버, Observer)들에게 자동으로 알림을 보내는** 행동 디자인 패턴입니다. 이 패턴은 주로 객체 간의 **일대다(one-to-many) 의존성을 정의합니다.**

주제(Subject)와 옵저버(Observer)가 서로의 구체적인 구현을 알지 못하고도 소통할 수 있습니다. 주제는 자신이 알릴 옵저버 목록만 관리하며, 각 옵저버가 어떤 행동을 할지는 모릅니다. 주제의 상태가 변경되면 모든 옵저버가 자동으로 업데이트되어, 여러 객체의 상태를 효율적으로 동기화할 수 있습니다.

패턴의 핵심 구성 요소는 다음과 같습니다.

1. **주제(Subject)** : 상태를 가지고 있으며, 상태 변경 시 옵저버들에게 알림을 보냅니다. 옵저버를 추가(`attach`), 제거(`detach`)하고 알림(`notify`)을 보내는 메서드를 가집니다.
2. **옵저버(Observer)** : 주제의 상태 변경 알림을 받는 객체입니다. 주제로부터 알림을 받았을 때 수행할 작업(`update`)을 정의하는 인터페이스입니다.

## 프론트엔드 활용 아이디어

- **구독 시스템**: 뉴스 알림 등

## 백엔드/전체 활용 아이디어

- **로깅/모니터링**: 시스템 이벤트 추적
- **실시간 데이터**: WebSocket/SSE 스트림 구독

## 구현 팁

- 해지(unsubscribe) 전략을 명확히(스코프/라이프사이클)
- 통지 폭주 시 배치/디바운스 적용

## React 예제

```javascript
// --- 1. 주제 (Subject) 구현: NewsPublisher 클래스 ---
// 리액트 환경에 맞게 별도의 클래스를 만듭니다.
class NewsPublisher {
  constructor() {
    this.observers = [];
    this.latestNews = null;
  }

  attach(observer) {
    // 옵저버(구독자)를 등록
    if (!this.observers.includes(observer)) {
      this.observers.push(observer);
    }
  }

  detach(observer) {
    // 옵저버(구독자)를 제거
    this.observers = this.observers.filter((obs) => obs !== observer);
  }

  notify() {
    // 모든 옵저버에게 알림
    this.observers.forEach((observer) => observer(this.latestNews));
  }

  setNews(news) {
    // 뉴스 발행 및 상태 변경
    this.latestNews = news;
    this.notify();
  }
}

// --- 2. 컨텍스트를 활용한 구독 기능 ---
// 구독자(Observer) 컴포넌트들이 주제를 사용할 수 있도록 컨텍스트를 생성
const newsPublisher = new NewsPublisher();
const NewsContext = createContext();

const NewsProvider = ({ children }) => {
  return (
    <NewsContext.Provider value={newsPublisher}>
      {children}
    </NewsContext.Provider>
  );
};

// --- 3. 구독자(Observer) 구현: useObserver 훅 ---
// 옵저버를 등록하고 상태를 추적하는 커스텀 훅
const useNewsObserver = (onUpdate) => {
  const publisher = useContext(NewsContext);

  useEffect(() => {
    if (publisher) {
      publisher.attach(onUpdate);
      return () => {
        publisher.detach(onUpdate);
      };
    }
  }, [publisher, onUpdate]);
};

// --- 4. 구체 구독자 (Concrete Observer) 컴포넌트들 ---
const UserA = () => {
  const [latestNews, setLatestNews] = useState("");

  // useNewsObserver 훅을 사용하여 뉴스 업데이트를 구독
  useNewsObserver((news) => {
    setLatestNews(news);
    console.log(`[사용자 A] 새 뉴스 알림: "${news}"`);
  });
};

// --- 5. 구체 주제 (Concrete Subject) UI 컴포넌트 ---
const NewsPublisherUI = () => {
  const publisher = useContext(NewsContext);

  const handlePublish = () => {
    if (input.trim()) {
      publisher.setNews("속보, 마멋이 토스에 취업하다!!");
    }
  };

  handlePublish();
};
```
