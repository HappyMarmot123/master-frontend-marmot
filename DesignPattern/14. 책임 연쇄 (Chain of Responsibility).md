# 책임 연쇄 (Chain of Responsibility)

## 개요

책임 연쇄(Chain of Responsibility) 패턴은 **요청을 처리할 수 있는 핸들러 객체들의 체인(사슬)을 만들어, 요청이 그 체인을 따라 전달되게 하는** 행동 패턴입니다. 각 핸들러는 자신이 요청을 처리할 수 있는지 판단하고, 처리할 수 없다면 체인의 다음 핸들러로 요청을 넘깁니다.

이 패턴의 주요 목적은 다음과 같습니다.

- **요청과 핸들러의 분리** : 요청을 보낸 객체(클라이언트)는 어떤 핸들러가 요청을 처리할지 미리 알 필요가 없습니다. 요청이 자동으로 처리될 때까지 체인을 따라 이동합니다.
- **유연성** : 런타임에 체인을 동적으로 구성하거나 변경할 수 있어, 요청을 처리하는 방식을 유연하게 조절할 수 있습니다.
- **단일 책임 원칙 준수** : 각 핸들러는 오직 한 가지 종류의 요청만 처리하는 책임만을 가집니다.

## 프론트엔드 활용 아이디어

- **폼 검증 체인**: 유효성 검사 규칙을 순차적으로 적용
- **이벤트 처리**: 이벤트 버블링/캡처링 체인

## 백엔드/전체 활용 아이디어

- **인증/권한 체인**: 로그인 → 권한 → 역할 검사
- **로깅/모니터링**: 요청 로깅 → 성능 측정 → 알림
- **에러 처리**: 에러 타입별 핸들러 체인

## 구현 팁

- 체인 순서가 중요할 때는 명시적으로 순서 관리
- 무한 루프 방지를 위한 체인 깊이 제한 고려

## JavaScript 예제 (주석 포함)

```javascript
class Approver {
  constructor() {
    this.nextApprover = null;
  }

  setNext(approver) {
    this.nextApprover = approver;
    return approver; // 체인을 계속 연결하기 쉽게 반환
  }

  approve(amount) {
    // 다음 핸들러로 요청을 전달하는 기본 메서드
    if (this.nextApprover) {
      return this.nextApprover.approve(amount);
    }
    console.log(`모든 승인 절차를 통과했습니다.`);
    return true;
  }
}

---

class GeneralApprover extends Approver {
  approve(amount) {
    if (amount < 100000) {
      console.log(`일반 승인자가 ${amount}원 결제를 승인합니다.`);
      return true;
    }
    console.log(`일반 승인자가 처리할 수 없는 금액(${amount}원)입니다. 다음 승인자에게 전달합니다.`);
    return super.approve(amount);
  }
}

class DepartmentHeadApprover extends Approver {
  approve(amount) {
    if (amount >= 100000 && amount < 1000000) {
      console.log(`부서장 승인자가 ${amount}원 결제를 승인합니다.`);
      return true;
    }
    console.log(`부서장 승인자가 처리할 수 없는 금액(${amount}원)입니다. 다음 승인자에게 전달합니다.`);
    return super.approve(amount);
  }
}

class CEOApprover extends Approver {
  approve(amount) {
    if (amount >= 1000000) {
      console.log(`최고 관리자 승인자가 ${amount}원 결제를 승인합니다.`);
      return true;
    }
    console.log(`최고 관리자 승인자가 처리할 수 없는 금액(${amount}원)입니다. 다음 승인자에게 전달합니다.`);
    return super.approve(amount);
  }
}

---

function linkApprovers(head, ...rest) {
  if (rest.length === 0) return head;
  head.setNext(rest[0]);
  return linkApprovers(rest[0], ...rest.slice(1));
}

const general = new GeneralApprover();
const deptHead = new DepartmentHeadApprover();
const ceo = new CEOApprover();

// 체인을 구성하고, 시작점인 general을 approverChain에 할당
const approverChain = linkApprovers(general, deptHead, ceo);

// 요청
console.log('--- 8만원 결제 요청 ---');
general.approve(80000);
// 출력: 일반 승인자가 80000원 결제를 승인합니다.

console.log('\n--- 50만원 결제 요청 ---');
general.approve(500000);
// 출력:
// 일반 승인자가 처리할 수 없는 금액(500000원)입니다. 다음 승인자에게 전달합니다.
// 부서장 승인자가 500000원 결제를 승인합니다.

console.log('\n--- 200만원 결제 요청 ---');
general.approve(2000000);
// 출력:
// 일반 승인자가 처리할 수 없는 금액(2000000원)입니다. 다음 승인자에게 전달합니다.
// 부서장 승인자가 처리할 수 없는 금액(2000000원)입니다. 다음 승인자에게 전달합니다.
// 최고 관리자 승인자가 2000000원 결제를 승인합니다.
```
