# HTTP 상태 코드

## 개요

HTTP 상태 코드는 서버가 클라이언트의 요청에 대한 처리 결과를 3자리 숫자로 표현한 것입니다. 클라이언트가 요청의 성공/실패 여부와 원인을 파악할 수 있게 해줍니다.

## 상태 코드 분류

### 1xx (Informational) - 정보성 응답

요청이 수신되었으며 처리 과정에 있음을 나타냅니다.

#### 100 Continue

- **의미**: 클라이언트가 계속해서 요청을 보낼 수 있음
- **사용 시점**: 클라이언트가 Expect: 100-continue 헤더를 보낸 경우
- **예시**: 대용량 파일 업로드 전 서버 확인

```http
# 요청
POST /upload HTTP/1.1
Host: example.com
Content-Length: 1048576
Expect: 100-continue

# 응답
HTTP/1.1 100 Continue

# 클라이언트가 파일 데이터 전송 시작
```

#### 101 Switching Protocols

- **의미**: 프로토콜 전환 요청 승인
- **사용 시점**: HTTP에서 WebSocket으로 전환할 때
- **예시**: WebSocket 연결 시

```http
# 요청
GET /chat HTTP/1.1
Host: example.com
Upgrade: websocket
Connection: Upgrade

# 응답
HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
```

### 2xx (Successful) - 성공 응답

요청이 성공적으로 처리되었음을 나타냅니다.

#### 200 OK

- **의미**: 요청이 성공적으로 처리됨
- **사용 시점**: GET, PUT, PATCH 요청 성공 시
- **예시**: 사용자 정보 조회 성공

200 상태 코드는 HTTP 요청이 성공적으로 처리되었음을 나타내는 가장 기본적인 성공 응답입니다. 클라이언트가 요청한 리소스를 정상적으로 받았거나, 요청한 작업이 성공적으로 수행되었을 때 사용됩니다.

**200 OK 응답의 특징:**

- **성공 표시**: 요청이 정상적으로 처리되었음을 명확히 표시
- **캐시 가능**: 응답 내용을 클라이언트에서 캐시할 수 있음
- **표준 응답**: 웹 API에서 가장 일반적으로 사용되는 성공 응답
- **데이터 포함**: 요청한 리소스나 작업 결과를 응답 본문에 포함

**실제 적용 예시:**

```http
HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: max-age=3600

{
  "id": 123,
  "name": "John Doe",
  "email": "john@example.com"
}
```

#### 201 Created

- **의미**: 새로운 리소스가 성공적으로 생성됨
- **사용 시점**: POST 요청으로 리소스 생성 성공 시
- **예시**: 새 사용자 계정 생성

```http
HTTP/1.1 201 Created
Content-Type: application/json
Location: /api/users/124

{
  "id": 124,
  "name": "Jane Doe",
  "email": "jane@example.com",
  "created_at": "2024-01-15T10:00:00Z"
}
```

#### 202 Accepted

- **의미**: 요청이 수락되었지만 아직 처리되지 않음
- **사용 시점**: 비동기 처리 작업 수락 시
- **예시**: 이메일 발송 요청 수락

```http
HTTP/1.1 202 Accepted
Content-Type: application/json

{
  "message": "Email queued for delivery",
  "job_id": "email_12345",
  "estimated_delivery": "2024-01-15T10:05:00Z"
}
```

#### 204 No Content

- **의미**: 요청이 성공했지만 응답 본문이 없음
- **사용 시점**: DELETE 요청 성공 시
- **예시**: 사용자 삭제 성공

```http
HTTP/1.1 204 No Content
```

### 3xx (Redirection) - 리다이렉션

요청을 완료하기 위해 추가적인 조치가 필요함을 나타냅니다.

#### 301 Moved Permanently

- **의미**: 요청한 리소스가 영구적으로 다른 위치로 이동됨
- **사용 시점**: URL이 영구적으로 변경된 경우
- **예시**: 도메인 변경, URL 구조 개선

```http
HTTP/1.1 301 Moved Permanently
Location: https://newdomain.com/api/users
Cache-Control: max-age=31536000
```

#### 302 Found (Temporary Redirect)

- **의미**: 요청한 리소스가 임시로 다른 위치에 있음
- **사용 시점**: 임시 리다이렉션이 필요한 경우
- **예시**: 로그인 후 원래 페이지로 리다이렉션

```http
HTTP/1.1 302 Found
Location: /dashboard
Cache-Control: no-cache
```

#### 304 Not Modified

- **의미**: 클라이언트가 캐시된 리소스를 사용할 수 있음
- **사용 시점**: 조건부 GET 요청 시 리소스가 변경되지 않은 경우
- **예시**: ETag나 Last-Modified 헤더로 캐시 검증

```http
HTTP/1.1 304 Not Modified
ETag: "abc123"
Cache-Control: max-age=3600
```

### 4xx (Client Error) - 클라이언트 오류

클라이언트의 요청에 문제가 있음을 나타냅니다.

#### 400 Bad Request

- **의미**: 잘못된 요청 구문이나 유효하지 않은 요청
- **사용 시점**: 요청 본문이 잘못된 형식이거나 필수 필드가 누락된 경우
- **예시**: JSON 형식 오류, 필수 파라미터 누락

```http
HTTP/1.1 400 Bad Request
Content-Type: application/json

{
  "error": "Bad Request",
  "message": "Invalid JSON format",
  "details": "Expected 'name' field"
}
```

#### 401 Unauthorized

- **의미**: 인증이 필요함
- **사용 시점**: 로그인이 필요한 API 호출 시
- **예시**: 인증 토큰이 없거나 만료된 경우

```http
HTTP/1.1 401 Unauthorized
Content-Type: application/json
WWW-Authenticate: Bearer realm="example"

{
  "error": "Unauthorized",
  "message": "Authentication required"
}
```

#### 403 Forbidden

- **의미**: 서버가 요청을 거부함
- **사용 시점**: 인증은 되었지만 권한이 부족한 경우
- **예시**: 일반 사용자가 관리자 기능에 접근하려 할 때

```http
HTTP/1.1 403 Forbidden
Content-Type: application/json

{
  "error": "Forbidden",
  "message": "Insufficient permissions",
  "required_role": "admin"
}
```

#### 404 Not Found

- **의미**: 요청한 리소스를 찾을 수 없음
- **사용 시점**: 존재하지 않는 URL이나 리소스에 접근할 때
- **예시**: 존재하지 않는 사용자 ID로 조회

```http
HTTP/1.1 404 Not Found
Content-Type: application/json

{
  "error": "Not Found",
  "message": "User with ID 999 not found",
  "resource": "user",
  "id": 999
}
```

#### 409 Conflict

- **의미**: 요청이 현재 서버 상태와 충돌함
- **사용 시점**: 중복된 리소스 생성 시도
- **예시**: 이미 존재하는 이메일로 사용자 생성

```http
HTTP/1.1 409 Conflict
Content-Type: application/json

{
  "error": "Conflict",
  "message": "Email already exists",
  "field": "email",
  "value": "john@example.com"
}
```

#### 422 Unprocessable Entity

- **의미**: 요청은 올바르지만 처리할 수 없음
- **사용 시점**: 요청 데이터는 유효하지만 비즈니스 로직상 처리 불가
- **예시**: 재고가 부족한 상품 주문

```http
HTTP/1.1 422 Unprocessable Entity
Content-Type: application/json

{
  "error": "Unprocessable Entity",
  "message": "Insufficient stock",
  "product_id": 123,
  "requested_quantity": 10,
  "available_quantity": 5
}
```

#### 429 Too Many Requests

- **의미**: 요청이 너무 많음
- **사용 시점**: Rate limiting 초과 시
- **예시**: API 호출 제한 초과

```http
HTTP/1.1 429 Too Many Requests
Content-Type: application/json
Retry-After: 60

{
  "error": "Too Many Requests",
  "message": "Rate limit exceeded",
  "retry_after": 60,
  "limit": "100 requests per hour"
}
```

### 5xx (Server Error) - 서버 오류

서버가 요청을 처리하는 과정에서 오류가 발생했음을 나타냅니다.

#### 500 Internal Server Error

- **의미**: 서버 내부 오류
- **사용 시점**: 예상치 못한 서버 오류 발생 시
- **예시**: 데이터베이스 연결 실패, 코드 오류

```http
HTTP/1.1 500 Internal Server Error
Content-Type: application/json

{
  "error": "Internal Server Error",
  "message": "An unexpected error occurred",
  "request_id": "req_12345"
}
```

#### 502 Bad Gateway

- **의미**: 게이트웨이 또는 프록시 서버 오류
- **사용 시점**: 업스트림 서버로부터 잘못된 응답을 받은 경우
- **예시**: 로드 밸런서 뒤의 서버 응답 오류

```http
HTTP/1.1 502 Bad Gateway
Content-Type: application/json

{
  "error": "Bad Gateway",
  "message": "Upstream server error"
}
```

#### 503 Service Unavailable

- **의미**: 서비스가 일시적으로 사용할 수 없음
- **사용 시점**: 서버 과부하, 유지보수 중
- **예시**: 데이터베이스 점검 중

```http
HTTP/1.1 503 Service Unavailable
Content-Type: application/json
Retry-After: 300

{
  "error": "Service Unavailable",
  "message": "Service is temporarily unavailable",
  "retry_after": 300,
  "maintenance_window": "2024-01-15 02:00-04:00 UTC"
}
```

#### 504 Gateway Timeout

- **의미**: 게이트웨이 타임아웃
- **사용 시점**: 업스트림 서버로부터 응답을 받지 못한 경우
- **예시**: 외부 API 호출 타임아웃

```http
HTTP/1.1 504 Gateway Timeout
Content-Type: application/json

{
  "error": "Gateway Timeout",
  "message": "Upstream server timeout"
}
```

## 상태 코드 사용 가이드

### 1. 성공 응답 (2xx)

```javascript
// Express.js 예시
app.get("/api/users/:id", (req, res) => {
  const user = findUser(req.params.id);
  if (user) {
    res.status(200).json(user);
  } else {
    res.status(404).json({ error: "User not found" });
  }
});

app.post("/api/users", (req, res) => {
  const newUser = createUser(req.body);
  res.status(201).location(`/api/users/${newUser.id}`).json(newUser);
});

app.delete("/api/users/:id", (req, res) => {
  deleteUser(req.params.id);
  res.status(204).send();
});
```

### 2. 클라이언트 오류 (4xx)

```javascript
// 입력 검증
app.post("/api/users", (req, res) => {
  const { name, email } = req.body;

  if (!name || !email) {
    return res.status(400).json({
      error: "Bad Request",
      message: "Name and email are required",
    });
  }

  if (isEmailExists(email)) {
    return res.status(409).json({
      error: "Conflict",
      message: "Email already exists",
    });
  }

  // 사용자 생성 로직...
});

// 권한 검사
app.delete("/api/users/:id", authenticate, (req, res) => {
  if (req.user.role !== "admin") {
    return res.status(403).json({
      error: "Forbidden",
      message: "Admin access required",
    });
  }

  // 삭제 로직...
});
```

### 3. 서버 오류 (5xx)

```javascript
// 에러 핸들링 미들웨어
app.use((err, req, res, next) => {
  console.error("Error:", err);

  // 데이터베이스 연결 오류
  if (err.code === "ECONNREFUSED") {
    return res.status(503).json({
      error: "Service Unavailable",
      message: "Database connection failed",
    });
  }

  // 기본 서버 오류
  res.status(500).json({
    error: "Internal Server Error",
    message: "An unexpected error occurred",
    request_id: req.id,
  });
});
```

## 상태 코드와 HTTP 메서드 매핑

### GET 요청

- **200**: 리소스 조회 성공
- **404**: 리소스 없음
- **304**: 캐시된 리소스 사용 가능

### POST 요청

- **201**: 리소스 생성 성공
- **400**: 잘못된 요청 데이터
- **409**: 리소스 충돌
- **422**: 처리 불가능한 엔티티

### PUT 요청

- **200**: 리소스 업데이트 성공
- **201**: 새 리소스 생성
- **400**: 잘못된 요청 데이터
- **404**: 업데이트할 리소스 없음

### DELETE 요청

- **204**: 리소스 삭제 성공
- **404**: 삭제할 리소스 없음
- **403**: 삭제 권한 없음

## 요약

HTTP 상태 코드는 API 응답의 성공/실패 여부와 원인을 명확하게 전달하는 중요한 요소입니다. 적절한 상태 코드를 사용하여 클라이언트가 요청 결과를 정확히 파악할 수 있도록 하는 것이 중요합니다.
