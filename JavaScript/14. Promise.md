# Promise

자바스크립트에서 비동기는 특정 작업이 완료될 때까지 기다리지 않고 다음 작업을 수행하는 논블로킹(Non-blocking) 형태로 진행됩니다. 복잡한 비동기 작업들을 순차적으로 처리하거나 오류를 관리하는 과정에서 이른바 '콜백 지옥(Callback Hell)'이라는 문제가 발생할 수 있습니다.

이러한 문제를 해결하기 위해 도입된 표준 비동기 처리 객체가 바로 **Promise**입니다. Promise는 비동기 작업의 최종 성공(fulfilled) 또는 실패(rejected) 여부를 나타내는 객체로, 비동기 작업을 마치 동기 작업처럼 간편하게 다룰 수 있도록 돕습니다.

Promise는 비동기 작업의 진행 상황을 나타내는 세 가지 상태 중 하나를 가집니다.

1.  **대기 (Pending)**: 비동기 작업이 아직 완료되지 않은 초기 상태. Promise가 해결(resolve)되거나 거부(reject)되기를 기다리는 중입니다.
2.  **이행 (Fulfilled)**: 비동기 작업이 성공적으로 완료된 상태. `resolve()` 함수가 호출되며, 결과 값을 가집니다.
3.  **거부 (Rejected)**: 비동기 작업이 실패한 상태. `reject()` 함수가 호출되며, 오류 정보를 가집니다.

---

Promise의 상태는 **Pending → Fulfilled** 또는 **Pending → Rejected**로 한 번만 변경될 수 있습니다. 이행되거나 거부된 Promise를 **"확정(Settled)"** 상태라고 부릅니다.

Promise는 `then()`, `catch()`, `finally()` 세 가지 주요 메서드를 통해 비동기 작업의 결과를 처리하고, 여러 비동기 작업을 연쇄적으로 연결할 수 있는 체이닝 기능을 제공합니다. 이 메서드들은 항상 새로운 Promise 객체를 반환하므로, `.then().then().catch()...` 와 같이 연결하여 사용할 수 있습니다.

`then()` 메서드는 Promise가 이행(fulfilled)되었을 때 실행될 콜백 함수와 거부(rejected)되었을 때 실행될 콜백 함수를 각각 인수로 받습니다.

```javascript
const myPromise = new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve("작업 성공!");
  }, 300);
});

myPromise.then(
  (value) => {
    console.log(value);
  },
  (error) => {
    console.error(error);
  }
);

myPromise
  .then((newValue) => {})
  .catch((error) => {})
  .finally(() => {});
```

`then()` 콜백이 Promise가 아닌 값을 반환하면, 그 값은 즉시 다음 `then()`으로 전달됩니다.
즉각적인 에러 대응보다는 `.catch()` 메서드를 사용하여 체인 마지막에 에러를 한 번에 처리하는 것을 권장합니다.

---

`Promise`는 비동기 작업을 처리할 때 마이크로태스크 큐(Microtask Queue)를 활용합니다. `Promise.then()`에 등록된 콜백 함수들은 일반 `태스크 큐(Task Queue)`보다 우선순위가 높은 마이크로태스크 큐에 들어가 처리됩니다.

따라서 `promiseA`가 이미 `settled` 상태라면, `promiseA`에 등록된 모든 `.then()` 콜백은 마이크로태스크 큐에 거의 동시에 들어가 즉시 실행될 준비를 합니다.

```javascript
const promiseA = new Promise((resolve) => {});
const promiseB = promiseA.then((value) => {});
const promiseC = promiseA.then((value) => {});
```

Promise 클래스는 비동기 작업 동시성을 용이하게 하기 위해 네 가지 정적 메서드를 제공합니다.

Promise.all() - 모든 프로미스가 이행되면 이행되고, 프로미스 중 하나라도 거부되면 거부됩니다.  
Promise.allSettled() - 모든 프로미스가 해결되면 이행됩니다.
