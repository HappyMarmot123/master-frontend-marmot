# Vue 공식 전역 상태 관리 - Pinia

## 📖 개요

**Pinia**는 Vuex의 단점을 개선하고 Vue 3의 Composition API에 최적화되어 개발된 Vue 애플리케이션의 공식 전역 상태 관리 라이브러리입니다. Pinia는 다음과 같은 명확한 이점을 제공합니다.

- **단순화된 구조 (Mutations 제거)**: Vuex는 상태 변경을 위해 `Mutations`를 강제했지만, Pinia는 이 계층을 제거하여 Actions 내에서 직접 상태를 변경할 수 있게 합니다. 이는 코드의 복잡성을 크게 줄여줍니다.
- **TypeScript 지원 강화 (Type Safety)**: Pinia는 코어부터 TypeScript를 염두에 두고 설계되어, 상태(State), Getter, Action에 대한 완벽한 타입 추론을 제공합니다. 이는 대규모 애플리케이션의 안정성과 개발 경험을 크게 향상시킵니다.
- **모듈화 기본 (No Namespacing Headaches)**: Pinia는 모든 Store가 기본적으로 모듈화되어 있으며, Vuex의 복잡했던 네임스페이스(Namespacing) 옵션을 사용할 필요가 없어졌습니다. 각 Store가 독립적으로 작동합니다.
- **더 가벼움**: Pinia의 코어는 Vuex보다 훨씬 가벼우며, 최소한의 API만 제공하여 러닝 커브가 낮습니다.

## ⚙️ Pinia의 작동 원리

Pinia의 작동 원리는 Vue 3의 반응성(Reactivity) 시스템을 기반으로 합니다.

- **Store 생성**: `defineStore` 함수를 사용하여 Store를 정의하면, Pinia는 내부적으로 이 Store를 Vue의 반응성 시스템(`reactive()`)을 통해 감싸서 만듭니다.
- **데이터 접근**: 컴포넌트에서 `useStore()`와 같은 형태로 Store에 접근하면, Vue는 해당 Store의 모든 속성(State, Getter)에 대한 반응성 연결(Reactivity Connection)을 설정합니다.
- **상태 변경 감지**: 컴포넌트나 Action에서 Store의 State를 변경하면, Pinia는 Vue의 반응성 메커니즘을 통해 변경을 감지하고, 해당 상태를 사용하고 있는 모든 컴포넌트를 자동으로 업데이트합니다.

## 🏗️ Pinia의 기본 구조 (State, Getters, Actions)

Pinia Store는 `defineStore` 함수를 사용하여 정의됩니다. `Option Store` (Vuex와 유사) 또는 `Setup Store` (Composition API와 유사) 두 가지 방식으로 정의할 수 있으며, 가장 일반적인 `Option Store`의 기본 구조는 다음과 같습니다.

```javascript
import { defineStore } from "pinia";

// 'counter'는 이 Store의 고유 ID이며 필수입니다.
export const useCounterStore = defineStore("counter", {
  state: () => ({
    count: 0,
    name: "Pinia User",
    isAdmin: true,
  }),

  getters: {
    doubleCount: (state) => state.count * 2,
    isAdminInfo() {
      return this.name + (this.isAdmin ? " (Admin)" : " (Guest)");
    },
  },

  actions: {
    increment() {
      this.count++;
    },

    // 비동기 처리 가능
    async waitAndIncrement() {
      await new Promise((resolve) => setTimeout(resolve, 1000));
      this.count++;
    },
  },
});
```

## 💡 스토어에서 데이터 접근 및 변경

Pinia는 컴포넌트 내부에서 Store를 사용할 때도 Composition API의 훅처럼 작동하여 코드를 간결하게 만듭니다.

### 1. 컴포넌트에서 Store 사용

| 작업                | Composition API 방식               | 설명                                             |
| :------------------ | :--------------------------------- | :----------------------------------------------- |
| **Store 사용**      | `const store = useCounterStore();` | `defineStore`에서 정의한 함수를 호출합니다.      |
| **Getter 접근**     | `store.doubleCount`                | Getter는 읽기 전용 속성처럼 접근합니다.          |
| **Action 호출**     | `store.increment()`                | Action은 메서드처럼 호출하여 상태를 변경합니다.  |
| **State 직접 접근** | `store.count`                      | State에 직접 접근하여 읽거나 변경할 수 있습니다. |

### 2. State 해체 시 반응성 유지

`const { count } = store;`와 같이 State를 구조 분해(Destructuring)하면 반응성을 잃습니다. 반응성을 유지하며 State를 해체하려면 `storeToRefs` 유틸리티를 사용해야 합니다.

```javascript
import { storeToRefs } from "pinia";
import { useCounterStore } from "./stores/counter";

export default {
  setup() {
    const store = useCounterStore();
    // State와 Getter를 해체하여 반응성 있게 사용
    const { count, doubleCount } = storeToRefs(store);
    const { increment } = store;

    return {
      count,
      doubleCount,
      increment,
    };
  },
};
```
