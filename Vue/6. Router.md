## Vue Router

Vue Router 4는 Vue 3의 Composition API 및 새로운 기능들을 최대한 활용할 수 있도록 완전히 새롭게 설계된 애플리케이션의 공식 라우팅 라이브러리입니다.

### 라우터 설정

`Vue Router`를 사용하기 위해서는 먼저 라우터 인스턴스를 생성하고 Vue 애플리케이션에 연결해야 합니다. 이 과정에서 라우트(경로)를 정의하고 히스토리 모드를 설정합니다.

```javascript
import { createApp } from "vue";
import { createRouter, createWebHistory } from "vue-router";
import Home from "./views/Home.vue";
import App from "./App.vue";

const routes = [
  { path: "/", component: Home },
  { path: "/about", component: () => import("./views/About.vue") },
];

const router = createRouter({
  history: createWebHistory(), // 히스토리 모드 설정
  routes,
});

const app = createApp(App);
app.use(router);
app.mount("#app");
```

#### 히스토리 모드 종류

`createRouter` 함수에 전달하는 `history` 옵션에 따라 URL 형식이 달라지며, 이는 서버 설정 요구사항에도 영향을 미칩니다.

| 함수                     | 모드               | URL 형식               | 서버 요구사항                                    |
| :----------------------- | :----------------- | :--------------------- | :----------------------------------------------- |
| `createWebHistory()`     | HTML5 History Mode | `example.com/user/1`   | 서버 설정 필요 (모든 경로를 `index.html`로 폴백) |
| `createWebHashHistory()` | Hash Mode          | `example.com/#/user/1` | 서버 설정 불필요 (URL이 해시 값으로 처리됨)      |
| `createMemoryHistory()`  | Memory Mode        | (내부 관리)            | SSR(서버 사이드 렌더링) 환경 및 테스트 환경      |

### Composition API에서 라우터 사용하기

Composition API를 사용하는 컴포넌트에서는 `this.$router`나 `this.$route`에 직접 접근할 수 없으므로, Vue Router가 제공하는 공식 훅을 사용해야 합니다.

- `useRouter()`: 라우터 인스턴스에 접근할 때 사용합니다. (예: 라우터 이동 `router.push('/home')`, 네비게이션 가드 등록 등)
- `useRoute()`: 현재 활성화된 라우트 객체에 접근할 때 사용합니다. (예: 파라미터 `route.params`, 쿼리 `route.query`, 경로 `route.path` 등). 이 객체는 반응형이므로 변경을 감시할 수 있습니다.

```javascript
import { useRouter, useRoute } from "vue-router";
import { watch } from "vue";

export default {
  setup() {
    const router = useRouter();
    const route = useRoute();

    const goToUser = (id) => {
      router.push({ name: "user", params: { userId: id } });
    };

    // route 객체는 반응형이므로 watch로 변경을 감지할 수 있습니다.
    watch(
      () => route.params.userId,
      (newId) => {
        console.log(`사용자 ID가 ${newId}로 변경되었습니다.`);
      }
    );

    return { goToUser };
  },
};
```

### 내비게이션 가드 (Navigation Guards)

내비게이션 가드는 Vue Router를 통해 페이지 이동(내비게이션)이 발생할 때, 그 과정을 가로채서 인증, 권한 확인, 데이터 페칭, 또는 페이지 전환 효과와 같은 추가적인 로직을 수행할 수 있도록 해주는 기능입니다. 이는 라우팅 전반에 걸쳐 유연하게 제어권을 확보할 수 있게 해줍니다.

내비게이션 가드는 적용 범위에 따라 크게 세 가지 종류로 나눌 수 있습니다.

#### 1. 전역 가드 (Global Guards)

전역 가드는 애플리케이션의 모든 라우트 이동에 적용됩니다. 주로 사용자 인증 여부를 확인하거나 전역적인 로깅 등에 사용됩니다. `router.beforeEach`가 대표적입니다.

```javascript
router.beforeEach((to, from, next) => {
  const isAuthenticated = false;

  if (to.meta.requiresAuth && !isAuthenticated) {
    next({ name: "Login" });
  } else {
    next();
  }
});
```

### 2. 라우트별 가드 (Per-Route Guards)

특정 라우트에만 적용되는 가드입니다. 라우트 설정 객체 내에서 `beforeEnter` 속성을 사용하여 정의합니다. 특정 라우트에 접근하기 전에만 필요한 로직을 수행할 때 유용합니다.

```javascript
const routes = [
  {
    path: "/admin",
    component: AdminDashboard,
    meta: { requiresAuth: true },
    beforeEnter: (to, from, next) => {
      if (confirm("관리자 페이지에 접근하시겠습니까?")) {
        next();
      } else {
        next(false);
      }
    },
  },
];
```

### 3. 컴포넌트 내 가드 (In-Component Guards)

특정 컴포넌트 내부에서 라우팅 관련 로직을 처리할 때 사용합니다. 컴포넌트 라이프사이클 훅과 유사하게 동작합니다다. 내비게이션 가드를 통해 애플리케이션의 라우팅 흐름을 강력하게 제어하고, 복잡한 비즈니스 로직을 라우팅 과정에 통합할 수 있습니다.

- `beforeRouteEnter`: 라이프사이클 Creation 단계에서 가장 앞에 실행됩니다. (this 사용불가)
- `beforeRouteUpdate`: 사용자가 현재 페이지를 떠나지 않고, URL의 일부(파라미터, 쿼리)만 변경되는 경우에 실행되고 Update 단계이므로 데이터를 패칭이 가능합니다.
- `beforeRouteLeave`: 현재 라우트를 떠나기 전에 호출됩니다.

```javascript
<template>
  <div>사용자 상세 정보</div>
</template>

<script setup>
import { onBeforeRouteLeave, onBeforeRouteUpdate } from "vue-router";

onBeforeRouteEnter((to, from, next) => {
  console.log("Before Route Enter");
  next();
});

onBeforeRouteUpdate((to, from, next) => {
  console.log("Before Route Update");
  next();
});

onBeforeRouteLeave((to, from, next) => {
  const answer = window.confirm("정말 떠나시겠습니까?");
  if (answer) {
    next();
  } else {
    next(false);
  }
});
</script>
```
