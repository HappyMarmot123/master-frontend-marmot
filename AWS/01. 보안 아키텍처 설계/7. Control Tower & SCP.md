# Control Tower & SCP

## 개요

AWS Control Tower는 다중 계정 AWS 환경을 설정하고 거버넌스를 제공하는 서비스입니다. 서비스 제어 정책(SCP)을 통해 조직 전체의 권한을 중앙에서 관리할 수 있습니다.

## 핵심 개념

### AWS Control Tower란?

다중 계정 AWS 환경을 설정하고 지속적으로 거버넌스를 제공하는 서비스입니다. 중앙 집중식 거버넌스로, 규정 준수를 모니터링합니다. 또한 계정 팩토리(Account Factory)를 통해 새로운 계정을 자동으로 생성할 수 있습니다.

여러 계정을 효율적으로 관리하고, 조직 전체의 보안 및 규정 준수를 보장하며, 계정 생성 및 관리를 자동화하고, 중앙 집중식 정책을 적용하기 위해 필요합니다.

**SCP(Service Control Policy)**는 서비스 제어 정책을 의미하며, 조직의 계정에 적용할 수 있는 권한 경계를 정의하는 정책입니다. SCP는 IAM 정책과 유사하지만 다른 목적을 가집니다. IAM 정책은 사용자나 역할에게 권한을 부여하는 반면, SCP는 계정 전체에 대한 권한 경계를 설정하여 최대 권한을 제한합니다. 또한 SCP의 정책이 우선순위가 높습니다.

### AWS Organizations

AWS Organizations는 여러 AWS 계정을 중앙에서 관리하는 서비스입니다. 계정을 그룹화하고, 통합 결제를 제공하며, 서비스 제어 정책(SCP)을 적용하고, 계정 간 리소스를 공유할 수 있게 합니다.

Control Tower는 Organizations를 기반으로 작동하며 추가 기능을 제공하는 서비스입니다.

### SCP의 목적

SCP의 목적은 계정 내 모든 사용자와 역할이 가질 수 있는 최대 권한을 제한하는 권한 경계를 설정하는 것입니다. 예를 들어, SCP에서 "특정 리전에서만 리소스 생성 허용"이라고 설정하면, 계정 내 모든 사용자가 다른 리전에 리소스를 만들 수 없게 됩니다. IAM 정책에서 다른 리전 권한을 부여해도 SCP가 차단합니다.

### SCP 구조

SCP는 IAM 정책과 동일한 JSON 형식을 사용합니다:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Deny",
      "Action": ["ec2:RunInstances"],
      "Resource": "*",
      "Condition": {
        "StringNotEquals": {
          "ec2:Region": "ap-northeast-2"
        }
      }
    }
  ]
}
```

### SCP 적용 레벨

SCP는 여러 레벨에 적용할 수 있습니다. 루트 레벨에서는 조직의 모든 계정에 적용되며, 조직 단위(OU) 레벨에서는 특정 OU의 모든 계정에 적용됩니다. 계정 레벨에서는 특정 계정에만 적용할 수 있습니다. 우선순위는 계정 레벨 SCP가 가장 높고, 그 다음 OU 레벨 SCP, 마지막으로 루트 레벨 SCP 순입니다.

### SCP 평가 로직

SCP는 IAM 정책과 유사하게 평가됩니다. 명시적 Deny가 최우선이며 즉시 거부됩니다. SCP는 Deny만 사용하므로 명시적 Allow는 없습니다. SCP가 없으면 모든 작업이 허용됩니다. 중요한 점은 SCP는 권한을 부여하지 않고, 권한을 제한한다는 것입니다.

### SCP vs IAM 정책

| 항목          | IAM 정책       | SCP                      |
| ------------- | -------------- | ------------------------ |
| **목적**      | 권한 부여      | 권한 제한 (경계 설정)    |
| **적용 범위** | 사용자/역할    | 계정 전체                |
| **우선순위**  | 낮음           | 높음 (IAM 정책보다 우선) |
| **Effect**    | Allow, Deny    | 주로 Deny                |
| **사용 사례** | 개별 권한 관리 | 조직 전체 정책           |

## Control Tower 구성 요소

### 1. 랜딩 존 (Landing Zone)

랜딩 존은 다중 계정 환경의 기반 인프라입니다. 랜딩 존은 관리 계정(Management Account)으로 Control Tower를 설정하고 관리하며, 로그 아카이브 계정에서 모든 계정의 로그를 중앙에 저장하고, 감사 계정을 통해 규정 준수 및 감사를 수행합니다. 랜딩 존은 CloudTrail 로깅, AWS Config 규칙, GuardDuty 위협 탐지, 중앙 집중식 로깅을 자동으로 설정합니다.

### 2. 계정 팩토리 (Account Factory)

계정 팩토리는 새로운 AWS 계정을 자동으로 생성하고 구성하는 기능입니다. 사용자가 계정 생성 요청을 하면, Account Factory가 새 계정을 생성하고 기본 보안 설정을 적용한 후 적절한 OU에 배치하며 필요한 서비스를 활성화합니다. 계정 팩토리를 사용하면 일관된 계정 구성을 유지할 수 있고, 보안 설정이 자동화되며, 규정 준수가 보장됩니다.

### 3. Guardrails (가드레일)

가드레일은 조직 전체에 적용되는 거버넌스 규칙입니다. 세 가지 유형이 있습니다.

첫 번째는 필수 가드레일(Mandatory Guardrails)로 모든 계정에 자동 적용되며 비활성화할 수 없습니다. 예를 들어 루트 사용자 MFA 활성화가 있습니다.

두 번째는 강력 권장 가드레일(Strongly Recommended Guardrails)로 기본적으로 활성화되지만 필요 시 비활성화할 수 있습니다. 예를 들어 암호화된 S3 버킷만 허용하는 것이 있습니다.

세 번째는 선택적 가드레일(Elective Guardrails)로 수동으로 활성화하며 특정 요구사항에 맞춥니다. 예를 들어 특정 리전만 사용하는 것이 있습니다.

가드레일은 SCP를 통해 권한을 제한하고, AWS Config 규칙을 통해 리소스 구성을 검사하며, 서비스 제어 정책을 통해 서비스 사용을 제한합니다.

루트 레벨에 SCP를 연결하면 모든 멤버 계정에 자동으로 적용되며, 서울 리전 외에서 리소스 생성 시도 시 거부됩니다.

## 관련 서비스

AWS Organizations는 다중 계정 관리와 SCP 적용, 통합 결제를 제공합니다. AWS Config는 리소스 구성 추적과 규정 준수 검사, 가드레일 구현을 제공합니다. CloudTrail은 API 호출 로깅과 SCP 거부 이벤트 추적을 제공합니다. IAM Identity Center는 중앙 집중식 액세스 관리를 제공하며 Control Tower와 통합됩니다.

## 실제 사용 사례

대기업이 50개의 AWS 계정을 관리하는 경우, Control Tower로 중앙 집중식 관리를 수행하고, SCP로 조직 전체 정책을 적용하며, Account Factory로 새 계정을 자동 생성하고, 가드레일로 규정 준수를 보장합니다.
