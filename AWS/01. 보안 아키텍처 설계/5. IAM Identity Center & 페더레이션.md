# IAM Identity Center & 페더레이션

## 개요

IAM은 단일 AWS 계정 내에서 사용자 및 권한을 관리하는 반면, IAM Identity Center (이전 AWS SSO)는 여러 AWS 계정과 비-AWS 애플리케이션에 대한 중앙 집중식 단일 로그인(SSO) 액세스를 제공하는 서비스입니다. 엔터프라이즈 ID 공급자와의 페더레이션 통합을 지원합니다. 이를 통해 다중 계정 환경에서의 권한 관리를 효율적으로 수행할 수 있습니다.

### SSO (Single Sign-On)란?

**정의**: SSO(Single Sign-On)는 한 번의 로그인으로 여러 애플리케이션이나 서비스에 접근할 수 있게 해주는 인증 메커니즘입니다.

**작동 원리**:

```
1. 사용자가 한 번만 로그인 (예: 회사 Active Directory)
2. 인증 정보가 중앙에서 관리됨
3. 여러 AWS 계정이나 애플리케이션에 자동으로 접근 가능
4. 각 서비스마다 별도로 로그인할 필요 없음
```

**왜 필요한가?**: 여러 AWS 계정이나 애플리케이션을 사용하는 경우, 각각에 대해 별도로 로그인해야 하면 사용자 경험이 나빠지고 관리가 복잡해집니다. SSO를 사용하면 한 번의 로그인으로 모든 서비스에 접근할 수 있어 사용자 편의성이 향상되고, 중앙에서 사용자 생명주기를 관리할 수 있어 보안과 관리 효율성이 높아집니다.

### 페더레이션 (Federation)이란?

**정의**: 외부 ID 공급자의 사용자 자격 증명을 AWS에서 신뢰하고 사용하는 메커니즘

**작동 원리**:

```
1. 사용자가 AWS 콘솔 접근 시도
2. IAM Identity Center가 외부 ID 공급자로 리디렉션
3. 사용자가 ID 공급자에서 인증 (예: 회사 Active Directory)
4. ID 공급자가 SAML 어설션 발급
5. IAM Identity Center가 어설션 검증
6. AWS 계정에 대한 임시 자격 증명 발급
7. 사용자가 AWS 콘솔 접근
```

**왜 필요한가?**: 페더레이션을 통해 기존 엔터프라이즈 ID 시스템(Active Directory 등)을 재사용할 수 있어 AWS에 사용자를 별도로 만들 필요가 없습니다. 중앙 집중식 사용자 관리를 통해 사용자 생명주기 관리가 간소화되며, 예를 들어 퇴사 시 ID 공급자에서만 비활성화하면 모든 AWS 계정 접근이 차단됩니다.

## IAM Identity Center 구성 요소

### 1. 디렉터리 (Directory)

**디렉터리 유형**: 첫 번째는 내장 디렉터리로, IAM Identity Center가 직접 관리하며 간단한 사용 사례에 적합하고 사용자와 그룹을 직접 생성 및 관리할 수 있습니다. 두 번째는 AWS Managed Microsoft AD로, AWS가 관리하는 Microsoft Active Directory이며 Windows 기반 워크로드를 지원하고 LDAP 프로토콜을 지원합니다. **LDAP(Lightweight Directory Access Protocol)**는 디렉터리 서비스에 접근하기 위한 네트워크 프로토콜로, Active Directory와 같은 디렉터리에서 사용자, 그룹, 리소스 정보를 조회하고 관리하는 데 사용됩니다. 세 번째는 외부 ID 공급자를 통한 페더레이션으로, Microsoft Azure AD 등 SAML 2.0 호환 ID 공급자와 통합할 수 있습니다.

### 2. 권한 세트 (Permission Set)

권한 세트는 IAM 정책과 유사하지만 여러 계정에 일괄 적용할 수 있으며, 재사용 가능한 권한 템플릿으로 구성됩니다. 계정별로 다른 권한 세트를 할당할 수 있어 유연한 권한 관리가 가능합니다.

**예시**:

```
권한 세트: "ReadOnlyAccess"
- 모든 계정에 읽기 전용 권한 부여

권한 세트: "DeveloperAccess"
- 개발 계정: 전체 권한
- 프로덕션 계정: 읽기 전용
```

### 3. 할당 (Assignment)

할당은 사용자 또는 그룹을 대상으로 하며, 특정 AWS 계정에 권한 세트를 부여하는 구조로 이루어집니다.

**예시**:

```
사용자: developer@company.com
계정: 개발 계정 (123456789012)
권한 세트: DeveloperAccess
→ 개발자가 개발 계정에 DeveloperAccess 권한으로 접근 가능
```

## 페더레이션 프로토콜

### SAML 2.0 (Security Assertion Markup Language)

ID 공급자와 서비스 공급자 간의 인증 및 권한 부여 정보를 교환하는 XML 기반 프로토콜

**작동 흐름**:

```
1. 사용자가 AWS 콘솔 접근
2. AWS (서비스 공급자)가 ID 공급자로 리디렉션
3. 사용자가 ID 공급자에서 인증
4. ID 공급자가 SAML 어설션 생성 (사용자 정보 포함)
5. SAML 어설션을 AWS로 전송
6. AWS가 어설션 검증 및 사용자 식별
7. 임시 자격 증명 발급
```

**SAML 어설션 구성 요소**: SAML 어설션은 Subject(사용자 식별 정보), Attribute(사용자 속성으로 이름, 이메일, 그룹 등), Assertion(인증 정보) 등의 구성 요소로 이루어져 있습니다.

### OIDC (OpenID Connect)

OIDC는 OAuth 2.0 기반의 인증 프로토콜입니다. SAML과의 차이점은 SAML이 XML 기반으로 엔터프라이즈 환경에 적합한 반면, OIDC는 JSON 기반으로 모바일이나 웹 애플리케이션에 적합합니다. Google이나 Facebook 등 소셜 로그인과 통합할 때 활용됩니다.

## IAM Identity Center vs IAM

### 비교표

| 항목            | IAM                | IAM Identity Center           |
| --------------- | ------------------ | ----------------------------- |
| **범위**        | 단일 AWS 계정      | 여러 AWS 계정 및 애플리케이션 |
| **사용자 관리** | AWS 계정 내에서만  | 중앙 집중식                   |
| **페더레이션**  | 제한적 (SAML 역할) | 완전 지원                     |
| **SSO**         | 계정별 로그인      | 단일 로그인                   |
| **권한 관리**   | 계정별 정책        | 권한 세트 (여러 계정)         |
| **사용 사례**   | 단일 계정 환경     | 다중 계정 환경, 엔터프라이즈  |

### 언제 사용하는가?

IAM을 사용해야 하는 경우는 단일 AWS 계정 환경에서 간단한 사용자 관리를 하거나 AWS 서비스만 사용하는 경우입니다. 반면 IAM Identity Center를 사용해야 하는 경우는 여러 AWS 계정을 관리하거나 엔터프라이즈 ID 시스템과 통합이 필요하거나, 중앙 집중식 사용자 관리가 필요하거나, 비-AWS 애플리케이션도 SSO가 필요한 경우입니다.

## 관련 서비스

### AWS Organizations

AWS Organizations는 다중 계정 관리를 제공하며 IAM Identity Center와 통합되어 서비스 제어 정책(SCP)과 함께 사용할 수 있습니다.

### CloudTrail

CloudTrail은 IAM Identity Center 이벤트를 로깅하고 SSO 활동을 추적하여 보안 감사를 지원합니다.

### AWS Directory Service

AWS Directory Service는 AWS Managed Microsoft AD, Simple AD, AD Connector 등의 디렉터리 서비스를 제공하여 IAM Identity Center와 통합할 수 있습니다.
