# IAM Identity Center & 페더레이션

## 개요
IAM Identity Center (이전 AWS SSO)는 여러 AWS 계정과 비-AWS 애플리케이션에 대한 중앙 집중식 단일 로그인(SSO) 액세스를 제공하는 서비스입니다. 페더레이션을 통해 기존의 엔터프라이즈 ID 공급자와 통합할 수 있습니다.

## 핵심 개념

### IAM Identity Center란?
**정의**: 여러 AWS 계정과 클라우드 애플리케이션에 대한 중앙 집중식 액세스 관리 서비스

**기존 IAM과의 차이점**:
- **IAM**: 단일 AWS 계정 내에서 사용자 및 권한 관리
- **IAM Identity Center**: 여러 AWS 계정과 애플리케이션에 대한 통합 액세스 관리

**주요 기능**:
- 단일 로그인(SSO): 한 번 로그인하여 여러 계정/애플리케이션 접근
- 중앙 집중식 사용자 관리
- 엔터프라이즈 ID 공급자와 통합 (페더레이션)
- 다중 계정 환경에서의 권한 관리

### 페더레이션 (Federation)이란?
**정의**: 외부 ID 공급자의 사용자 자격 증명을 AWS에서 신뢰하고 사용하는 메커니즘

**작동 원리**:
```
1. 사용자가 AWS 콘솔 접근 시도
2. IAM Identity Center가 외부 ID 공급자로 리디렉션
3. 사용자가 ID 공급자에서 인증 (예: 회사 Active Directory)
4. ID 공급자가 SAML 어설션 발급
5. IAM Identity Center가 어설션 검증
6. AWS 계정에 대한 임시 자격 증명 발급
7. 사용자가 AWS 콘솔 접근
```

**왜 필요한가?**:
- 기존 엔터프라이즈 ID 시스템 재사용 (Active Directory 등)
- AWS에 사용자를 별도로 만들 필요 없음
- 중앙 집중식 사용자 관리
- 사용자 생명주기 관리 간소화 (퇴사 시 ID 공급자에서만 비활성화)

## IAM Identity Center 구성 요소

### 1. 디렉터리 (Directory)
**정의**: 사용자와 그룹을 저장하는 저장소

**디렉터리 유형**:

1. **IAM Identity Center 내장 디렉터리**
   - IAM Identity Center가 직접 관리
   - 간단한 사용 사례에 적합
   - 사용자와 그룹을 직접 생성 및 관리

2. **Active Directory (AWS Managed Microsoft AD)**
   - AWS가 관리하는 Microsoft Active Directory
   - Windows 기반 워크로드 지원
   - LDAP 프로토콜 지원

3. **외부 ID 공급자 (페더레이션)**
   - Microsoft Azure AD
   - Okta
   - Google Workspace
   - 기타 SAML 2.0 호환 ID 공급자

### 2. 권한 세트 (Permission Set)
**정의**: 사용자나 그룹에게 부여할 권한의 집합

**특징**:
- IAM 정책과 유사하지만 여러 계정에 일괄 적용 가능
- 재사용 가능한 권한 템플릿
- 계정별로 다른 권한 세트 할당 가능

**예시**:
```
권한 세트: "ReadOnlyAccess"
- 모든 계정에 읽기 전용 권한 부여

권한 세트: "DeveloperAccess"
- 개발 계정: 전체 권한
- 프로덕션 계정: 읽기 전용
```

### 3. 할당 (Assignment)
**정의**: 사용자/그룹에게 특정 계정의 권한 세트를 할당하는 것

**구성 요소**:
- **대상**: 사용자 또는 그룹
- **계정**: AWS 계정
- **권한 세트**: 부여할 권한

**예시**:
```
사용자: developer@company.com
계정: 개발 계정 (123456789012)
권한 세트: DeveloperAccess
→ 개발자가 개발 계정에 DeveloperAccess 권한으로 접근 가능
```

## 페더레이션 프로토콜

### SAML 2.0 (Security Assertion Markup Language)
**정의**: ID 공급자와 서비스 공급자 간의 인증 및 권한 부여 정보를 교환하는 XML 기반 프로토콜

**작동 흐름**:
```
1. 사용자가 AWS 콘솔 접근
2. AWS (서비스 공급자)가 ID 공급자로 리디렉션
3. 사용자가 ID 공급자에서 인증
4. ID 공급자가 SAML 어설션 생성 (사용자 정보 포함)
5. SAML 어설션을 AWS로 전송
6. AWS가 어설션 검증 및 사용자 식별
7. 임시 자격 증명 발급
```

**SAML 어설션 구성 요소**:
- **Subject**: 사용자 식별 정보
- **Attribute**: 사용자 속성 (이름, 이메일, 그룹 등)
- **Assertion**: 인증 정보

### OIDC (OpenID Connect)
**정의**: OAuth 2.0 기반의 인증 프로토콜

**SAML과의 차이점**:
- **SAML**: XML 기반, 엔터프라이즈 환경에 적합
- **OIDC**: JSON 기반, 모바일/웹 애플리케이션에 적합

**사용 사례**:
- 모바일 애플리케이션
- 웹 애플리케이션
- Google, Facebook 등 소셜 로그인

## IAM Identity Center vs IAM

### 비교표

| 항목 | IAM | IAM Identity Center |
|------|-----|---------------------|
| **범위** | 단일 AWS 계정 | 여러 AWS 계정 및 애플리케이션 |
| **사용자 관리** | AWS 계정 내에서만 | 중앙 집중식 |
| **페더레이션** | 제한적 (SAML 역할) | 완전 지원 |
| **SSO** | 계정별 로그인 | 단일 로그인 |
| **권한 관리** | 계정별 정책 | 권한 세트 (여러 계정) |
| **사용 사례** | 단일 계정 환경 | 다중 계정 환경, 엔터프라이즈 |

### 언제 사용하는가?

**IAM을 사용해야 하는 경우**:
- 단일 AWS 계정 환경
- 간단한 사용자 관리
- AWS 서비스만 사용

**IAM Identity Center를 사용해야 하는 경우**:
- 여러 AWS 계정 관리
- 엔터프라이즈 ID 시스템과 통합 필요
- 중앙 집중식 사용자 관리 필요
- 비-AWS 애플리케이션도 SSO 필요

## 실제 구성 예시

### 시나리오: 다중 계정 환경에서 SSO 구성

**환경**:
- 조직 계정 (관리 계정)
- 개발 계정
- 프로덕션 계정
- 기존 Active Directory 사용

**구성 단계**:

1. **IAM Identity Center 활성화**
   ```
   조직 관리 계정에서 IAM Identity Center 활성화
   ```

2. **디렉터리 연결**
   ```
   Active Directory를 IAM Identity Center에 연결
   (AWS Managed Microsoft AD 또는 기존 AD)
   ```

3. **권한 세트 생성**
   ```
   권한 세트 1: "DeveloperFullAccess"
   - 개발 계정: 전체 권한
   - 프로덕션 계정: 읽기 전용
   
   권한 세트 2: "ReadOnlyAccess"
   - 모든 계정: 읽기 전용
   ```

4. **사용자/그룹 할당**
   ```
   개발자 그룹 → 개발 계정 + DeveloperFullAccess
   개발자 그룹 → 프로덕션 계정 + ReadOnlyAccess
   
   관리자 그룹 → 모든 계정 + 전체 권한
   ```

5. **사용자 접근**
   ```
   개발자가 SSO 포털에 로그인
   → Active Directory 자격 증명 사용
   → 개발 계정과 프로덕션 계정이 보임
   → 각 계정 클릭 시 해당 권한으로 접근
   ```

## 페더레이션 설정 상세

### SAML 페더레이션 설정

**필요한 정보**:
- **ID 공급자 메타데이터**: ID 공급자의 SAML 메타데이터 URL 또는 파일
- **어설션 소비자 서비스 URL**: AWS가 어설션을 받을 URL
- **릴레이 상태**: 로그인 후 리디렉션할 URL

**설정 과정**:

1. **IAM Identity Center에서 SAML 애플리케이션 생성**
   - 애플리케이션 이름 지정
   - SAML 메타데이터 다운로드

2. **ID 공급자에서 SAML 애플리케이션 구성**
   - AWS SAML 메타데이터 업로드
   - 어설션 속성 매핑 (사용자 이름, 그룹 등)
   - 릴레이 상태 설정

3. **테스트 및 검증**
   - SSO 로그인 테스트
   - 권한 할당 확인

### 속성 매핑 (Attribute Mapping)
**정의**: ID 공급자의 사용자 속성을 AWS 사용자 속성으로 매핑

**매핑 예시**:
```
ID 공급자 속성 → AWS 속성
- email → ${user:email}
- name → ${user:displayName}
- groups → ${user:groups}
```

**그룹 기반 권한 부여**:
```
Active Directory 그룹: "AWS-Developers"
→ IAM Identity Center 그룹: "Developers"
→ 권한 세트: "DeveloperAccess"
→ 할당된 계정: 개발 계정
```

## 모범 사례

### 1. 중앙 집중식 관리
- IAM Identity Center를 조직의 중앙 관리 계정에서 활성화
- 모든 멤버 계정에 자동으로 적용

### 2. 최소 권한 원칙
- 권한 세트를 최소한의 권한으로 구성
- 계정별로 다른 권한 부여

### 3. 그룹 기반 할당
- 개별 사용자보다 그룹에 권한 할당
- 사용자 추가/제거 시 그룹만 관리

### 4. 정기적인 감사
- 사용자 할당 정기 검토
- 사용하지 않는 권한 세트 제거
- CloudTrail로 SSO 활동 모니터링

### 5. MFA 강제
- 중요한 계정에 MFA 강제
- ID 공급자 레벨에서 MFA 설정

## 관련 서비스

### AWS Organizations
- 다중 계정 관리
- IAM Identity Center와 통합
- 서비스 제어 정책(SCP)과 함께 사용

### CloudTrail
- IAM Identity Center 이벤트 로깅
- SSO 활동 추적

### AWS Directory Service
- AWS Managed Microsoft AD
- Simple AD
- AD Connector

## 실제 사용 사례

### 엔터프라이즈 환경
```
회사에 10개의 AWS 계정이 있고, 100명의 직원이 있음
- 각 계정에 IAM 사용자를 만들면 1000개의 사용자 관리 필요
- IAM Identity Center 사용 시:
  - Active Directory의 100명 사용자만 관리
  - 권한 세트로 계정별 권한 일괄 관리
  - 퇴사 시 AD에서만 비활성화하면 모든 계정 접근 차단
```

### 개발팀 환경
```
개발팀이 여러 계정에서 작업
- 개발 계정: 전체 권한
- 스테이징 계정: 읽기/쓰기 권한
- 프로덕션 계정: 읽기 전용
- IAM Identity Center로 한 번 로그인하여 모든 계정 접근
```

## 참고 자료
- [IAM Identity Center 공식 문서](https://docs.aws.amazon.com/singlesignon/)
- [페더레이션 가이드](https://docs.aws.amazon.com/singlesignon/latest/userguide/federated-users.html)
- [SAML 설정](https://docs.aws.amazon.com/singlesignon/latest/userguide/saml-apps.html)

