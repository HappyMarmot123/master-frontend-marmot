# NAT 게이트웨이

## 개요

NAT (Network Address Translation) 게이트웨이는 프라이빗 서브넷의 리소스가 인터넷에 접근할 수 있도록 하면서, 인터넷에서 프라이빗 리소스로의 직접 접근은 차단하는 관리형 서비스입니다. 프라이빗 서브넷의 아웃바운드 인터넷 접근을 제공하고, 인터넷에서 프라이빗 리소스로의 인바운드 접근을 차단하며, 자동 확장과 완전 관리형 기능을 제공합니다. 프라이빗 서브넷의 EC2가 아웃바운드 요청을 하면 NAT 게이트웨이가 퍼블릭 IP로 변환하여 인터넷으로 전송합니다.

### 왜 필요한가?

프라이빗 서브넷은 인터넷 게이트웨이에 직접 연결할 수 없고 인터넷에서 직접 접근할 수 없어 보안이 강화되지만, 소프트웨어 업데이트, 외부 API 호출, 패키지 다운로드 등 인터넷 접근이 필요한 경우가 있습니다. NAT 게이트웨이는 이러한 문제를 해결합니다.

## NAT 게이트웨이 아키텍처

```
인터넷
  ↓
인터넷 게이트웨이
  ↓
퍼블릭 서브넷
  └── NAT 게이트웨이
      ↓
프라이빗 서브넷
  └── EC2 인스턴스
```

### 작동 흐름

프라이빗 서브넷의 EC2가 인터넷 요청을 하면 라우팅 테이블이 NAT 게이트웨이로 라우팅하고, 요청을 퍼블릭 IP로 변환하여 인터넷 게이트웨이를 통해 인터넷으로 전송합니다. 응답은 NAT 게이트웨이를 통해 반환되어 EC2 인스턴스로 전달됩니다.

## NAT 게이트웨이 vs NAT 인스턴스

### 비교표

| 항목         | NAT 게이트웨이       | NAT 인스턴스              |
| ------------ | -------------------- | ------------------------- |
| **관리**     | 완전 관리형          | 사용자 관리               |
| **가용성**   | 높음 (여러 AZ)       | 사용자 구성 필요          |
| **확장성**   | 자동                 | 수동                      |
| **성능**     | 높음                 | 인스턴스 유형에 따라 다름 |
| **비용**     | 시간당 + 데이터 전송 | 인스턴스 비용             |
| **유지보수** | 불필요               | 패치 및 업데이트 필요     |

## NAT 게이트웨이 구성

### 1. 퍼블릭 서브넷에 배치

NAT 게이트웨이는 퍼블릭 서브넷에 배치해야 합니다. 인터넷 게이트웨이 접근과 퍼블릭 IP 주소가 필요하기 때문입니다.

### 2. NAT 게이트웨이에 Elastic IP 할당

고정 IP 주소가 필요하고 재시작 후에도 동일한 IP를 유지합니다.

### 3. 라우팅 테이블 구성

프라이빗 서브넷 라우팅 테이블은 0.0.0.0/0을 NAT 게이트웨이로 라우팅합니다.
퍼블릭 서브넷 라우팅 테이블은 0.0.0.0/0을 인터넷 게이트웨이로 라우팅합니다.

## 고가용성 구성

### Multi-AZ 배포

Multi-AZ 배포는 프라이빗 서브넷 A가 NAT 게이트웨이 A(AZ A)로, 프라이빗 서브넷 B가 NAT 게이트웨이 B(AZ B)로 연결되는 구성입니다. 단일 AZ 장애 시에도 작동하며 높은 가용성과 자동 장애 조치를 제공합니다. 프라이빗 서브넷 A는 기본적으로 NAT 게이트웨이 A를 사용하고 AZ A 장애 시 NAT 게이트웨이 B를 사용하는 방식입니다.

## 사용 사례

### 시나리오 1: 웹 애플리케이션

인터넷에서 ALB(퍼블릭 서브넷)를 통해 EC2(프라이빗 서브넷)에 접근하며, EC2는 외부 API 호출과 패키지 업데이트를 위해 NAT 게이트웨이를 사용합니다.

### 시나리오 2: 데이터베이스 서버

RDS(프라이빗 서브넷)가 패치 다운로드와 모니터링 데이터 전송을 위해 NAT 게이트웨이를 사용합니다.

### 시나리오 3: 컨테이너 서비스

ECS 작업(프라이빗 서브넷)이 이미지 다운로드와 외부 서비스 호출을 위해 NAT 게이트웨이를 사용합니다.

## 제한사항

### 1. 인바운드 연결 불가

인터넷에서 프라이빗 리소스로 직접 접근할 수 없고 아웃바운드만 지원합니다. ALB를 통한 접근이나 VPN 또는 Direct Connect를 사용해야 합니다.

### 2. VPC 피어링 제한

다른 VPC의 리소스는 NAT 게이트웨이를 사용할 수 없으며, 각 VPC에 별도 NAT 게이트웨이가 필요합니다.
