# NAT 게이트웨이

## 개요
NAT (Network Address Translation) 게이트웨이는 프라이빗 서브넷의 리소스가 인터넷에 접근할 수 있도록 하면서, 인터넷에서 프라이빗 리소스로의 직접 접근은 차단하는 관리형 서비스입니다.

## 핵심 개념

### NAT 게이트웨이란?
**정의**: 프라이빗 서브넷의 아웃바운드 인터넷 접근을 제공하는 관리형 서비스

**주요 기능**:
- 프라이빗 서브넷의 아웃바운드 인터넷 접근
- 인터넷에서 프라이빗 리소스로의 인바운드 접근 차단
- 자동 확장
- 완전 관리형

**작동 원리**:
```
프라이빗 서브넷의 EC2
  ↓ (아웃바운드 요청)
NAT 게이트웨이
  ↓ (퍼블릭 IP로 변환)
인터넷
```

### 왜 필요한가?

#### 문제: 프라이빗 서브넷의 인터넷 접근
**프라이빗 서브넷의 특징**:
- 인터넷 게이트웨이 직접 연결 불가
- 인터넷에서 직접 접근 불가
- 보안 강화

**하지만 필요한 경우**:
- 소프트웨어 업데이트
- 외부 API 호출
- 패키지 다운로드

**해결책**: NAT 게이트웨이

## NAT 게이트웨이 아키텍처

### 기본 구조
```
인터넷
  ↓
인터넷 게이트웨이
  ↓
퍼블릭 서브넷
  └── NAT 게이트웨이
      ↓
프라이빗 서브넷
  └── EC2 인스턴스
```

### 작동 흐름
```
1. 프라이빗 서브넷의 EC2가 인터넷 요청
2. 라우팅 테이블이 NAT 게이트웨이로 라우팅
3. NAT 게이트웨이가 요청을 퍼블릭 IP로 변환
4. 인터넷 게이트웨이를 통해 인터넷으로 전송
5. 응답이 NAT 게이트웨이를 통해 반환
6. EC2 인스턴스로 전달
```

## NAT 게이트웨이 vs NAT 인스턴스

### 비교표

| 항목 | NAT 게이트웨이 | NAT 인스턴스 |
|------|---------------|--------------|
| **관리** | 완전 관리형 | 사용자 관리 |
| **가용성** | 높음 (여러 AZ) | 사용자 구성 필요 |
| **확장성** | 자동 | 수동 |
| **성능** | 높음 | 인스턴스 유형에 따라 다름 |
| **비용** | 시간당 + 데이터 전송 | 인스턴스 비용 |
| **유지보수** | 불필요 | 패치 및 업데이트 필요 |

### 선택 기준

#### NAT 게이트웨이를 선택하는 경우
- 대부분의 경우 권장
- 높은 가용성 필요
- 자동 확장 필요
- 관리 부담 최소화

#### NAT 인스턴스를 선택하는 경우
- 특수한 구성 필요
- 커스텀 기능 필요
- 비용 최적화 (매우 작은 트래픽)

## NAT 게이트웨이 구성

### 1. 퍼블릭 서브넷에 배치
**필수**: NAT 게이트웨이는 퍼블릭 서브넷에 배치해야 함

**이유**:
- 인터넷 게이트웨이 접근 필요
- 퍼블릭 IP 주소 필요

### 2. Elastic IP 할당
**필수**: NAT 게이트웨이에 Elastic IP 할당

**이유**:
- 고정 IP 주소 필요
- 재시작 후에도 동일한 IP

### 3. 라우팅 테이블 구성
**프라이빗 서브넷 라우팅 테이블**:
```
0.0.0.0/0 → NAT 게이트웨이
```

**퍼블릭 서브넷 라우팅 테이블**:
```
0.0.0.0/0 → 인터넷 게이트웨이
```

## 고가용성 구성

### Multi-AZ 배포
**구성**:
```
프라이빗 서브넷 A
  ↓
NAT 게이트웨이 A (AZ A)

프라이빗 서브넷 B
  ↓
NAT 게이트웨이 B (AZ B)
```

**장점**:
- 단일 AZ 장애 시에도 작동
- 높은 가용성
- 자동 장애 조치

**라우팅 구성**:
```
프라이빗 서브넷 A
  ├── 기본 라우팅: NAT 게이트웨이 A
  └── 보조 라우팅: NAT 게이트웨이 B (AZ A 장애 시)

프라이빗 서브넷 B
  ├── 기본 라우팅: NAT 게이트웨이 B
  └── 보조 라우팅: NAT 게이트웨이 A (AZ B 장애 시)
```

### 단일 NAT 게이트웨이 (비용 최적화)
**구성**:
```
프라이빗 서브넷 A, B, C
  ↓ (모두)
단일 NAT 게이트웨이 (AZ A)
```

**주의사항**:
- AZ A 장애 시 모든 프라이빗 서브넷 영향
- 비용은 절감되지만 가용성 낮음

**권장**: 프로덕션 환경은 Multi-AZ 구성

## NAT 게이트웨이 사용 사례

### 시나리오 1: 웹 애플리케이션
```
인터넷
  ↓
ALB (퍼블릭 서브넷)
  ↓
EC2 (프라이빗 서브넷)
  ├── 외부 API 호출 → NAT 게이트웨이
  └── 패키지 업데이트 → NAT 게이트웨이
```

### 시나리오 2: 데이터베이스 서버
```
RDS (프라이빗 서브넷)
  ├── 패치 다운로드 → NAT 게이트웨이
  └── 모니터링 데이터 전송 → NAT 게이트웨이
```

### 시나리오 3: 컨테이너 서비스
```
ECS 작업 (프라이빗 서브넷)
  ├── 이미지 다운로드 → NAT 게이트웨이
  └── 외부 서비스 호출 → NAT 게이트웨이
```

## NAT 게이트웨이 제한사항

### 1. 인바운드 연결 불가
**특징**:
- 인터넷에서 프라이빗 리소스로 직접 접근 불가
- 아웃바운드만 지원

**해결책**:
- ALB를 통한 접근
- VPN 또는 Direct Connect

### 2. VPC 피어링 제한
**특징**:
- 다른 VPC의 리소스는 NAT 게이트웨이 사용 불가
- 각 VPC에 별도 NAT 게이트웨이 필요

## 모범 사례

### 1. 고가용성
- 여러 AZ에 NAT 게이트웨이 배치
- 프라이빗 서브넷별로 적절한 NAT 게이트웨이 연결

### 2. 보안
- 보안 그룹으로 액세스 제어
- 필요한 트래픽만 허용
- VPC Flow Logs로 모니터링

### 3. 비용 최적화
- 필요한 만큼만 NAT 게이트웨이 생성
- 사용하지 않는 NAT 게이트웨이 제거
- VPC 엔드포인트 고려 (AWS 서비스 접근)

### 4. 비용 절감
- AWS 서비스 접근 시 VPC 엔드포인트 사용
- NAT 게이트웨이 비용 절감
- 데이터 전송 비용 절감

## 비용

### NAT 게이트웨이 비용
- **시간당**: $0.045
- **데이터 처리**: GB당 $0.045

### 비용 최적화
- VPC 엔드포인트 사용 (AWS 서비스 접근)
- 불필요한 NAT 게이트웨이 제거
- 적절한 배치 전략

## VPC 엔드포인트와의 비교

### VPC 엔드포인트 사용 시
```
프라이빗 서브넷
  ├── S3 접근 → VPC 엔드포인트 (비용 없음)
  └── 외부 API → NAT 게이트웨이 (비용 발생)
```

**장점**:
- AWS 서비스 접근 시 비용 절감
- 더 빠른 성능
- 높은 보안

## 관련 서비스

### VPC
- 네트워크 구성
- 서브넷 및 라우팅

### VPC 엔드포인트
- AWS 서비스 접근
- NAT 게이트웨이 대체 (AWS 서비스)

### 인터넷 게이트웨이
- 퍼블릭 서브넷 인터넷 접근
- NAT 게이트웨이와 함께 사용

## 참고 자료
- [NAT 게이트웨이 공식 문서](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html)
- [NAT 게이트웨이 모범 사례](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html#nat-gateway-best-practices)

