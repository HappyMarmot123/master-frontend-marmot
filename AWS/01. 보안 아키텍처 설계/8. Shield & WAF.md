# Shield & WAF

## 개요

AWS Shield와 AWS WAF는 애플리케이션과 인프라를 보호하는 보안 서비스입니다. Shield는 DDoS 공격으로부터 보호하고, WAF는 웹 애플리케이션 레벨의 공격을 차단합니다.

## AWS Shield

### Shield란?

AWS Shield는 DDoS (Distributed Denial of Service) 공격으로부터 AWS 리소스를 보호하는 관리형 서비스입니다. DDoS 공격은 다수의 시스템에서 동시에 공격하여 서비스를 사용 불가능하게 만드는 공격으로, 대량의 트래픽으로 서버를 과부하시켜 정상 사용자가 서비스를 이용할 수 없게 만듭니다.

### Shield 작동 원리

Shield는 DDoS 공격을 자동으로 감지하고, 공격 트래픽을 필터링하여 정상 트래픽만 리소스에 도달하도록 합니다. 공격 완화가 완료되면 서비스가 정상적으로 작동합니다.

공격 유형별로 다르게 대응합니다. 볼륨 기반 공격은 대량의 트래픽으로 서버를 과부하시키는 공격인데, Shield가 공격 트래픽을 차단합니다. 프로토콜 공격은 네트워크 프로토콜 취약점을 악용하는 공격으로, Shield가 프로토콜 레벨에서 차단합니다. 애플리케이션 레벨 공격은 취약점을 악용하는 것으로, WAF와 함께 차단합니다.

## AWS WAF (Web Application Firewall)

### WAF란?

웹 애플리케이션을 보호하는 방화벽 서비스입니다. SQL Injection, Cross-Site Scripting (XSS), 지리적 제한, Rate Limiting, 커스텀 규칙 등을 통해 애플리케이션을 보호합니다.

### WAF 작동 위치

WAF는 여러 위치에 배포할 수 있습니다. CloudFront에 배포하면 전역 엣지 위치에서 보호를 제공하고, Application Load Balancer (ALB)에 배포하면 리전별로 보호를 제공합니다. API Gateway에 배포하면 API 엔드포인트를 보호하고, AppSync에 배포하면 GraphQL API를 보호합니다.

작동 흐름은 다음과 같습니다:

```
사용자 요청
  ↓
WAF (규칙 평가)
  ↓
허용 → CloudFront/ALB/API Gateway
거부 → 요청 차단
```

### WAF 구성 요소

#### 1. 웹 ACL (Web Access Control List)

웹 ACL은 WAF 규칙의 컨테이너입니다. 여러 규칙을 그룹화하고, 규칙 평가 순서를 정의하며, 기본 동작(Allow/Deny)을 설정합니다.

#### 2. 규칙 (Rules)

규칙은 특정 조건에 따라 요청을 허용하거나 거부하는 규칙입니다. 규칙 유형은 세 가지가 있습니다. 첫 번째는 AWS 관리형 규칙으로, AWS에서 제공하는 사전 구성된 규칙이며 일반적인 공격 패턴을 차단합니다. 예를 들어 SQL Injection, XSS를 차단합니다. 두 번째는 AWS Marketplace 규칙으로, 서드파티가 제공하는 규칙이며 특수한 보안 요구사항에 대응합니다. 세 번째는 커스텀 규칙으로, 사용자가 직접 작성하며 특정 요구사항에 맞춥니다.

#### 3. 규칙 그룹 (Rule Groups)

규칙 그룹은 관련 규칙들을 그룹화하는 기능입니다. 규칙 관리를 간소화하고 재사용 가능한 규칙 세트를 만들 수 있습니다.

### WAF 규칙 평가 순서

WAF는 규칙 우선순위 순서대로 평가합니다. 규칙이 일치하면 해당 Action을 실행하고, 일치하는 규칙이 없으면 기본 Action을 실행합니다.

Action 유형은 세 가지가 있습니다. Allow는 요청을 허용하고, Block은 요청을 차단하며, Count는 요청을 허용하지만 로깅합니다.

예시:

```
규칙 1 (우선순위 1): SQL Injection 차단 → Block
규칙 2 (우선순위 2): 특정 국가 차단 → Block
규칙 3 (우선순위 3): Rate Limiting → Block
기본 Action: Allow

요청 평가:
- SQL Injection 패턴 발견 → 규칙 1 일치 → Block
- 정상 요청 → 모든 규칙 불일치 → 기본 Action (Allow)
```

### Shield와 WAF 통합 시나리오

Shield와 WAF를 통합하여 다층 보안으로 강력한 보호를 제공할 수 있습니다. Shield Advanced는 인프라 레벨 DDoS 보호를 제공하고 네트워크 레벨 공격을 차단합니다. WAF는 애플리케이션 레벨 보호를 제공하며 SQL Injection, XSS 등을 차단하고 Rate Limiting을 수행합니다. CloudFront는 엣지 위치에서 보호를 제공하며 전 세계 사용자에게 빠른 응답을 제공합니다.

작동 흐름은 다음과 같습니다:

```
공격 시도
  ↓
Shield: 네트워크 레벨 공격 차단
  ↓
WAF: 애플리케이션 레벨 공격 차단
  ↓
정상 요청만 애플리케이션에 도달
```
