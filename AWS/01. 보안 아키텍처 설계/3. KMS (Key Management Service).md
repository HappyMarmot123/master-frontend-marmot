# KMS (Key Management Service)

## 개요
AWS Key Management Service (KMS)는 암호화 키를 생성하고 관리하는 관리형 서비스입니다. 데이터 암호화 및 암호화 키 관리에 사용됩니다.

## 핵심 개념

### 암호화 키 유형

#### 1. AWS 관리형 키 (AWS Managed Keys)
- **정의**: AWS가 자동으로 생성하고 관리하는 키
- **특징**:
  - 특정 AWS 서비스에서 자동 사용
  - 사용자가 직접 관리 불가
  - 예: S3 SSE-S3, EBS 기본 암호화

#### 2. 고객 관리형 키 (Customer Managed Keys, CMK)
- **정의**: 사용자가 생성하고 관리하는 키
- **특징**:
  - 키 정책으로 액세스 제어
  - 키 로테이션 설정 가능
  - 키 사용 감사 가능
  - 예: S3 SSE-KMS, RDS 암호화

#### 3. 고객 제공 키 (Customer Provided Keys)
- **정의**: 사용자가 외부에서 제공하는 키
- **특징**:
  - AWS 외부에서 키 관리
  - 예: S3 SSE-C

### 키 정책 (Key Policy)
- **정의**: CMK에 대한 액세스를 제어하는 리소스 정책
- **특징**:
  - 기본 키 정책: 계정 루트 사용자에게 모든 권한
  - IAM 정책과 함께 사용 가능
  - 키 정책이 최우선

### 키 로테이션
- **자동 로테이션**: 연간 자동 키 교체
- **수동 로테이션**: 사용자가 직접 새 키 생성
- **이전 키**: 이전 키로 암호화된 데이터 복호화 가능

## 사용 사례

### 1. S3 버킷 암호화
- SSE-KMS를 사용하여 버킷 암호화
- 버킷별로 다른 CMK 사용 가능
- 키 정책으로 액세스 제어

### 2. EBS 볼륨 암호화
- 볼륨 생성 시 CMK 지정
- 스냅샷도 자동 암호화
- 인스턴스 간 볼륨 복사 시 암호화 유지

### 3. RDS 데이터베이스 암호화
- 데이터베이스 생성 시 암호화 활성화
- 암호화된 스냅샷에서 복원 가능
- 읽기 전용 복제본도 암호화 가능

### 4. 애플리케이션 레벨 암호화
- 애플리케이션에서 KMS API 호출
- 데이터 암호화/복호화
- Envelope Encryption 패턴

## 시험 포인트

1. **암호화 옵션 비교**
   - **SSE-S3**: AWS 관리형 키, 무료
   - **SSE-KMS**: 고객 관리형 키, 키 사용당 비용
   - **SSE-C**: 고객 제공 키, 키 관리 책임

2. **키 정책 vs IAM 정책**
   - 키 정책: CMK에 대한 직접 액세스 제어
   - IAM 정책: 사용자/역할의 KMS API 호출 권한
   - 둘 다 허용해야 키 사용 가능

3. **키 로테이션**
   - 자동 로테이션: 연 1회
   - 이전 키로 암호화된 데이터는 계속 복호화 가능
   - 새 데이터는 새 키로 암호화

4. **비용**
   - CMK 생성: 무료
   - 키 사용: 요청당 비용
   - 키 저장: 무료

5. **리전별 독립성**
   - 각 리전의 키는 독립적
   - 리전 간 키 공유 불가
   - 리전 간 데이터 복사 시 재암호화 필요

## 모범 사례

1. **최소 권한 원칙**
   - 키 정책에서 필요한 사용자/역할만 허용
   - 키 사용 권한과 키 관리 권한 분리

2. **키 로테이션**
   - 자동 로테이션 활성화
   - 정기적인 키 사용 감사

3. **키 별칭 사용**
   - 키 ID 대신 별칭 사용
   - 키 로테이션 시 별칭은 유지

4. **Envelope Encryption**
   - 대용량 데이터는 데이터 키로 암호화
   - 데이터 키는 CMK로 암호화
   - 성능 및 비용 최적화

5. **CloudTrail 통합**
   - 모든 KMS API 호출 로깅
   - 키 사용 모니터링 및 감사

## Envelope Encryption 패턴

```
1. CMK로 데이터 키 생성
2. 데이터 키로 데이터 암호화
3. 암호화된 데이터 키를 데이터와 함께 저장
4. 복호화 시: CMK로 데이터 키 복호화 → 데이터 키로 데이터 복호화
```

## 관련 서비스
- **Secrets Manager**: 암호화된 시크릿 저장 (KMS 사용)
- **CloudHSM**: 하드웨어 보안 모듈 (더 높은 보안 요구사항)
- **CloudTrail**: KMS API 호출 로깅
- **S3, EBS, RDS**: KMS를 사용한 암호화

## 참고 자료
- [KMS 공식 문서](https://docs.aws.amazon.com/kms/)
- [KMS 모범 사례](https://docs.aws.amazon.com/kms/latest/developerguide/best-practices.html)
- [Envelope Encryption](https://docs.aws.amazon.com/encryption-sdk/latest/developer-guide/concepts.html#envelope-encryption)

