# GuardDuty

## 개요
Amazon GuardDuty는 AWS 계정, 워크로드, S3에 저장된 데이터를 지속적으로 모니터링하여 위협을 탐지하는 위협 탐지 서비스입니다. 머신러닝을 사용하여 비정상적인 활동을 자동으로 식별합니다.

## 핵심 개념

### GuardDuty란?
**정의**: 지능형 위협 탐지 서비스

**주요 기능**:
- 지속적인 모니터링
- 자동 위협 탐지
- 머신러닝 기반 분석
- 위협 인텔리전스

**작동 원리**:
```
AWS 리소스 활동
  ↓
CloudTrail, VPC Flow Logs, DNS Logs
  ↓
GuardDuty 분석
  ↓
위협 탐지 및 알림
```

### 위협 탐지 소스

#### 1. CloudTrail 이벤트
**정의**: API 호출 로그 분석

**탐지 가능한 위협**:
- 비정상적인 API 호출
- 권한 에스컬레이션
- 데이터 유출 시도
- 계정 탈취

**예시**:
- 알 수 없는 리전에서 API 호출
- 비정상적인 시간대 활동
- 실패한 로그인 시도

#### 2. VPC Flow Logs
**정의**: 네트워크 트래픽 로그 분석

**탐지 가능한 위협**:
- 포트 스캔
- DDoS 공격
- 비정상적인 트래픽 패턴
- 알려진 악성 IP와의 통신

**예시**:
- 알려진 악성 IP에서의 연결 시도
- 비정상적인 포트 스캔
- 대량의 트래픽

#### 3. DNS Logs
**정의**: DNS 쿼리 로그 분석

**탐지 가능한 위협**:
- 데이터 유출 (DNS 터널링)
- 악성 도메인 접근
- 비정상적인 DNS 쿼리

**예시**:
- 악성 도메인으로의 DNS 쿼리
- 비정상적인 DNS 패턴
- 데이터 유출 시도

## GuardDuty 탐지 결과

### 심각도 레벨

#### 1. 높음 (High)
**정의**: 즉시 조치가 필요한 심각한 위협

**예시**:
- 계정 탈취
- 데이터 유출
- 악성 소프트웨어 설치

**대응**:
- 즉시 조사
- 영향받는 리소스 격리
- 자격 증명 재설정

#### 2. 중간 (Medium)
**정의**: 주의가 필요한 위협

**예시**:
- 비정상적인 API 호출
- 의심스러운 네트워크 활동
- 권한 에스컬레이션 시도

**대응**:
- 조사 및 검증
- 필요 시 조치

#### 3. 낮음 (Low)
**정의**: 모니터링이 필요한 활동

**예시**:
- 비정상적인 패턴
- 정보 수집 활동

**대응**:
- 모니터링
- 필요 시 조사

### 탐지 결과 유형

#### 1. 계정 탈취 (Account Compromise)
**정의**: 계정이 무단으로 사용되고 있음

**탐지 신호**:
- 알 수 없는 리전에서 API 호출
- 비정상적인 시간대 활동
- 권한 에스컬레이션

#### 2. 인스턴스 탈취 (Instance Compromise)
**정의**: EC2 인스턴스가 손상됨

**탐지 신호**:
- 악성 IP와의 통신
- 비정상적인 네트워크 트래픽
- 포트 스캔

#### 3. 버킷 탈취 (Bucket Compromise)
**정의**: S3 버킷이 무단으로 액세스됨

**탐지 신호**:
- 비정상적인 버킷 액세스
- 대량 데이터 다운로드
- 퍼블릭 액세스 설정 변경

## GuardDuty 설정

### 활성화
**과정**:
```
1. GuardDuty 활성화
2. 데이터 소스 선택
   - CloudTrail
   - VPC Flow Logs
   - DNS Logs
3. 알림 설정
4. 자동 응답 설정 (선택)
```

### 멀티 계정 설정
**구조**:
```
관리 계정 (GuardDuty 활성화)
  ├── 멤버 계정 1 (자동 위임)
  ├── 멤버 계정 2 (자동 위임)
  └── 멤버 계정 3 (자동 위임)
```

**장점**:
- 중앙 집중식 모니터링
- 조직 전체 위협 탐지
- 통합 관리

## GuardDuty와 EventBridge 통합

### 자동 응답
**구조**:
```
GuardDuty 위협 탐지
  ↓
EventBridge 이벤트
  ↓
Lambda 함수
  ├── 영향받는 리소스 격리
  ├── 알림 전송
  └── 자격 증명 재설정
```

**예시**:
```
위협 탐지: 계정 탈취
  ↓
EventBridge
  ↓
Lambda 함수
  ├── IAM 사용자 비활성화
  ├── SNS로 알림 전송
  └── CloudWatch 알람 생성
```

## 모범 사례

### 1. 모든 계정 활성화
- 모든 AWS 계정에서 GuardDuty 활성화
- 멀티 계정 환경에서 중앙 관리

### 2. 정기적인 검토
- 탐지 결과 정기 검토
- False Positive 분석
- 위협 패턴 파악

### 3. 자동 응답
- EventBridge와 통합
- 자동 격리 및 알림
- 빠른 대응

### 4. 알림 설정
- 중요한 위협에 대한 즉시 알림
- 적절한 채널 사용 (이메일, SNS, Slack)

## 비용

### GuardDuty 비용
- **CloudTrail 이벤트 분석**: 100만 이벤트당 $1.00
- **VPC Flow Logs 분석**: GB당 $0.50
- **DNS Logs 분석**: GB당 $0.50

### 비용 최적화
- 필요한 데이터 소스만 활성화
- 불필요한 로그 필터링
- 멀티 계정 환경에서 통합 관리

## 관련 서비스

### CloudTrail
- API 호출 로깅
- GuardDuty 데이터 소스

### VPC Flow Logs
- 네트워크 트래픽 로깅
- GuardDuty 데이터 소스

### EventBridge
- 자동 응답
- 이벤트 라우팅

### Security Hub
- 보안 이벤트 통합
- GuardDuty 결과 통합

## 참고 자료
- [GuardDuty 공식 문서](https://docs.aws.amazon.com/guardduty/)
- [GuardDuty 모범 사례](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_best-practices.html)

