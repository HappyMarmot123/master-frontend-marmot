# GuardDuty

## 개요

Amazon GuardDuty는 AWS 계정, 워크로드, S3에 저장된 데이터를 지속적으로 모니터링하여 위협을 탐지하는 지능형 위협 탐지 서비스입니다. 지속적인 모니터링, 자동 위협 탐지, 머신러닝 기반 분석, 위협 인텔리전스 기능을 제공합니다. AWS 리소스 활동이 CloudTrail, VPC Flow Logs, DNS Logs로 수집되면 GuardDuty가 분석하여 위협을 탐지하고 알림을 전송합니다.

### 위협 탐지 소스

#### 1. CloudTrail 이벤트

CloudTrail 이벤트는 API 호출 로그를 분석합니다. 비정상적인 API 호출, 권한 에스컬레이션, 데이터 유출 시도, 계정 탈취를 탐지할 수 있습니다.

#### 2. VPC Flow Logs

VPC Flow Logs는 네트워크 트래픽 로그를 분석합니다. 포트 스캔, DDoS 공격, 비정상적인 트래픽 패턴, 알려진 악성 IP와의 통신을 탐지할 수 있습니다.

#### 3. DNS Logs

DNS Logs는 DNS 쿼리 로그를 분석합니다. 데이터 유출(DNS 터널링), 악성 도메인 접근, 비정상적인 DNS 쿼리를 탐지할 수 있습니다.

## GuardDuty 탐지 결과

### 심각도 레벨

#### 1. 높음 (High)

즉시 조치가 필요한 심각한 위협입니다. 계정 탈취, 데이터 유출, 악성 소프트웨어 설치 등이 예시입니다. 즉시 조사하고, 영향받는 리소스를 격리하며, 자격 증명을 재설정해야 합니다.

#### 2. 중간 (Medium)

주의가 필요한 위협입니다. 비정상적인 API 호출, 의심스러운 네트워크 활동, 권한 에스컬레이션 시도 등이 예시입니다. 조사 및 검증을 수행하고 필요 시 조치를 취해야 합니다.

#### 3. 낮음 (Low)

모니터링이 필요한 활동입니다. 비정상적인 패턴, 정보 수집 활동 등이 예시입니다. 모니터링을 수행하고 필요 시 조사해야 합니다.

### 탐지 결과 유형

#### 1. 계정 탈취 (Account Compromise)

#### 2. 인스턴스 탈취 (Instance Compromise)

#### 3. 버킷 탈취 (Bucket Compromise)

## GuardDuty 설정

### 활성화

GuardDuty를 활성화하려면 데이터 소스(CloudTrail, VPC Flow Logs, DNS Logs)를 선택한 후, 알림을 설정하고, 필요 시 자동 응답을 설정합니다.

### 멀티 계정 설정

멀티 계정 설정은 관리 계정에서 GuardDuty를 활성화하고 멤버 계정들을 자동으로 위임하는 구조입니다. 중앙 집중식 모니터링, 조직 전체 위협 탐지, 통합 관리의 장점이 있습니다.

## GuardDuty와 EventBridge 통합

### 자동 응답

GuardDuty가 위협을 탐지하면 EventBridge 이벤트가 발생하고, Lambda 함수가 실행되어 영향받는 리소스를 격리하고, 알림을 전송하며, 자격 증명을 재설정합니다. 예를 들어, 계정 탈취 위협이 탐지되면 Lambda 함수가 IAM 사용자를 비활성화하고, SNS로 알림을 전송하며, CloudWatch 알람을 생성합니다.
