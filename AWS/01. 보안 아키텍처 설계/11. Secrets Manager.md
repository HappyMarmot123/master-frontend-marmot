# Secrets Manager

## 개요

AWS Secrets Manager는 데이터베이스 자격 증명, API 키, OAuth 토큰, 암호화 키 등 민감한 정보인 시크릿을 안전하게 저장하고 관리하는 서비스입니다. 시크릿 저장 및 암호화, 자동 로테이션, 액세스 제어, 감사 및 모니터링 기능을 제공합니다. 애플리케이션이 API를 호출하면 Secrets Manager가 KMS로 암호화된 시크릿을 반환합니다.

## Secrets Manager 주요 기능

### 1. 시크릿 저장

시크릿은 암호화되어 저장되며, JSON 형식의 키-값 쌍으로 구조화된 데이터를 저장할 수 있습니다. 예를 들어, 데이터베이스 자격 증명은 다음과 같이 저장됩니다:

```json
{
  "username": "admin",
  "password": "secret123",
  "host": "database.example.com",
  "port": 3306
}
```

### 2. 자동 로테이션

자동 로테이션은 시크릿을 주기적으로 자동 교체하는 기능입니다. 일, 주, 월 단위로 설정할 수 있으며, Lambda 함수로 구현됩니다. 로테이션 일정이 도래하면 Lambda 함수가 실행되어 새 자격 증명을 생성하고, 서비스에 새 자격 증명을 적용한 후 시크릿을 업데이트하고 이전 자격 증명을 비활성화합니다. RDS (MySQL, PostgreSQL, MariaDB, Oracle, SQL Server), DocumentDB, Redshift를 지원하며, Lambda 함수로 커스텀 구현도 가능합니다.

### 3. 버전 관리

버전 관리는 시크릿의 여러 버전을 유지하는 기능입니다. 이전 버전을 보관하고, 특정 버전으로 액세스할 수 있으며, 롤백이 가능합니다. 버전 레이블은 AWSCURRENT(현재 버전), AWSPREVIOUS(이전 버전), 커스텀 레이블을 사용할 수 있습니다.

### 4. 액세스 제어

GetSecretValue - 시크릿 값 읽기
PutSecretValue - 시크릿 값 업데이트
DescribeSecret - 시크릿 메타데이터 조회
RotateSecret - 시크릿 로테이션 권한

## Secrets Manager vs Systems Manager Parameter Store

### 비교표

| 항목              | Secrets Manager   | Parameter Store                  |
| ----------------- | ----------------- | -------------------------------- |
| **자동 로테이션** | 지원              | 미지원                           |
| **비용**          | 시크릿당 월 $0.40 | 무료 (Standard), 유료 (Advanced) |
| **크기 제한**     | 64KB              | 4KB (Standard), 8KB (Advanced)   |
| **버전 관리**     | 지원              | 지원                             |
| **암호화**        | KMS 필수          | 선택적                           |
| **사용 사례**     | 자격 증명, API 키 | 설정 값, 일반 파라미터           |

### 선택 기준

Secrets Manager는 자동 로테이션이 필요한 자격 증명이나 데이터베이스 자격 증명, API 키, 높은 보안이 필요한 경우에 선택합니다. Parameter Store는 일반 설정 값이나 자동 로테이션이 불필요한 경우, 비용 최적화가 필요한 경우, 작은 값(4KB 이하)을 저장하는 경우에 선택합니다.

## 사용 사례

### 시나리오 1: 데이터베이스 자격 증명 관리

애플리케이션이 GetSecretValue API를 호출하여 Secrets Manager에서 RDS 자격 증명을 가져와 RDS 데이터베이스에 접근합니다. 자동 로테이션이 활성화되면 Lambda 함수가 주기적으로 실행되어 RDS에서 새 비밀번호를 생성하고, RDS 비밀번호를 변경한 후 Secrets Manager를 업데이트하며, 애플리케이션은 자동으로 새 자격 증명을 사용합니다.

### 시나리오 2: API 키 및 마이크로서비스 인증

애플리케이션이 Secrets Manager에서 외부 API 키를 가져와 호출하거나, 마이크로서비스 간 인증을 위해 서비스 A가 공유 토큰을 가져와 서비스 B를 인증할 수 있습니다.

## 자동 로테이션 설정

Secrets Manager에서 RDS 자격 증명을 저장하고, 자동 로테이션을 활성화한 후, AWS 제공 또는 커스텀 Lambda 함수를 선택하고, 로테이션 일정을 설정합니다(예: 30일마다). 로테이션 트리거가 발생하면 Lambda 함수가 실행되어 다음과 같이 진행됩니다. 이 과정에서 서비스의 비밀번호가 변경되고 Secrets Manager가 업데이트되며 이전 비밀번호가 비활성화됩니다.

1. 새 자격 증명 생성(createSecret)
2. 새 자격 증명 설정(setSecret)
3. 새 자격 증명 테스트(testSecret)
4. 로테이션 완료(finishSecret)
