# 재해 복구 전략 (DR)

## 개요
재해 복구(Disaster Recovery)는 자연 재해, 인적 오류, 사이버 공격 등으로 인한 시스템 중단에서 복구하는 전략입니다.

## 핵심 개념

### RPO (Recovery Point Objective)
- **정의**: 허용 가능한 데이터 손실량
- **의미**: 마지막 백업 시점부터 장애 발생 시점까지의 시간
- **예시**: RPO 1시간 = 최대 1시간 분량의 데이터 손실 허용

### RTO (Recovery Time Objective)
- **정의**: 허용 가능한 다운타임
- **의미**: 장애 발생부터 시스템 복구까지의 시간
- **예시**: RTO 4시간 = 4시간 이내에 시스템 복구 필요

## 재해 복구 전략 (4가지)

### 1. 백업 및 복원 (Backup and Restore)
**정의**: 정기적으로 백업을 수행하고, 장애 발생 시 백업에서 복원하는 전략

**RPO/RTO**:
- **RPO**: 수시간 ~ 수일 (백업 주기에 따라 다름)
- **RTO**: 수시간 ~ 수일 (복원 시간)

**비용**: 가장 낮음

**구현 방법**:
- 정기적인 스냅샷/백업 (일일 또는 주간)
- 백업을 다른 리전에 복사
- 필요 시 수동으로 복원
- 인프라 재구성 필요

**구성 예시**:
```
Primary Region (서울)
  - RDS 스냅샷 (일일)
  - EBS 스냅샷 (주간)
  - S3 버전 관리

DR Region (도쿄)
  - 스냅샷 복사본 저장
  - 필요 시 수동 복원
```

**장점**:
- 비용이 가장 낮음
- 구현이 간단
- 장기 보관 가능

**단점**:
- RPO/RTO가 길음
- 수동 개입 필요
- 데이터 손실 가능

**사용 사례**:
- 중요하지 않은 워크로드
- 개발/테스트 환경
- 장기 보관이 필요한 데이터

### 2. 파일럿 라이트 (Pilot Light)
**정의**: 핵심 구성 요소만 DR 리전에 미리 구성하고, 나머지는 필요 시 확장하는 전략

**RPO/RTO**:
- **RPO**: 수분 ~ 수시간 (복제 지연 시간)
- **RTO**: 수분 ~ 수십분 (확장 시간)

**비용**: 낮음 (최소 리소스만 운영)

**구현 방법**:
- 핵심 데이터베이스만 복제 (RDS 읽기 전용 복제본)
- 애플리케이션 서버는 최소 구성 (예: t2.micro 1대)
- Auto Scaling 그룹 준비
- CloudFormation 템플릿 준비

**구성 예시**:
```
Primary Region (서울)
  - 완전한 프로덕션 환경
  - RDS Primary
  - EC2 인스턴스 (프로덕션 규모)

DR Region (도쿄)
  - RDS Read Replica (파일럿 라이트)
  - EC2 인스턴스 1대 (최소 구성)
  - Auto Scaling 그룹 (최소 크기: 1, 최대 크기: 10)
```

**장애 조치 과정**:
```
1. Primary Region 장애 감지
2. Read Replica를 Primary로 승격
3. Auto Scaling 그룹 확장 (1 → 10)
4. Route 53 DNS 변경
5. 서비스 복구 완료
```

**장점**:
- 비용 효율적 (최소 리소스만 운영)
- 빠른 복구 가능
- 핵심 데이터 보호

**단점**:
- 확장 시간 필요
- 일부 데이터 손실 가능

**사용 사례**:
- 중간 중요도 워크로드
- 비용 제약이 있는 경우
- RTO가 수십 분 허용 가능한 경우

### 3. 웜 대기 (Warm Standby)
**정의**: 완전한 환경을 축소된 규모로 DR 리전에 운영하고, 장애 시 즉시 확장하는 전략

**RPO/RTO**:
- **RPO**: 수분 (실시간 복제 지연)
- **RTO**: 수분 (확장 시간)

**비용**: 중간 (축소된 규모로 운영)

**구현 방법**:
- 완전한 환경을 축소된 규모로 운영 (예: 50% 용량)
- 데이터 실시간 복제 (RDS Multi-AZ 또는 읽기 전용 복제본)
- Auto Scaling 그룹 준비 (최소 크기: 프로덕션의 50%)
- 정기적인 테스트 수행

**구성 예시**:
```
Primary Region (서울)
  - EC2 인스턴스 10대
  - RDS Primary
  - ALB

DR Region (도쿄)
  - EC2 인스턴스 5대 (50% 규모)
  - RDS Read Replica (실시간 복제)
  - ALB (준비 상태)
```

**장애 조치 과정**:
```
1. Primary Region 장애 감지
2. Read Replica를 Primary로 승격
3. Auto Scaling 그룹 확장 (5 → 10)
4. Route 53 DNS 변경
5. 서비스 복구 완료 (수분 내)
```

**장점**:
- 빠른 복구 (수분 내)
- 완전한 환경 준비
- 정기적인 테스트 가능

**단점**:
- 파일럿 라이트보다 비용 높음
- 일부 데이터 손실 가능 (복제 지연)

**사용 사례**:
- 중요 워크로드
- RTO가 수분 허용 가능한 경우
- 정기적인 DR 테스트가 필요한 경우

### 4. 액티브-액티브 (Multi-Site Active/Active)
**정의**: 여러 리전에서 동시에 운영하고, 자동으로 장애 조치하는 전략

**RPO/RTO**:
- **RPO**: 0 (실시간 복제, 데이터 손실 없음)
- **RTO**: 거의 0 (자동 장애 조치)

**비용**: 가장 높음 (여러 리전에서 완전한 환경 운영)

**구현 방법**:
- 여러 리전에서 완전한 환경 동시 운영
- 실시간 데이터 복제 (DynamoDB Global Table, RDS 읽기 전용 복제본)
- 자동 장애 조치 (Route 53 Health Check)
- 로드 밸런싱 (트래픽 분산)

**구성 예시**:
```
Region 1 (서울)
  - 완전한 프로덕션 환경
  - DynamoDB Global Table
  - Route 53 가중치: 50%

Region 2 (도쿄)
  - 완전한 프로덕션 환경
  - DynamoDB Global Table (실시간 복제)
  - Route 53 가중치: 50%
```

**장애 조치 과정**:
```
1. Region 1 장애 감지 (Route 53 Health Check)
2. Route 53이 자동으로 Region 2로 트래픽 라우팅
3. Region 2가 모든 트래픽 처리
4. Region 1 복구 후 자동으로 트래픽 분산
```

**장점**:
- 데이터 손실 없음 (RPO = 0)
- 거의 즉시 복구 (RTO ≈ 0)
- 고가용성 보장
- 지리적 분산 (지연 시간 최소화)

**단점**:
- 가장 높은 비용
- 복잡한 구성
- 데이터 일관성 관리 필요

**사용 사례**:
- 매우 중요한 워크로드
- 데이터 손실을 허용할 수 없는 경우
- 다운타임을 최소화해야 하는 경우
- 글로벌 사용자 서비스

## 전략 선택 기준

### RPO/RTO 요구사항에 따른 선택

**RPO/RTO가 긴 경우 (수시간 ~ 수일)**:
→ **백업 및 복원**
- 비용이 가장 낮음
- 구현이 간단
- 데이터 손실 허용 가능

**RPO/RTO가 중간인 경우 (수분 ~ 수십분)**:
→ **파일럿 라이트 또는 웜 대기**
- 비용과 성능의 균형
- 파일럿 라이트: 더 낮은 비용, 더 긴 RTO
- 웜 대기: 더 높은 비용, 더 짧은 RTO

**RPO/RTO가 짧은 경우 (수분 이하)**:
→ **웜 대기 또는 액티브-액티브**
- 웜 대기: 중간 비용, 수분 RTO
- 액티브-액티브: 높은 비용, 거의 0 RTO

**데이터 손실을 허용할 수 없는 경우**:
→ **액티브-액티브**
- RPO = 0 (실시간 복제)
- 가장 높은 비용

### 비용 비교표

| 전략 | 월 비용 (예시) | RPO | RTO |
|------|---------------|-----|-----|
| 백업 및 복원 | $100 | 수시간~수일 | 수시간~수일 |
| 파일럿 라이트 | $500 | 수분~수시간 | 수분~수십분 |
| 웜 대기 | $2,000 | 수분 | 수분 |
| 액티브-액티브 | $10,000+ | 0 | 거의 0 |

## 비교표

| 전략 | RPO | RTO | 비용 | 복잡도 |
|------|-----|-----|------|--------|
| 백업 및 복원 | 수시간~수일 | 수시간~수일 | 낮음 | 낮음 |
| 파일럿 라이트 | 수분~수시간 | 수분~수십분 | 낮음 | 중간 |
| 웜 대기 | 수분 | 수분 | 중간 | 중간 |
| 액티브-액티브 | 0 | 거의 0 | 높음 | 높음 |

## 구현 방법

### 1. 데이터 복제
- **RDS**: 읽기 전용 복제본, Multi-AZ
- **DynamoDB**: 글로벌 테이블
- **S3**: Cross-Region Replication
- **EBS**: 스냅샷 복사

### 2. 네트워크 라우팅
- **Route 53**: Health Check 기반 장애 조치
- **CloudFront**: 여러 오리진 설정
- **Global Accelerator**: 자동 장애 조치

### 3. 인프라 자동화
- **CloudFormation**: 인프라 코드화
- **AMI**: 표준화된 이미지
- **Auto Scaling**: 자동 확장

## 시험 포인트

1. **전략 선택 기준**
   - RPO/RTO 요구사항
   - 비용 제약
   - 복잡도 허용 범위

2. **RDS 재해 복구**
   - **Multi-AZ**: 자동 장애 조치 (단일 리전)
   - **읽기 전용 복제본**: 다른 리전에 수동 장애 조치
   - **스냅샷**: 백업 및 복원

3. **S3 재해 복구**
   - **Cross-Region Replication**: 실시간 복제
   - **버전 관리**: 이전 버전 복원
   - **수명 주기 정책**: 자동 백업

4. **Route 53 장애 조치**
   - Health Check 기반 라우팅
   - Primary/Secondary 설정
   - 자동 장애 조치

5. **비용 최적화**
   - 파일럿 라이트: 최소 리소스로 대기
   - 스팟 인스턴스: DR 환경에 사용
   - 예약형 인스턴스: DR 리전에 사용

## 모범 사례

1. **정기적 테스트**
   - DR 계획 정기적으로 테스트
   - RTO/RPO 검증
   - 절차 문서화

2. **자동화**
   - 가능한 한 자동화 구현
   - 수동 작업 최소화
   - CloudFormation으로 인프라 관리

3. **모니터링**
   - CloudWatch로 복제 상태 모니터링
   - 알람 설정
   - 정기적인 백업 검증

4. **다중 리전**
   - 최소 2개 리전에 리소스 배포
   - 지리적 분산
   - 규정 준수 고려

5. **데이터 일관성**
   - 트랜잭션 일관성 보장
   - 충돌 해결 전략
   - 데이터 검증

## 재해 복구 아키텍처 예시

### 파일럿 라이트 예시
```
Primary Region (서울)
  - RDS Primary
  - EC2 (프로덕션)
  
DR Region (도쿄)
  - RDS Read Replica (파일럿 라이트)
  - EC2 (최소 구성, Auto Scaling 준비)
  - Route 53 Health Check
```

### 액티브-액티브 예시
```
Region 1 (서울)
  - 완전한 환경
  - Route 53 가중치: 50%
  
Region 2 (도쿄)
  - 완전한 환경
  - Route 53 가중치: 50%
  - DynamoDB Global Table
```

## 관련 서비스
- **Route 53**: DNS 기반 장애 조치
- **RDS**: Multi-AZ, 읽기 전용 복제본
- **S3**: Cross-Region Replication
- **CloudFormation**: 인프라 자동화
- **CloudWatch**: 모니터링 및 알람

## 참고 자료
- [AWS 재해 복구](https://aws.amazon.com/disaster-recovery/)
- [재해 복구 백서](https://aws.amazon.com/blogs/architecture/disaster-recovery-dr-architecture-on-aws-part-i-strategies-for-recovery-in-the-cloud/)

