# 마이크로서비스 아키텍처

## 개요
마이크로서비스 아키텍처는 애플리케이션을 작은 독립적인 서비스로 분해하는 아키텍처 패턴입니다. 각 서비스는 독립적으로 개발, 배포, 확장할 수 있습니다.

## 핵심 개념

### 마이크로서비스란?
**정의**: 애플리케이션을 작은 독립적인 서비스로 분해하는 아키텍처 스타일

**특징**:
- 각 서비스는 독립적으로 배포 가능
- 서비스 간 느슨한 결합
- 각 서비스는 자체 데이터베이스 보유 가능
- 서비스별로 다른 기술 스택 사용 가능

### 모놀리식 vs 마이크로서비스

#### 모놀리식 아키텍처
**정의**: 모든 기능이 하나의 애플리케이션에 포함된 구조

**특징**:
- 단일 배포 단위
- 강한 결합
- 공유 데이터베이스
- 단일 기술 스택

**장점**:
- 간단한 개발 및 배포
- 트랜잭션 관리 용이
- 디버깅 용이

**단점**:
- 확장 어려움
- 기술 스택 변경 어려움
- 서비스 간 영향

#### 마이크로서비스 아키텍처
**정의**: 애플리케이션을 작은 독립적인 서비스로 분해

**특징**:
- 여러 배포 단위
- 느슨한 결합
- 서비스별 데이터베이스
- 다양한 기술 스택

**장점**:
- 독립적 확장
- 기술 스택 다양성
- 서비스별 배포
- 장애 격리

**단점**:
- 복잡한 운영
- 분산 시스템 복잡성
- 네트워크 지연
- 데이터 일관성 관리

## 스테이트리스 vs 스테이트풀

### 스테이트리스 (Stateless)
**정의**: 서버가 클라이언트의 상태 정보를 저장하지 않는 아키텍처

**특징**:
- 각 요청이 독립적
- 서버 간 상태 공유 불필요
- 수평 확장 용이
- 로드 밸런싱 간단

**예시**:
```
요청 1: 서버 A 처리
요청 2: 서버 B 처리 (서버 A의 상태 정보 불필요)
요청 3: 서버 C 처리
```

**장점**:
- 확장성 우수
- 장애 복구 용이
- 로드 밸런싱 간단

**단점**:
- 상태 정보는 외부 저장소 필요 (세션 저장소 등)

**AWS 서비스 예시**:
- Lambda (완전 스테이트리스)
- EC2 (애플리케이션을 스테이트리스로 설계)
- API Gateway

### 스테이트풀 (Stateful)
**정의**: 서버가 클라이언트의 상태 정보를 저장하는 아키텍처

**특징**:
- 서버 간 상태 공유 필요
- 특정 서버에 고정 (Sticky Session)
- 수평 확장 어려움
- 로드 밸런싱 복잡

**예시**:
```
요청 1: 서버 A 처리 (상태 저장)
요청 2: 서버 A 처리 (이전 상태 필요)
요청 3: 서버 A 처리
```

**장점**:
- 상태 정보 관리 용이
- 성능 최적화 가능

**단점**:
- 확장 어려움
- 장애 시 상태 손실
- 로드 밸런싱 제한

**AWS 서비스 예시**:
- RDS (데이터베이스 상태 저장)
- ElastiCache (세션 저장)
- EBS (영구 스토리지)

### 마이크로서비스에서의 선택

**스테이트리스 권장**:
- 대부분의 마이크로서비스는 스테이트리스로 설계
- 확장성과 가용성 우선

**스테이트풀 사용 시**:
- 상태 정보는 외부 저장소에 저장
  - ElastiCache (세션)
  - DynamoDB (사용자 상태)
  - RDS (영구 데이터)

**예시 아키텍처**:
```
스테이트리스 서비스 (Lambda, ECS)
  ↓
ElastiCache (세션 저장)
  ↓
RDS (영구 데이터)
```

## 마이크로서비스 통신 패턴

### 1. 동기 통신
**정의**: 요청-응답 패턴, 즉시 응답 대기

**예시**:
- HTTP/REST API
- gRPC

**장점**:
- 간단한 구현
- 즉시 응답 확인

**단점**:
- 서비스 간 결합 증가
- 장애 전파 가능
- 성능 저하

**AWS 서비스**:
- API Gateway
- ALB
- Service Mesh (App Mesh)

### 2. 비동기 통신
**정의**: 메시지 기반 통신, 즉시 응답 불필요

**예시**:
- 메시지 큐 (SQS)
- 이벤트 버스 (SNS, EventBridge)

**장점**:
- 느슨한 결합
- 장애 격리
- 확장성

**단점**:
- 복잡한 구현
- 일관성 관리 어려움

**AWS 서비스**:
- SQS
- SNS
- EventBridge
- Kinesis

### 3. 이벤트 기반 통신
**정의**: 이벤트 발생 시 다른 서비스에 알림

**예시**:
```
주문 서비스 → 주문 생성 이벤트 발행
  ↓
재고 서비스 (이벤트 구독) → 재고 차감
결제 서비스 (이벤트 구독) → 결제 처리
배송 서비스 (이벤트 구독) → 배송 준비
```

**장점**:
- 완전한 디커플링
- 확장성
- 유연성

**단점**:
- 복잡한 디버깅
- 이벤트 순서 관리

**AWS 서비스**:
- EventBridge
- SNS
- Kinesis

## 마이크로서비스 아키텍처 패턴

### 1. API Gateway 패턴
**정의**: 모든 클라이언트 요청이 API Gateway를 통해 들어옴

**구조**:
```
클라이언트
  ↓
API Gateway
  ├── 사용자 서비스
  ├── 주문 서비스
  └── 제품 서비스
```

**장점**:
- 단일 진입점
- 인증/권한 중앙 관리
- 라우팅 간소화

### 2. 서비스 메시 (Service Mesh)
**정의**: 서비스 간 통신을 관리하는 인프라 계층

**기능**:
- 로드 밸런싱
- 서비스 디스커버리
- 보안 (mTLS)
- 모니터링

**AWS 서비스**:
- AWS App Mesh

### 3. 데이터베이스 per 서비스
**정의**: 각 서비스가 자체 데이터베이스를 보유

**장점**:
- 서비스 독립성
- 기술 스택 다양성
- 확장성

**단점**:
- 데이터 일관성 관리
- 트랜잭션 복잡성

## AWS에서의 마이크로서비스 구현

### 1. 서버리스 마이크로서비스
**구조**:
```
API Gateway
  ├── Lambda (사용자 서비스)
  ├── Lambda (주문 서비스)
  └── Lambda (제품 서비스)
```

**장점**:
- 자동 확장
- 비용 효율적
- 관리 부담 없음

**사용 사례**:
- 이벤트 기반 워크로드
- 가변 트래픽

### 2. 컨테이너 마이크로서비스
**구조**:
```
ALB
  ├── ECS/EKS (사용자 서비스)
  ├── ECS/EKS (주문 서비스)
  └── ECS/EKS (제품 서비스)
```

**장점**:
- 유연한 리소스 관리
- 다양한 기술 스택
- 온프레미스와 유사

**사용 사례**:
- 예측 가능한 워크로드
- 레거시 마이그레이션

### 3. 하이브리드 마이크로서비스
**구조**:
```
API Gateway
  ├── Lambda (경량 서비스)
  ├── ECS (무거운 서비스)
  └── EC2 (레거시 서비스)
```

**장점**:
- 점진적 마이그레이션
- 최적의 서비스 선택

## 모범 사례

### 1. 서비스 경계 정의
- 비즈니스 도메인 기반 분리
- 명확한 책임 분리
- 적절한 서비스 크기

### 2. 느슨한 결합
- 비동기 통신 활용
- 공유 데이터베이스 피하기
- API 버전 관리

### 3. 장애 처리
- Circuit Breaker 패턴
- 타임아웃 설정
- 재시도 정책

### 4. 모니터링
- 로깅 중앙화
- 메트릭 수집

### 5. 보안
- 서비스 간 인증
- 네트워크 격리
- 암호화

## 실제 예시

### 전자상거래 마이크로서비스
```
API Gateway
  ├── 사용자 서비스 (Lambda)
  │   └── DynamoDB
  ├── 제품 서비스 (ECS)
  │   └── RDS
  ├── 주문 서비스 (Lambda)
  │   └── DynamoDB
  └── 결제 서비스 (ECS)
      └── RDS

통신:
- 동기: API Gateway → 서비스
- 비동기: SNS → SQS → 서비스
```

## 관련 서비스

### API Gateway
- 마이크로서비스 진입점
- 라우팅 및 인증

### Lambda
- 서버리스 마이크로서비스
- 이벤트 기반 서비스

### ECS/EKS
- 컨테이너 마이크로서비스
- 오케스트레이션

### SQS/SNS
- 비동기 통신
- 이벤트 기반 통신

## 참고 자료
- [마이크로서비스 아키텍처 패턴](https://microservices.io/patterns/)
- [AWS 마이크로서비스 가이드](https://aws.amazon.com/microservices/)

