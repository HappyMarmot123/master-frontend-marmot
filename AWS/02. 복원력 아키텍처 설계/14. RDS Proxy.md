# RDS Proxy

## 개요
Amazon RDS Proxy는 데이터베이스 연결 풀링, 장애 조치, 보안 강화를 제공하는 완전 관리형 데이터베이스 프록시 서비스입니다. 애플리케이션의 확장성과 가용성을 향상시킵니다.

## 핵심 개념

### RDS Proxy란?
**정의**: 데이터베이스와 애플리케이션 간의 연결을 관리하는 프록시 서비스

**주요 기능**:
- 연결 풀링
- 자동 장애 조치
- 보안 강화
- 성능 향상

**작동 원리**:
```
애플리케이션
  ├── 연결 1
  ├── 연결 2
  └── 연결 3
  ↓
RDS Proxy (연결 풀링)
  ↓ (재사용)
RDS 데이터베이스
```

### 왜 필요한가?

#### 문제: 데이터베이스 연결 관리
**전통적인 방식**:
```
애플리케이션
  ├── 연결 1 → RDS
  ├── 연결 2 → RDS
  ├── 연결 3 → RDS
  └── ... (수천 개의 연결)
  → 데이터베이스 연결 한계 도달
  → 성능 저하
```

**RDS Proxy 사용**:
```
애플리케이션
  ├── 연결 1
  ├── 연결 2
  └── 연결 3
  ↓
RDS Proxy (연결 풀링)
  ↓ (재사용, 최적화)
RDS (적은 수의 연결)
```

## RDS Proxy 주요 기능

### 1. 연결 풀링 (Connection Pooling)
**정의**: 데이터베이스 연결을 재사용하여 효율성 향상

**작동 원리**:
```
애플리케이션 요청
  ↓
RDS Proxy가 기존 연결 재사용
  ↓
요청 완료 후 연결 반환 (종료 안 함)
  ↓
다음 요청 시 재사용
```

**장점**:
- 데이터베이스 연결 수 감소
- 연결 생성 오버헤드 제거
- 확장성 향상

**예시**:
```
전통적인 방식:
- 애플리케이션: 1,000개 연결
- RDS: 1,000개 연결 (한계 도달)

RDS Proxy 사용:
- 애플리케이션: 1,000개 연결
- RDS Proxy: 연결 풀링
- RDS: 100개 연결 (재사용)
```

### 2. 자동 장애 조치
**정의**: 데이터베이스 장애 시 자동으로 대체 인스턴스로 전환

**작동 원리**:
```
정상 상태:
애플리케이션 → RDS Proxy → RDS Primary

RDS Primary 장애:
RDS Proxy가 자동 감지
  ↓
읽기 전용 복제본으로 자동 전환
  ↓
애플리케이션은 계속 작동 (연결 유지)
```

**특징**:
- 애플리케이션 변경 불필요
- 연결 유지
- 빠른 장애 조치

### 3. IAM 인증
**정의**: IAM 역할을 사용한 데이터베이스 인증

**전통적인 방식**:
```
애플리케이션
  ↓ (사용자 이름/비밀번호)
RDS 데이터베이스
  → 비밀번호 관리 필요
  → 보안 위험
```

**RDS Proxy + IAM**:
```
애플리케이션
  ↓ (IAM 역할)
RDS Proxy
  ↓ (IAM 토큰)
RDS 데이터베이스
  → 비밀번호 불필요
  → 높은 보안
```

**장점**:
- 비밀번호 관리 불필요
- 자동 자격 증명 교체
- 높은 보안

### 4. Secrets Manager 통합
**정의**: Secrets Manager에서 자격 증명 자동 가져오기

**특징**:
- 자동 로테이션 지원
- 중앙 집중식 관리
- 보안 강화

## RDS Proxy 구성

### 1. 프록시 생성
**설정**:
- 프록시 이름
- 대상 데이터베이스
- VPC 및 서브넷
- 보안 그룹

### 2. 대상 그룹 (Target Group)
**정의**: 프록시가 연결할 데이터베이스 그룹

**구성**:
- RDS 클러스터 또는 인스턴스
- 읽기 전용 복제본 포함
- 장애 조치 설정

### 3. 엔드포인트
**정의**: 애플리케이션이 연결하는 프록시 엔드포인트

**특징**:
- 고정 엔드포인트
- DNS 이름
- 여러 엔드포인트 생성 가능

## RDS Proxy 사용 사례

### 시나리오 1: 서버리스 애플리케이션
```
Lambda 함수들 (수천 개)
  ├── 연결 1
  ├── 연결 2
  └── 연결 3
  ↓
RDS Proxy (연결 풀링)
  ↓
RDS 데이터베이스
```

**문제 해결**:
- Lambda 함수가 많을 때 연결 한계 문제
- RDS Proxy가 연결 풀링으로 해결

### 시나리오 2: Auto Scaling 애플리케이션
```
Auto Scaling Group
  ├── EC2 인스턴스 1 (100개 연결)
  ├── EC2 인스턴스 2 (100개 연결)
  └── EC2 인스턴스 3 (100개 연결)
  ↓
RDS Proxy
  ↓ (연결 재사용)
RDS 데이터베이스
```

**장점**:
- 인스턴스 추가 시에도 연결 수 안정적
- 데이터베이스 부하 감소

### 시나리오 3: 고가용성 구성
```
애플리케이션
  ↓
RDS Proxy
  ├── RDS Primary (정상)
  └── RDS Read Replica (대기)

Primary 장애 시:
RDS Proxy → 자동으로 Read Replica로 전환
```

## RDS Proxy vs 직접 연결

### 비교표

| 항목 | 직접 연결 | RDS Proxy |
|------|----------|-----------|
| **연결 관리** | 애플리케이션 책임 | RDS Proxy 책임 |
| **연결 풀링** | 애플리케이션 구현 | 자동 |
| **장애 조치** | 애플리케이션 처리 | 자동 |
| **IAM 인증** | 제한적 | 완전 지원 |
| **비용** | 없음 | 시간당 비용 |
| **성능** | 직접 | 약간의 오버헤드 |

### 선택 기준

#### RDS Proxy를 사용하는 경우
- 서버리스 애플리케이션 (Lambda)
- 많은 연결 필요
- 자동 장애 조치 필요
- IAM 인증 필요

#### 직접 연결을 사용하는 경우
- 간단한 애플리케이션
- 적은 수의 연결
- 비용 최적화
- 직접 제어 필요

## 모범 사례

### 1. 연결 풀 설정
- 적절한 최대 연결 수 설정
- 애플리케이션 요구사항 고려
- 데이터베이스 용량 고려

### 2. 보안
- IAM 인증 사용
- Secrets Manager 통합
- 보안 그룹으로 액세스 제어

### 3. 고가용성
- 여러 AZ에 배치
- 읽기 전용 복제본 포함
- 자동 장애 조치 활성화

### 4. 모니터링
- CloudWatch 지표 모니터링
- 연결 수 추적
- 성능 지표 확인

## 비용

### RDS Proxy 비용
- **시간당**: $0.015
- **vCPU 시간당**: $0.004

### 비용 최적화
- 필요한 경우만 사용
- 적절한 크기 선택
- 사용하지 않는 프록시 제거

## 관련 서비스

### RDS
- 데이터베이스 연결
- 읽기 전용 복제본

### Secrets Manager
- 자격 증명 관리
- 자동 로테이션

### Lambda
- 서버리스 애플리케이션
- 연결 풀링 필요

## 참고 자료
- [RDS Proxy 공식 문서](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/rds-proxy.html)
- [RDS Proxy 모범 사례](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/rds-proxy.best-practices.html)

