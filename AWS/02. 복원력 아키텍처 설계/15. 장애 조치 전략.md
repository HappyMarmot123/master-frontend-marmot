# 장애 조치 전략

## 개요
장애 조치(Failover)는 시스템 구성 요소가 실패할 때 자동으로 대체 구성 요소로 전환하는 메커니즘입니다. 고가용성과 내결함성을 확보하는 핵심 전략입니다.

## 핵심 개념

### 장애 조치란?
**정의**: 주 구성 요소가 실패할 때 자동으로 보조 구성 요소로 전환하는 것

**목적**:
- 서비스 중단 최소화
- 고가용성 확보
- 자동 복구

**작동 원리**:
```
정상 상태:
트래픽 → Primary 리소스

Primary 장애:
자동 감지
  ↓
트래픽 → Secondary 리소스
  ↓
서비스 지속
```

## 장애 조치 유형

### 1. 자동 장애 조치 (Automatic Failover)
**정의**: 시스템이 자동으로 장애를 감지하고 전환

**특징**:
- 수동 개입 불필요
- 빠른 복구
- 24/7 모니터링

**예시**:
- RDS Multi-AZ
- ElastiCache Redis 복제 그룹
- Route 53 Health Check

### 2. 수동 장애 조치 (Manual Failover)
**정의**: 관리자가 수동으로 전환

**특징**:
- 제어 가능
- 계획된 전환
- 테스트 가능

**예시**:
- RDS 읽기 전용 복제본 승격
- 수동 DNS 변경

## 서비스별 장애 조치

### 1. Route 53 장애 조치

#### Health Check 기반 장애 조치
**구성**:
```
Route 53
  ├── Primary (서울) - Health Check: 정상
  └── Secondary (도쿄) - Health Check: 대기

Primary 장애:
Health Check 실패 감지
  ↓
자동으로 Secondary로 전환
  ↓
DNS 레코드 업데이트
```

**Health Check 설정**:
- **간격**: 30초 (표준), 10초 (빠른)
- **실패 임계값**: 연속 실패 횟수
- **경로**: 헬스 체크 경로 (예: /health)

**장애 조치 시간**:
- Health Check 간격 + DNS 전파 시간
- 일반적으로 1-2분

#### 가중치 기반 라우팅
**구성**:
```
Route 53
  ├── Primary (가중치: 90%)
  └── Secondary (가중치: 10%)

Primary 장애:
가중치 자동 조정
  ↓
Secondary로 모든 트래픽 전환
```

### 2. RDS 장애 조치

#### Multi-AZ 자동 장애 조치
**구성**:
```
RDS Primary (AZ A)
  ↓ (동기 복제)
RDS Standby (AZ B)

Primary 장애:
자동 감지
  ↓
Standby를 Primary로 승격
  ↓
DNS 자동 변경
  ↓
애플리케이션 자동 재연결
```

**장애 조치 시간**: 60-120초

**특징**:
- 자동 감지 및 전환
- 데이터 손실 없음 (동기 복제)
- 애플리케이션 변경 최소

#### 읽기 전용 복제본 승격
**구성**:
```
RDS Primary
  ├── Read Replica 1 (다른 리전)
  └── Read Replica 2 (다른 리전)

Primary 장애:
수동 또는 자동으로 Read Replica 승격
  ↓
애플리케이션 연결 변경 필요
```

**장애 조치 시간**: 수분 (수동 승격)

### 3. Aurora 장애 조치

#### 자동 장애 조치
**구성**:
```
Aurora Writer
  ↓ (스토리지 레벨 복제)
Aurora Reader들

Writer 장애:
자동 감지
  ↓
Reader 중 하나를 Writer로 승격
  ↓
엔드포인트 자동 업데이트
  ↓
30초 이내 복구
```

**특징**:
- 매우 빠른 장애 조치 (30초)
- 자동 감지 및 전환
- 애플리케이션 변경 최소

### 4. ALB 장애 조치

#### Health Check 기반
**구성**:
```
ALB
  ├── 대상 1 (정상) → 트래픽 전달
  ├── 대상 2 (정상) → 트래픽 전달
  └── 대상 3 (비정상) → 트래픽 차단

대상 3 장애:
Health Check 실패
  ↓
자동으로 트래픽 차단
  ↓
정상 대상으로만 트래픽 라우팅
```

**Health Check 설정**:
- **경로**: /health
- **간격**: 30초
- **타임아웃**: 5초
- **건강 임계값**: 2
- **비건강 임계값**: 2

### 5. ElastiCache Redis 장애 조치

#### 복제 그룹 자동 장애 조치
**구성**:
```
Redis Primary
  ↓ (비동기 복제)
Redis Replica

Primary 장애:
자동 감지
  ↓
Replica를 Primary로 승격
  ↓
자동 장애 조치
```

**장애 조치 시간**: 수십 초

## 장애 조치 전략 패턴

### 패턴 1: Active-Passive
**정의**: 하나가 활성, 다른 것이 대기

**구조**:
```
Primary (활성)
  ↓ (복제)
Secondary (대기)

Primary 장애 → Secondary 활성화
```

**예시**:
- RDS Multi-AZ
- Route 53 Health Check

### 패턴 2: Active-Active
**정의**: 여러 구성 요소가 동시에 활성

**구조**:
```
리소스 A (활성, 50% 트래픽)
리소스 B (활성, 50% 트래픽)

A 장애 → B가 100% 트래픽 처리
```

**예시**:
- ALB (여러 대상)
- Auto Scaling Group

### 패턴 3: 다중 계층 장애 조치
**구조**:
```
Route 53 (DNS 레벨)
  ↓
ALB (로드 밸런서 레벨)
  ↓
Auto Scaling Group (인스턴스 레벨)
  ↓
RDS Multi-AZ (데이터베이스 레벨)
```

**장점**:
- 각 계층에서 장애 조치
- 높은 가용성
- 다중 보호

## 장애 조치 테스트

### 테스트 방법

#### 1. 계획된 장애 조치 테스트
**목적**: 장애 조치 프로세스 검증

**방법**:
- Primary 리소스 수동 중지
- 장애 조치 동작 확인
- 복구 시간 측정
- 데이터 무결성 확인

#### 2. 카오스 엔지니어링
**정의**: 의도적으로 장애를 발생시켜 시스템 복원력 테스트

**도구**:
- AWS Fault Injection Simulator (FIS)
- Chaos Monkey

**예시**:
- 인스턴스 종료
- 가용 영역 장애 시뮬레이션
- 네트워크 지연 시뮬레이션

### 테스트 체크리스트
- [ ] 장애 감지 시간
- [ ] 장애 조치 시간
- [ ] 데이터 손실 여부
- [ ] 애플리케이션 영향
- [ ] 복구 프로세스

## 모범 사례

### 1. 자동화
- 가능한 한 자동 장애 조치 사용
- 수동 개입 최소화
- 빠른 복구

### 2. 모니터링
- Health Check 설정
- CloudWatch 알람
- 장애 조치 이벤트 로깅

### 3. 정기적 테스트
- 계획된 장애 조치 테스트
- RTO/RPO 검증
- 프로세스 문서화

### 4. 다중 계층 보호
- 여러 계층에서 장애 조치
- 단일 장애 지점 제거
- 방어적 설계

## 실제 아키텍처 예시

### 예시 1: 고가용성 웹 애플리케이션
```
Route 53 (DNS 장애 조치)
  ├── 리전 A (Primary)
  └── 리전 B (Secondary)
  ↓
ALB (로드 밸런서 장애 조치)
  ├── AZ A
  └── AZ B
  ↓
Auto Scaling Group (인스턴스 장애 조치)
  ├── 인스턴스 1, 2, 3
  └── 자동 교체
  ↓
RDS Multi-AZ (데이터베이스 장애 조치)
  ├── Primary
  └── Standby
```

### 예시 2: 마이크로서비스
```
API Gateway
  ↓
ALB (서비스별)
  ├── 서비스 A (Multi-AZ)
  ├── 서비스 B (Multi-AZ)
  └── 서비스 C (Multi-AZ)
  ↓
각 서비스별 데이터베이스 (Multi-AZ)
```

## 관련 서비스

### Route 53
- DNS 기반 장애 조치
- Health Check

### CloudWatch
- Health Check 모니터링
- 알람 설정

### Auto Scaling
- 인스턴스 자동 교체
- 장애 조치 지원

## 참고 자료
- [장애 조치 전략](https://docs.aws.amazon.com/wellarchitected/latest/reliability-pillar/design-for-failure.html)
- [Route 53 Health Check](https://docs.aws.amazon.com/route53/latest/developerguide/health-checks.html)

