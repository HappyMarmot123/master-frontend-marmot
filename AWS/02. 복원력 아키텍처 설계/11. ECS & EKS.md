# ECS & EKS

## 개요
Amazon ECS (Elastic Container Service)와 Amazon EKS (Elastic Kubernetes Service)는 컨테이너 오케스트레이션 서비스입니다. 컨테이너 기반 애플리케이션을 배포, 관리, 확장할 수 있습니다.

## 핵심 개념

### 컨테이너 오케스트레이션이란?
**정의**: 여러 컨테이너의 배포, 관리, 확장을 자동화하는 시스템

**주요 기능**:
- 컨테이너 배포
- 자동 확장
- 로드 밸런싱
- 서비스 디스커버리
- 헬스 체크
- 롤링 업데이트

**왜 필요한가?**:
- 마이크로서비스 관리
- 확장성
- 가용성
- 리소스 최적화

## ECS (Elastic Container Service)

### ECS란?
**정의**: AWS 네이티브 컨테이너 오케스트레이션 서비스

**특징**:
- AWS 서비스와 긴밀한 통합
- 간단한 설정
- 서버리스 옵션 (Fargate)
- EC2 기반 옵션

### ECS 구성 요소

#### 1. 클러스터 (Cluster)
**정의**: 컨테이너를 실행하는 인프라의 논리적 그룹

**유형**:
- **EC2 클러스터**: EC2 인스턴스에서 컨테이너 실행
- **Fargate 클러스터**: 서버리스 컨테이너 실행

#### 2. 작업 정의 (Task Definition)
**정의**: 컨테이너 실행 방법을 정의하는 JSON 문서

**포함 내용**:
- 컨테이너 이미지
- CPU/메모리 할당
- 환경 변수
- 포트 매핑
- 로깅 설정

**예시**:
```json
{
  "family": "web-app",
  "containerDefinitions": [
    {
      "name": "web",
      "image": "nginx:latest",
      "cpu": 256,
      "memory": 512,
      "portMappings": [
        {
          "containerPort": 80
        }
      ]
    }
  ]
}
```

#### 3. 작업 (Task)
**정의**: 작업 정의의 실행 인스턴스

**특징**:
- 하나 이상의 컨테이너 포함
- 클러스터에서 실행
- 시작/중지 가능

#### 4. 서비스 (Service)
**정의**: 작업의 원하는 개수를 유지하는 구성

**기능**:
- 자동 확장
- 헬스 체크
- 로드 밸런싱
- 롤링 업데이트

**작동 원리**:
```
서비스 정의: 원하는 개수 = 3
  ↓
ECS가 3개의 작업 실행
  ↓
작업 실패 시 자동 교체
  ↓
롤링 업데이트 시 점진적 교체
```

### ECS 실행 모드

#### 1. Fargate (서버리스)
**정의**: 서버 관리 없이 컨테이너 실행

**특징**:
- 인프라 관리 불필요
- 자동 확장
- 사용한 만큼만 지불
- EC2 인스턴스 불필요

**장점**:
- 간단한 운영
- 빠른 시작
- 비용 효율적 (작은 워크로드)

**단점**:
- EC2보다 비용 높을 수 있음 (큰 워크로드)
- 커스터마이징 제한

#### 2. EC2
**정의**: EC2 인스턴스에서 컨테이너 실행

**특징**:
- 인스턴스 직접 관리
- 완전한 제어
- 다양한 인스턴스 유형

**장점**:
- 비용 효율적 (큰 워크로드)
- 커스터마이징 가능
- 스팟 인스턴스 사용 가능

**단점**:
- 인프라 관리 필요
- 패치 및 업데이트 책임

### ECS 서비스 통합

#### ALB 통합
```
ALB
  ↓
ECS 서비스
  ├── 작업 1
  ├── 작업 2
  └── 작업 3
```

**특징**:
- 자동 서비스 디스커버리
- 헬스 체크
- 로드 밸런싱

#### CloudWatch 통합
- 컨테이너 로그 수집
- 지표 모니터링
- 알람 설정

## EKS (Elastic Kubernetes Service)

### EKS란?
**정의**: 관리형 Kubernetes 서비스

**특징**:
- 표준 Kubernetes API
- Kubernetes 커뮤니티 도구 호환
- 고가용성 마스터 노드
- 자동 패치

### Kubernetes 기본 개념

#### 1. Pod
**정의**: 하나 이상의 컨테이너 그룹

**특징**:
- 최소 배포 단위
- 공유 네트워크 및 스토리지
- 같은 Pod 내 컨테이너는 localhost로 통신

#### 2. Deployment
**정의**: Pod의 원하는 개수를 유지

**기능**:
- 자동 확장
- 롤링 업데이트
- 롤백

#### 3. Service
**정의**: Pod 그룹에 대한 네트워크 엔드포인트

**유형**:
- **ClusterIP**: 클러스터 내부 접근
- **NodePort**: 노드 포트를 통한 접근
- **LoadBalancer**: AWS 로드 밸런서 통합

#### 4. Namespace
**정의**: 리소스의 논리적 분리

**용도**:
- 환경 분리 (dev, staging, prod)
- 팀별 분리
- 리소스 격리

### EKS 구성 요소

#### 1. EKS 클러스터
**정의**: Kubernetes 마스터 노드 (AWS 관리)

**특징**:
- 고가용성 (여러 AZ)
- 자동 백업
- 자동 패치

#### 2. 노드 그룹 (Node Group)
**정의**: 워커 노드의 그룹

**특징**:
- EC2 인스턴스 그룹
- Auto Scaling 지원
- 여러 노드 그룹 가능

#### 3. Fargate 프로파일
**정의**: Fargate에서 Pod 실행

**특징**:
- 서버리스 실행
- 인프라 관리 불필요

### EKS vs ECS

| 항목 | ECS | EKS |
|------|-----|-----|
| **표준** | AWS 전용 | Kubernetes 표준 |
| **학습 곡선** | 낮음 | 높음 |
| **커뮤니티** | AWS 중심 | 넓은 커뮤니티 |
| **도구** | AWS 도구 | Kubernetes 도구 |
| **사용 사례** | AWS 중심 환경 | 멀티 클라우드, 표준 필요 |

## 컨테이너 오케스트레이션 패턴

### 1. 서비스 디스커버리
**정의**: 서비스가 서로를 찾는 메커니즘

**ECS**:
- ALB를 통한 자동 디스커버리
- 서비스 이름으로 접근

**EKS**:
- Kubernetes Service
- DNS 기반 디스커버리

### 2. 자동 확장
**ECS**:
- 서비스 자동 확장
- CPU/메모리 기반

**EKS**:
- Horizontal Pod Autoscaler (HPA)
- Cluster Autoscaler

### 3. 롤링 업데이트
**ECS**:
- 서비스 롤링 업데이트
- 최소 건강 비율 설정

**EKS**:
- Deployment 롤링 업데이트
- maxSurge, maxUnavailable 설정

### 4. 헬스 체크
**ECS**:
- 작업 레벨 헬스 체크
- 서비스 레벨 헬스 체크

**EKS**:
- Liveness Probe
- Readiness Probe

## 사용 사례

### 시나리오 1: 마이크로서비스 배포
```
ECS 클러스터
  ├── 사용자 서비스 (Fargate)
  ├── 주문 서비스 (Fargate)
  └── 제품 서비스 (EC2)
```

### 시나리오 2: 웹 애플리케이션
```
ALB
  ↓
ECS 서비스
  ├── 웹 서버 (Nginx)
  └── 애플리케이션 서버 (Node.js)
```

### 시나리오 3: 배치 작업
```
ECS 작업
  ├── 데이터 처리 작업
  └── 결과 저장
```

## 모범 사례

### 1. 리소스 할당
- 적절한 CPU/메모리 할당
- 리소스 제한 설정
- 오버프로비저닝 방지

### 2. 보안
- 최소 권한 원칙
- 이미지 스캔
- 네트워크 격리

### 3. 모니터링
- CloudWatch 로그
- 지표 모니터링
- 분산 추적

### 4. 비용 최적화
- Fargate vs EC2 선택
- 스팟 인스턴스 활용
- 리소스 최적화

## 관련 서비스

### Fargate
- 서버리스 컨테이너 실행
- ECS/EKS와 통합

### ECR (Elastic Container Registry)
- 컨테이너 이미지 저장
- ECS/EKS와 통합

### ALB
- 로드 밸런싱
- 서비스 디스커버리

### CloudWatch
- 로깅 및 모니터링
- 지표 수집

## 참고 자료
- [ECS 공식 문서](https://docs.aws.amazon.com/ecs/)
- [EKS 공식 문서](https://docs.aws.amazon.com/eks/)
- [Kubernetes 공식 문서](https://kubernetes.io/docs/)

