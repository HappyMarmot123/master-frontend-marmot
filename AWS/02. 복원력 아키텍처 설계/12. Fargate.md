# Fargate

## 개요
AWS Fargate는 서버를 프로비저닝하거나 관리할 필요 없이 컨테이너를 실행할 수 있는 서버리스 컴퓨팅 엔진입니다. ECS와 EKS에서 사용할 수 있습니다.

## 핵심 개념

### Fargate란?
**정의**: 서버리스 컨테이너 실행 플랫폼

**특징**:
- 서버 관리 불필요
- 인프라 프로비저닝 불필요
- 자동 확장
- 사용한 만큼만 지불

**작동 원리**:
```
컨테이너 이미지
  ↓
Fargate (자동으로 인프라 프로비저닝)
  ↓
컨테이너 실행
```

### Fargate vs EC2

| 항목 | Fargate | EC2 |
|------|---------|-----|
| **서버 관리** | 불필요 | 필요 |
| **인프라 프로비저닝** | 자동 | 수동 |
| **확장성** | 자동 | 수동/Auto Scaling |
| **비용** | 사용량 기반 | 시간 기반 |
| **커스터마이징** | 제한적 | 완전한 제어 |
| **사용 사례** | 간단한 운영 | 고급 커스터마이징 필요 |

## Fargate 사용 시나리오

### 언제 Fargate를 사용하는가?

#### 1. 간단한 운영
**요구사항**: 인프라 관리 없이 컨테이너 실행

**Fargate 장점**:
- 서버 관리 불필요
- 패치 및 업데이트 자동
- 운영 부담 최소화

#### 2. 가변 트래픽
**요구사항**: 트래픽에 따라 자동 확장

**Fargate 장점**:
- 자동 확장
- 사용하지 않을 때 비용 없음
- 피크 시간 대응

#### 3. 빠른 시작
**요구사항**: 빠르게 컨테이너 배포

**Fargate 장점**:
- 인프라 프로비저닝 불필요
- 즉시 시작
- 설정 간소화

### 언제 EC2를 사용하는가?

#### 1. 비용 최적화
**요구사항**: 큰 워크로드, 비용 최소화

**EC2 장점**:
- 예약형 인스턴스 할인
- 스팟 인스턴스 사용 가능
- 큰 워크로드에서 비용 효율적

#### 2. 고급 커스터마이징
**요구사항**: 특수한 인프라 설정

**EC2 장점**:
- 완전한 제어
- 커스텀 AMI 사용
- 특수 하드웨어 사용

#### 3. 예측 가능한 워크로드
**요구사항**: 안정적인 리소스 필요

**EC2 장점**:
- 예측 가능한 성능
- 리소스 보장
- 비용 예측 가능

## ECS Fargate

### ECS Fargate 구성

#### 1. 클러스터
**정의**: Fargate 작업을 실행하는 논리적 그룹

**특징**:
- 인프라 없음
- 논리적 컨테이너만 존재

#### 2. 작업 정의
**정의**: Fargate에서 실행할 컨테이너 정의

**필수 설정**:
- **CPU**: 0.25 vCPU ~ 4 vCPU
- **메모리**: 0.5GB ~ 30GB
- **컨테이너 이미지**: ECR 또는 Docker Hub

**예시**:
```json
{
  "family": "web-app",
  "networkMode": "awsvpc",
  "requiresCompatibilities": ["FARGATE"],
  "cpu": "256",
  "memory": "512",
  "containerDefinitions": [
    {
      "name": "web",
      "image": "nginx:latest",
      "portMappings": [
        {
          "containerPort": 80,
          "protocol": "tcp"
        }
      ]
    }
  ]
}
```

#### 3. 서비스
**정의**: Fargate 작업의 원하는 개수를 유지

**특징**:
- 자동 확장
- 헬스 체크
- 로드 밸런싱 통합

### ECS Fargate 네트워킹

#### awsvpc 네트워크 모드
**정의**: 각 작업이 자체 ENI (Elastic Network Interface) 보유

**특징**:
- 작업별 고유 IP 주소
- 보안 그룹 직접 적용
- VPC 내 리소스와 직접 통신

**구성**:
```
Fargate 작업
  ↓
ENI (작업별)
  ↓
VPC 서브넷
  ↓
보안 그룹
```

### ECS Fargate 사용 예시

#### 예시 1: 웹 애플리케이션
```
ALB
  ↓
ECS Fargate 서비스
  ├── 작업 1 (nginx)
  ├── 작업 2 (nginx)
  └── 작업 3 (nginx)
```

#### 예시 2: 마이크로서비스
```
API Gateway
  ↓
ECS Fargate 서비스
  ├── 사용자 서비스
  ├── 주문 서비스
  └── 제품 서비스
```

## EKS Fargate

### EKS Fargate 프로파일
**정의**: Fargate에서 실행할 Pod를 정의하는 구성

**특징**:
- Kubernetes 표준 API
- 서버리스 실행
- 자동 확장

### EKS Fargate vs EKS EC2

| 항목 | EKS Fargate | EKS EC2 |
|------|-------------|---------|
| **노드 관리** | 불필요 | 필요 |
| **확장성** | 자동 | Cluster Autoscaler |
| **비용** | 사용량 기반 | 시간 기반 |
| **커스터마이징** | 제한적 | 완전한 제어 |

## Fargate 비용

### ECS Fargate
- **vCPU**: vCPU 시간당 $0.04048
- **메모리**: GB 시간당 $0.004445

**예시**:
```
작업: 0.5 vCPU, 1GB 메모리
시간당: $0.02024 + $0.004445 = $0.024685
월 (730시간): 약 $18
```

### EKS Fargate
- **vCPU**: vCPU 시간당 $0.04048
- **메모리**: GB 시간당 $0.004445
- **추가**: EKS 클러스터 비용 ($0.10/시간)

## 모범 사례

### 1. 리소스 할당
- 필요한 만큼만 할당
- CPU/메모리 비율 최적화
- 모니터링을 통한 조정

### 2. 이미지 최적화
- 작은 이미지 사용
- 멀티 스테이지 빌드
- 불필요한 패키지 제거

### 3. 네트워킹
- 적절한 서브넷 선택
- 보안 그룹 최소 권한
- VPC 엔드포인트 사용 (비용 절감)

### 4. 모니터링
- CloudWatch 지표 모니터링
- 로그 수집
- 비용 추적

## 관련 서비스

### ECR
- 컨테이너 이미지 저장
- Fargate와 통합

### ALB
- 로드 밸런싱
- Fargate 서비스와 통합

### CloudWatch
- 로깅 및 모니터링
- 지표 수집

## 참고 자료
- [ECS Fargate 공식 문서](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/AWS_Fargate.html)
- [EKS Fargate 공식 문서](https://docs.aws.amazon.com/eks/latest/userguide/fargate.html)

