# 네트워크 전송 비용 최적화

## 개요
AWS 네트워크 데이터 전송 비용은 클라우드 비용의 중요한 부분입니다. 데이터 전송 비용을 최소화하기 위한 전략을 이해하고 적용해야 합니다.

## 핵심 개념

### 데이터 전송 비용이란?
**정의**: AWS에서 데이터를 전송할 때 발생하는 비용

**주요 비용**:
- **Data Transfer Out**: AWS에서 인터넷으로 전송
- **리전 간 전송**: 리전 간 데이터 전송
- **가용 영역 간 전송**: AZ 간 데이터 전송

**특징**:
- 인바운드 (인터넷 → AWS): 무료
- 아웃바운드 (AWS → 인터넷): 유료
- 리전 내 전송: 일부 무료

## 데이터 전송 비용 구조

### 인터넷으로의 전송 (Data Transfer Out)
**비용** (예시, 리전별 다름):
- 첫 1GB/월: 무료
- 다음 9.999TB/월: GB당 $0.09
- 다음 40TB/월: GB당 $0.085
- 다음 100TB/월: GB당 $0.07
- 150TB 초과: GB당 $0.05

**예시**:
```
월 100GB 전송
- 첫 1GB: 무료
- 나머지 99GB: 99GB × $0.09 = $8.91/월
```

### 리전 간 전송
**비용**:
- GB당 $0.02

**예시**:
```
서울 리전 → 도쿄 리전
- 100GB 전송: 100GB × $0.02 = $2.00
```

### 가용 영역 간 전송
**비용**:
- GB당 $0.01

**예시**:
```
AZ A → AZ B (같은 리전)
- 100GB 전송: 100GB × $0.01 = $1.00
```

## 비용 최적화 전략

### 1. CloudFront 사용

#### CloudFront란?
**정의**: 전 세계 콘텐츠 전송 네트워크 (CDN)

**비용 절감 원리**:
```
전통적인 방식:
사용자 (전 세계)
  ↓ (직접 전송)
S3 (서울)
  → 모든 전송 비용 발생

CloudFront 사용:
사용자 (전 세계)
  ↓ (가까운 엣지)
CloudFront 엣지 로케이션
  ↓ (캐시된 콘텐츠)
  → 캐시 히트 시 전송 비용 없음
  → 캐시 미스 시만 원본으로 전송
```

**비용**:
- **데이터 전송**: GB당 $0.085 (첫 10TB)
- **원본 요청**: 요청당 $0.0075

**비용 절감**:
```
월 1TB 전송
- 직접 S3: 1TB × $0.09 = $90
- CloudFront (80% 캐시 히트):
  - 캐시 히트: 0.8TB × $0.085 = $68
  - 원본 요청: 0.2TB × $0.09 = $18
  - 총: $86
  - 절감: $4 (4.4%)
```

**추가 장점**:
- 낮은 지연 시간
- 높은 성능
- DDoS 보호

### 2. VPC 엔드포인트 사용

#### VPC 엔드포인트란?
**정의**: VPC에서 AWS 서비스로의 프라이빗 연결

**비용 절감 원리**:
```
전통적인 방식:
VPC (프라이빗 서브넷)
  ↓ (NAT 게이트웨이)
인터넷
  ↓
S3
  → NAT 게이트웨이 비용
  → 데이터 전송 비용

VPC 엔드포인트 사용:
VPC (프라이빗 서브넷)
  ↓ (VPC 엔드포인트)
S3 (프라이빗 연결)
  → NAT 게이트웨이 비용 없음
  → 데이터 전송 비용 없음 (리전 내)
```

**비용**:
- **Gateway 엔드포인트**: 무료 (S3, DynamoDB)
- **Interface 엔드포인트**: 시간당 $0.01 + 데이터 처리 GB당 $0.01

**비용 절감 예시**:
```
월 1TB S3 전송
- NAT 게이트웨이: $45 (데이터 처리)
- VPC 엔드포인트: 무료

→ $45/월 절감
```

### 3. 같은 리전 사용

#### 리전 내 전송
**특징**:
- 같은 리전 내 전송: 일부 무료 또는 저렴
- 리전 간 전송: 비쌈

**전략**:
- 관련 리소스를 같은 리전에 배치
- 리전 간 전송 최소화

**예시**:
```
EC2 (서울) → S3 (서울)
  → 리전 내 전송: 무료 또는 저렴

EC2 (서울) → S3 (도쿄)
  → 리전 간 전송: GB당 $0.02
```

### 4. 같은 가용 영역 사용

#### AZ 내 전송
**특징**:
- 같은 AZ 내 전송: 무료
- AZ 간 전송: GB당 $0.01

**전략**:
- 가능한 한 같은 AZ에 배치
- AZ 간 전송 최소화

**예시**:
```
EC2 (AZ A) → RDS (AZ A)
  → AZ 내 전송: 무료

EC2 (AZ A) → RDS (AZ B)
  → AZ 간 전송: GB당 $0.01
```

### 5. 데이터 압축

#### 압축 전략
**목적**: 전송 데이터 양 감소

**방법**:
- 데이터 압축
- 효율적인 포맷 사용
- 불필요한 데이터 제거

**예시**:
```
압축 전: 100GB
압축 후: 20GB (80% 압축)

전송 비용:
- 압축 전: 100GB × $0.09 = $9.00
- 압축 후: 20GB × $0.09 = $1.80
- 절감: $7.20 (80%)
```

### 6. 배치 전송

#### 배치 전송 전략
**목적**: 여러 작은 전송을 하나로 통합

**방법**:
- 작은 요청 배치 처리
- 일괄 업로드/다운로드
- 스트리밍 대신 배치

**예시**:
```
100개의 1MB 파일 전송
- 개별 전송: 100 × 오버헤드
- 배치 전송: 1 × 100MB (오버헤드 감소)
```

## NAT 게이트웨이 비용 최적화

### NAT 게이트웨이 비용
**구성**:
- 시간당: $0.045
- 데이터 처리: GB당 $0.045

**예시**:
```
NAT 게이트웨이 1개 (24/7)
- 시간당: $0.045 × 730시간 = $32.85/월
- 데이터 처리: 100GB × $0.045 = $4.50/월
- 총: $37.35/월
```

### 비용 최적화 전략

#### 1. VPC 엔드포인트 사용
**전략**:
- AWS 서비스 접근 시 VPC 엔드포인트 사용
- NAT 게이트웨이 우회
- 비용 절감

**예시**:
```
S3 접근:
- NAT 게이트웨이: $0.045/GB
- VPC 엔드포인트: 무료

→ 100GB 접근 시 $4.50 절감
```

#### 2. NAT 게이트웨이 공유
**전략**:
- 여러 프라이빗 서브넷이 하나의 NAT 게이트웨이 공유
- NAT 게이트웨이 수 감소

**구성**:
```
프라이빗 서브넷 A, B, C
  ↓ (모두)
단일 NAT 게이트웨이

비용:
- NAT 게이트웨이 3개: $112.05/월
- NAT 게이트웨이 1개: $37.35/월
- 절감: $74.70/월 (66.7%)
```

**주의사항**:
- 단일 장애 지점
- 가용성 고려 필요

#### 3. 다중 AZ 배포 (고가용성)
**전략**:
- 각 AZ에 NAT 게이트웨이 배치
- 고가용성 확보
- 비용 증가

**균형**:
- 비용 vs 가용성
- 프로덕션: 다중 AZ
- 개발/테스트: 단일 NAT 게이트웨이

## Direct Connect vs VPN 비용

### Direct Connect 비용
**구성**:
- 포트 비용: 시간당 (포트 속도에 따라 다름)
- 데이터 전송: GB당 $0.02

**예시**:
```
1 Gbps 포트 (24/7)
- 포트: $0.30/시간 × 730시간 = $219/월
- 데이터 전송: 1TB × $0.02 = $20/월
- 총: $239/월
```

### VPN 비용
**구성**:
- Virtual Private Gateway: 시간당 $0.05
- 데이터 전송: GB당 $0.05

**예시**:
```
VPN (24/7)
- 게이트웨이: $0.05/시간 × 730시간 = $36.50/월
- 데이터 전송: 1TB × $0.05 = $50/월
- 총: $86.50/월
```

### 선택 기준
**Direct Connect 선택**:
- 높은 대역폭
- 많은 데이터 전송
- 장기적 사용

**VPN 선택**:
- 낮은 대역폭
- 적은 데이터 전송
- 임시 연결

## 실제 최적화 예시

### 예시 1: 웹 애플리케이션
```
최적화 전:
사용자 → EC2 → S3 (NAT 게이트웨이 경유)
  → 높은 전송 비용

최적화 후:
사용자 → CloudFront → S3
EC2 → S3 (VPC 엔드포인트)
  → 전송 비용 절감
```

### 예시 2: 데이터 파이프라인
```
최적화 전:
EC2 (서울) → S3 (도쿄)
  → 리전 간 전송 비용

최적화 후:
EC2 (서울) → S3 (서울)
  → 리전 내 전송 (무료 또는 저렴)
```

### 예시 3: 마이크로서비스
```
최적화 전:
서비스 A → 서비스 B (다른 AZ)
  → AZ 간 전송 비용

최적화 후:
서비스 A → 서비스 B (같은 AZ)
  → AZ 내 전송 (무료)
```

## 모범 사례

### 1. 데이터 전송 모니터링
- CloudWatch로 전송량 추적
- 비용 분석
- 비효율적인 전송 식별

### 2. 아키텍처 최적화
- 같은 리전/AZ 사용
- VPC 엔드포인트 활용
- CloudFront 활용

### 3. 데이터 최적화
- 압축 사용
- 불필요한 데이터 제거
- 효율적인 포맷 사용

### 4. 정기적인 검토
- 비용 분석
- 최적화 기회 식별
- 아키텍처 개선

## 관련 서비스

### CloudFront
- CDN
- 전송 비용 절감

### VPC 엔드포인트
- 프라이빗 연결
- NAT 게이트웨이 우회

### Cost Explorer
- 비용 분석
- 데이터 전송 비용 추적

## 참고 자료
- [데이터 전송 비용](https://aws.amazon.com/pricing/data-transfer/)
- [CloudFront 요금](https://aws.amazon.com/cloudfront/pricing/)
- [VPC 엔드포인트](https://docs.aws.amazon.com/vpc/latest/privatelink/)

