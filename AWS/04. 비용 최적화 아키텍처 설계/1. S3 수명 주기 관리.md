# S3 수명 주기 관리

## 개요
S3 수명 주기 정책은 데이터 접근 패턴에 따라 자동으로 적절한 스토리지 클래스로 이동시켜 비용을 최적화하는 기능입니다. 자주 사용하지 않는 데이터를 저렴한 스토리지 클래스로 자동 전환합니다.

## 핵심 개념

### 수명 주기 관리란?
**정의**: 객체의 수명 주기 동안 자동으로 스토리지 클래스를 변경하거나 삭제하는 정책

**목적**:
- 비용 최적화
- 자동화된 관리
- 수동 작업 최소화

**작동 원리**:
```
S3 버킷
  ├── 수명 주기 정책 설정
  ├── 객체 생성 (Standard)
  ├── 30일 후 → Standard-IA로 이동
  ├── 90일 후 → Glacier로 이동
  └── 365일 후 → 삭제
```

## 수명 주기 정책 구성 요소

### 1. 규칙 (Rule)
**정의**: 객체에 적용할 작업을 정의

**구성 요소**:
- **필터**: 규칙이 적용될 객체 선택
- **전환 작업**: 스토리지 클래스 변경
- **만료 작업**: 객체 삭제

### 2. 필터 (Filter)
**정의**: 규칙이 적용될 객체를 선택

**필터 유형**:
- **접두사**: 특정 접두사로 시작하는 객체
- **태그**: 특정 태그를 가진 객체
- **크기**: 특정 크기 이상/이하 객체

**예시**:
```
접두사: logs/
→ logs/로 시작하는 모든 객체에 적용

태그: Environment=Production
→ Environment 태그가 Production인 객체에 적용
```

### 3. 전환 작업 (Transition Action)
**정의**: 객체를 다른 스토리지 클래스로 이동

**전환 옵션**:
- **Standard → Standard-IA**: 30일 후
- **Standard → Glacier**: 90일 후
- **Standard → Glacier Deep Archive**: 180일 후
- **Standard-IA → Glacier**: 추가 기간 후

**전환 규칙**:
- 최소 저장 기간 요구사항
- 전환 후 즉시 삭제 불가

### 4. 만료 작업 (Expiration Action)
**정의**: 객체를 자동으로 삭제

**사용 사례**:
- 임시 파일
- 로그 파일
- 백업 파일 (보존 기간 경과)

## 수명 주기 정책 예시

### 예시 1: 로그 파일 관리
**시나리오**: 애플리케이션 로그 파일을 자동으로 관리

**정책**:
```
필터: logs/
규칙:
  1. 생성 후 30일 → Standard-IA로 전환
  2. 생성 후 90일 → Glacier로 전환
  3. 생성 후 365일 → 삭제
```

**비용 절감**:
- 처음 30일: Standard ($0.023/GB)
- 30-90일: Standard-IA ($0.0125/GB)
- 90-365일: Glacier ($0.004/GB)
- 365일 후: 삭제 (비용 없음)

### 예시 2: 백업 파일 관리
**시나리오**: 데이터베이스 백업 파일 관리

**정책**:
```
필터: backups/
규칙:
  1. 생성 후 즉시 → Standard-IA로 전환 (즉시 접근 불필요)
  2. 생성 후 90일 → Glacier로 전환
  3. 생성 후 7년 → Glacier Deep Archive로 전환
  4. 생성 후 10년 → 삭제
```

**비용 절감**:
- 처음: Standard-IA ($0.0125/GB)
- 90일 후: Glacier ($0.004/GB)
- 7년 후: Glacier Deep Archive ($0.00099/GB)

### 예시 3: 미디어 파일 관리
**시나리오**: 사용자가 업로드한 미디어 파일

**정책**:
```
필터: media/
규칙:
  1. 생성 후 30일 → Standard-IA로 전환
  2. 생성 후 90일 → Glacier로 전환
  3. 생성 후 1년 → Glacier Deep Archive로 전환
```

## 스토리지 클래스별 전환 전략

### 자주 액세스하는 데이터
**전략**: Standard 유지
- 최근 생성된 데이터
- 활발히 사용되는 데이터
- 낮은 지연 시간 필요

### 가끔 액세스하는 데이터
**전략**: Standard → Standard-IA
- 30일 이상 액세스하지 않은 데이터
- 가끔 액세스하지만 빠른 액세스 필요
- 검색 비용 고려

### 거의 액세스하지 않는 데이터
**전략**: Standard → Glacier
- 90일 이상 액세스하지 않은 데이터
- 아카이브 목적
- 몇 시간 내 복원 가능

### 장기 보관 데이터
**전략**: Standard → Glacier Deep Archive
- 180일 이상 액세스하지 않은 데이터
- 규정 준수 목적
- 12시간 내 복원 가능

## 수명 주기 정책 모범 사례

### 1. 데이터 접근 패턴 분석
- CloudWatch 지표로 접근 패턴 분석
- 적절한 전환 시점 결정
- 비용과 성능 균형

### 2. 점진적 전환
- 한 번에 Glacier로 이동하지 않음
- Standard → Standard-IA → Glacier 순서
- 비용 최적화

### 3. 만료 정책 신중하게 설정
- 중요한 데이터는 만료 정책 사용 안 함
- 규정 준수 요구사항 고려
- 실수로 삭제 방지

### 4. 태그 활용
- 객체에 태그 추가
- 태그 기반 필터링
- 세밀한 정책 적용

## 비용 계산 예시

### 시나리오: 1TB 로그 파일 관리

#### 수명 주기 정책 없음
```
1TB × $0.023/GB × 12개월 = $282.24/년
```

#### 수명 주기 정책 적용
```
정책:
- 0-30일: Standard ($0.023/GB)
- 30-90일: Standard-IA ($0.0125/GB)
- 90-365일: Glacier ($0.004/GB)

비용 계산:
- 30일: 1TB × $0.023/GB × (30/365) = $1.89
- 60일: 1TB × $0.0125/GB × (60/365) = $2.05
- 275일: 1TB × $0.004/GB × (275/365) = $3.01
총 비용: $6.95/년

비용 절감: $282.24 - $6.95 = $275.29 (97.5% 절감)
```

## 수명 주기 정책 설정

### AWS 콘솔 설정
```
1. S3 버킷 선택
2. Management 탭
3. Lifecycle rules
4. Create lifecycle rule
5. 규칙 구성
   - 이름
   - 필터 (접두사, 태그)
   - 전환 작업
   - 만료 작업
6. 저장
```

### JSON 정책 예시
```json
{
  "Rules": [
    {
      "Id": "LogsLifecycle",
      "Status": "Enabled",
      "Filter": {
        "Prefix": "logs/"
      },
      "Transitions": [
        {
          "Days": 30,
          "StorageClass": "STANDARD_IA"
        },
        {
          "Days": 90,
          "StorageClass": "GLACIER"
        }
      ],
      "Expiration": {
        "Days": 365
      }
    }
  ]
}
```

## 주의사항

### 1. 최소 저장 기간
**요구사항**:
- Standard-IA: 30일
- Glacier: 90일
- Glacier Deep Archive: 180일

**위반 시**: 조기 삭제 요금 발생

### 2. 검색 비용
**Standard-IA**:
- 검색 비용: GB당 $0.01
- 자주 액세스하면 Standard가 더 저렴할 수 있음

**Glacier**:
- 검색 비용: GB당 $0.02 (Expedited)
- 복원 시간에 따라 비용 다름

### 3. 전환 지연
**특징**:
- 전환은 비동기적으로 실행
- 완료까지 시간 소요
- 즉시 전환되지 않음

## 관련 서비스

### CloudWatch
- 접근 패턴 분석
- 비용 모니터링

### Cost Explorer
- 비용 분석
- 수명 주기 정책 효과 확인

### S3 Analytics
- 접근 패턴 분석
- 전환 권장사항

## 참고 자료
- [S3 수명 주기 관리 공식 문서](https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lifecycle-mgmt.html)
- [S3 스토리지 클래스](https://aws.amazon.com/s3/storage-classes/)

