# EC2 구매 옵션 및 비용 최적화

## 개요
EC2는 다양한 구매 옵션을 제공하여 워크로드 특성에 따라 비용을 최적화할 수 있습니다. 각 옵션의 특징과 사용 사례를 이해하여 적절한 선택이 필요합니다.

## 핵심 개념

### 구매 옵션 비교
**주요 옵션**:
1. **온디맨드 (On-Demand)**: 시간당 비용, 약정 없음
2. **예약형 (Reserved Instances)**: 1-3년 약정, 최대 72% 할인
3. **Savings Plans**: 유연한 약정, 최대 72% 할인
4. **스팟 (Spot)**: 최대 90% 할인, 중단 가능

## 1. 온디맨드 (On-Demand) 인스턴스

### 특징
**정의**: 시간당 비용을 지불하는 인스턴스

**특징**:
- 약정 없음
- 즉시 시작/종료 가능
- 가장 유연함
- 가장 비쌈

**비용**:
- 시간당 비용 지불
- 사용한 만큼만 지불
- 추가 비용 없음

### 사용 사례
**적합한 경우**:
- 예측 불가능한 워크로드
- 단기 프로젝트
- 테스트 환경
- 트래픽 스파이크

**예시**:
- 개발/테스트 환경
- 프로토타입
- 일회성 작업

### 비용 예시
```
m5.large (온디맨드)
- 시간당: $0.096
- 월간 (730시간): $70.08
- 연간: $840.96
```

## 2. 예약형 인스턴스 (Reserved Instances)

### 특징
**정의**: 1년 또는 3년 약정으로 할인받는 인스턴스

**할인율**:
- **Standard**: 최대 72% 할인
- **Convertible**: 최대 66% 할인 (인스턴스 유형 변경 가능)

**결제 옵션**:
- **전액 선불 (All Upfront)**: 최대 할인
- **부분 선불 (Partial Upfront)**: 중간 할인
- **선불 없음 (No Upfront)**: 최소 할인

### Standard vs Convertible

#### Standard RI
**특징**:
- 인스턴스 유형 변경 불가
- 최대 할인
- 특정 인스턴스 유형에 고정

**예시**:
```
m5.large Standard RI (3년, 전액 선불)
- 할인율: 72%
- 월간: $19.68 (원래 $70.08)
```

#### Convertible RI
**특징**:
- 인스턴스 유형 변경 가능
- 약간 낮은 할인
- 유연성 제공

**예시**:
```
m5.large Convertible RI (3년, 전액 선불)
- 할인율: 66%
- 월간: $23.83 (원래 $70.08)
```

### 사용 사례
**적합한 경우**:
- 예측 가능한 워크로드
- 장기 프로젝트
- 프로덕션 환경
- 안정적인 트래픽

**예시**:
- 웹 서버
- 데이터베이스
- 애플리케이션 서버

### 비용 최적화 전략
1. **사용 패턴 분석**: CloudWatch로 사용량 분석
2. **적절한 기간 선택**: 1년 vs 3년
3. **결제 옵션 선택**: 할인율과 현금 흐름 고려
4. **인스턴스 크기 최적화**: 적절한 크기 선택

## 3. Savings Plans

### 특징
**정의**: 유연한 약정 기반 할인 플랜

**유형**:

#### 1. Compute Savings Plans
**특징**:
- 모든 EC2 인스턴스 유형 사용 가능
- 모든 리전 사용 가능
- Fargate, Lambda도 포함
- 최대 72% 할인

**예시**:
```
$100/시간 약정
- 모든 EC2 인스턴스 유형 사용 가능
- 모든 리전 사용 가능
- 약정 금액 내에서 할인 적용
```

#### 2. EC2 Instance Savings Plans
**특징**:
- 특정 인스턴스 패밀리 (예: M5)
- 특정 리전
- 최대 72% 할인
- 인스턴스 크기 변경 가능

**예시**:
```
M5 패밀리 Savings Plan
- m5.large, m5.xlarge 등 모든 크기 사용 가능
- 특정 리전에서만 적용
```

### Savings Plans vs Reserved Instances

| 항목 | Savings Plans | Reserved Instances |
|------|---------------|-------------------|
| **유연성** | 높음 | 낮음 |
| **인스턴스 유형** | 모든 유형 | 특정 유형 |
| **리전** | 모든 리전 | 특정 리전 |
| **할인율** | 최대 72% | 최대 72% |
| **사용 사례** | 다양한 워크로드 | 예측 가능한 워크로드 |

### 사용 사례
**적합한 경우**:
- 다양한 인스턴스 유형 사용
- 여러 리전 사용
- 유연성 필요
- 예측 가능한 사용량

**예시**:
- Auto Scaling Group
- 다양한 워크로드
- 개발/프로덕션 혼합

## 4. 스팟 인스턴스 (Spot Instances)

### 특징
**정의**: 미사용 EC2 용량을 할인된 가격에 제공

**할인율**: 최대 90% 할인

**특징**:
- 중단 가능 (2분 경고)
- 가격 변동
- 용량에 따라 가용성 변동

**작동 원리**:
```
AWS가 미사용 용량 판매
  ↓
사용자가 최대 가격 설정
  ↓
현재 가격이 최대 가격 이하이면 실행
  ↓
가격 상승 또는 용량 부족 시 중단
```

### 사용 사례
**적합한 경우**:
- 중단 가능한 워크로드
- 배치 작업
- 빅 데이터 분석
- CI/CD 파이프라인

**부적합한 경우**:
- 지속적인 서비스
- 데이터베이스
- 실시간 애플리케이션

### 스팟 인스턴스 전략

#### 1. 최대 가격 설정
**전략**:
- 온디맨드 가격의 70-80% 설정
- 할인과 가용성 균형

#### 2. 다양한 인스턴스 유형
**전략**:
- 여러 인스턴스 유형 지정
- 가용성 향상

#### 3. 다중 AZ 배포
**전략**:
- 여러 AZ에 배포
- 단일 AZ 장애 대비

#### 4. 스팟 플릿 (Spot Fleet)
**정의**: 여러 인스턴스 유형과 AZ를 자동으로 관리

**특징**:
- 자동으로 최적 인스턴스 선택
- 중단 시 자동 교체
- 목표 용량 유지

## 구매 옵션 선택 전략

### 워크로드별 선택

#### 예측 가능한 워크로드
**선택**: Reserved Instances 또는 Savings Plans
- 장기 약정
- 최대 할인
- 안정적인 비용

#### 가변적인 워크로드
**선택**: Savings Plans
- 유연성
- 할인 혜택
- 다양한 인스턴스 유형

#### 중단 가능한 워크로드
**선택**: 스팟 인스턴스
- 최대 할인
- 비용 최적화
- 중단 허용

#### 예측 불가능한 워크로드
**선택**: 온디맨드
- 유연성
- 약정 없음
- 즉시 시작/종료

### 하이브리드 전략
**구성**:
```
기본 용량: Reserved Instances (60%)
피크 용량: 온디맨드 (30%)
배치 작업: 스팟 인스턴스 (10%)
```

**장점**:
- 비용 최적화
- 유연성 유지
- 안정성 확보

## 비용 계산 예시

### 시나리오: m5.large 인스턴스 1개, 24/7 실행

#### 온디맨드
```
시간당: $0.096
월간: $70.08
연간: $840.96
```

#### Reserved Instance (3년, 전액 선불)
```
월간: $19.68
연간: $236.16
할인: 72%
```

#### Savings Plan (3년, 전액 선불)
```
월간: $19.68
연간: $236.16
할인: 72%
```

#### 스팟 인스턴스 (평균 70% 할인)
```
시간당: $0.029
월간: $21.17
연간: $254.04
할인: 70%
```

## 모범 사례

### 1. 사용 패턴 분석
- CloudWatch로 사용량 분석
- 예측 가능한 패턴 식별
- 적절한 옵션 선택

### 2. 점진적 전환
- 온디맨드로 시작
- 패턴 파악 후 RI/Savings Plans 전환
- 스팟 인스턴스 테스트

### 3. 정기적인 검토
- 사용 패턴 변화 모니터링
- RI/Savings Plans 최적화
- 불필요한 약정 해제

### 4. 자동화
- Auto Scaling과 통합
- 스팟 인스턴스 자동 관리
- 비용 알람 설정

## 관련 서비스

### Cost Explorer
- 비용 분석
- RI/Savings Plans 권장사항

### AWS Budgets
- 비용 예산 설정
- 알람

### Auto Scaling
- 인스턴스 자동 조정
- 비용 최적화

## 참고 자료
- [EC2 구매 옵션](https://aws.amazon.com/ec2/pricing/)
- [Savings Plans](https://aws.amazon.com/savingsplans/)
- [스팟 인스턴스](https://aws.amazon.com/ec2/spot/)

