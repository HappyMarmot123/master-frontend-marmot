# 데이터베이스 비용 최적화

## 개요
데이터베이스는 클라우드 비용의 중요한 부분입니다. 서버리스 옵션, 읽기 전용 복제본, 적절한 엔진 선택 등을 통해 비용을 최적화할 수 있습니다.

## 핵심 개념

### 데이터베이스 비용 구성
**주요 비용 요소**:
1. **인스턴스 비용**: 컴퓨팅 리소스
2. **스토리지 비용**: 데이터 저장
3. **백업 비용**: 백업 스토리지
4. **데이터 전송 비용**: 네트워크 전송

**비용 최적화 목표**:
- 불필요한 리소스 제거
- 적절한 인스턴스 크기 선택
- 서버리스 옵션 활용
- 백업 정책 최적화

## 서버리스 데이터베이스

### Aurora Serverless v2

#### 특징
**정의**: 자동으로 확장되는 Aurora

**특징**:
- 자동 스케일링 (초 단위)
- 최소/최대 ACU 설정
- 사용한 만큼만 지불
- 유휴 비용 최소화

**비용**:
- ACU-시간당 비용
- 사용한 만큼만 지불

**비용 계산**:
```
평균 ACU: 2 ACU
시간당: 2 ACU × $0.12 = $0.24
월간: $0.24 × 730시간 = $175.20

전통적인 Aurora (db.t3.medium):
시간당: $0.052
월간: $37.96

→ Serverless v2가 더 비쌈 (지속적 사용 시)
→ 하지만 가변 트래픽에서는 유리
```

#### 사용 사례
**적합한 경우**:
- 가변 트래픽
- 예측 불가능한 워크로드
- 개발/테스트 환경
- 유휴 시간이 많은 애플리케이션

**부적합한 경우**:
- 지속적인 고부하
- 예측 가능한 워크로드
- 비용 최적화 우선

### DynamoDB 온디맨드

#### 특징
**정의**: 사용한 만큼만 지불하는 DynamoDB 용량 모드

**특징**:
- 용량 프로비저닝 불필요
- 자동 확장
- 예측 불가능한 트래픽에 적합

**비용**:
- 읽기: 100만 요청당 $0.25
- 쓰기: 100만 요청당 $1.25

**비용 계산**:
```
월 100만 읽기, 10만 쓰기
- 읽기: $0.25
- 쓰기: $0.125
- 총: $0.375/월

프로비저닝된 용량:
- 읽기: 5 RCU × $0.00013 = $0.00065/시간 × 730 = $0.47/월
- 쓰기: 1 WCU × $0.00065 = $0.00065/시간 × 730 = $0.47/월
- 총: $0.94/월

→ 온디맨드가 60% 저렴 (이 예시에서)
```

#### 사용 사례
**적합한 경우**:
- 예측 불가능한 트래픽
- 스파이크 트래픽
- 개발/테스트 환경
- 초기 단계 애플리케이션

**부적합한 경우**:
- 예측 가능한 트래픽
- 일관된 워크로드
- 비용 최적화 우선

## 읽기 전용 복제본 비용 최적화

### 읽기 전용 복제본이란?
**정의**: 읽기 작업을 처리하는 복제본

**비용**:
- 인스턴스 비용 발생
- 스토리지 비용 발생

### 비용 최적화 전략

#### 1. 필요한 만큼만 생성
**전략**:
- 읽기 부하 분석
- 필요한 복제본 수만 생성
- 불필요한 복제본 제거

**예시**:
```
읽기 부하가 낮은 경우:
- 읽기 전용 복제본 1개로 충분

읽기 부하가 높은 경우:
- 여러 복제본 생성
- 읽기 부하 분산
```

#### 2. 적절한 인스턴스 크기
**전략**:
- 읽기 부하에 맞는 크기 선택
- 오버프로비저닝 방지
- 필요 시 확장

#### 3. 다른 리전 복제본
**전략**:
- 지리적 분산 필요 시에만 생성
- 비용 증가 고려
- DR 목적이 아닌 경우 제거

### 읽기 전용 복제본 vs ElastiCache

#### 비교
**읽기 전용 복제본**:
- 데이터베이스 쿼리 실행
- 복잡한 쿼리 가능
- 비용: 인스턴스 비용

**ElastiCache**:
- 키-값 캐시
- 빠른 읽기
- 비용: 인스턴스 비용 (더 저렴)

**선택 기준**:
- 단순 읽기: ElastiCache
- 복잡한 쿼리: 읽기 전용 복제본

## 데이터베이스 엔진 및 유형 선택

### RDS 엔진 비교

#### MySQL vs PostgreSQL
**비용**:
- 동일한 인스턴스 크기에서 비용 동일
- 기능 차이로 선택

**선택 기준**:
- 기존 애플리케이션 호환성
- 기능 요구사항
- 성능 특성

#### Aurora vs RDS
**비용 비교**:
```
RDS MySQL (db.t3.medium):
- 시간당: $0.052
- 월간: $37.96

Aurora MySQL (db.t3.medium):
- 시간당: $0.052
- 월간: $37.96
- 스토리지: GB당 $0.10

→ 비용 유사하지만 Aurora가 더 높은 성능
```

**선택 기준**:
- 높은 성능 필요: Aurora
- 비용 최적화: RDS
- 자동 확장: Aurora Serverless

### DynamoDB vs RDS

#### 비용 비교
**시나리오**: 간단한 키-값 조회

**DynamoDB**:
```
월 100만 읽기, 10만 쓰기
- 온디맨드: $0.375/월
- 프로비저닝: $0.94/월
```

**RDS**:
```
db.t3.micro (24/7)
- 시간당: $0.017
- 월간: $12.41
- 스토리지: $0.115/GB
```

**선택 기준**:
- NoSQL 필요: DynamoDB
- 관계형 데이터: RDS
- 서버리스: DynamoDB 온디맨드

## 백업 및 보존 정책 비용 최적화

### 자동 백업 비용
**RDS 자동 백업**:
- 백업 스토리지: GB당 $0.095/월
- 백업 기간에 따라 비용 증가

**최적화 전략**:
- 필요한 기간만 보관
- 불필요한 백업 삭제
- 수동 스냅샷으로 장기 보관

### 스냅샷 비용
**비용**:
- GB당 $0.05/월

**최적화 전략**:
- 필요한 스냅샷만 보관
- 오래된 스냅샷 삭제
- 자동화된 정리 정책

### 보존 정책 예시
```
일일 백업: 최근 7일
주간 백업: 최근 4주
월간 백업: 최근 12개월
연간 백업: 장기 보관 (S3 Glacier)
```

## 인스턴스 크기 최적화

### 오버프로비저닝 방지
**문제**: 과도한 인스턴스 크기

**해결**:
- CloudWatch로 사용량 분석
- 적절한 크기 선택
- 필요 시 확장

**비용 절감**:
```
db.m5.xlarge → db.m5.large
- 시간당: $0.192 → $0.096
- 월간: $140.16 → $70.08
- 절감: $70.08/월 (50%)
```

### 언더프로비저닝 방지
**문제**: 성능 저하

**해결**:
- 성능 모니터링
- 필요 시 확장
- 읽기 전용 복제본 추가

## 실제 최적화 예시

### 예시 1: 개발 환경
```
전략:
- Aurora Serverless v2 사용
- 최소 ACU: 0.5
- 최대 ACU: 2
- 유휴 시간 비용 최소화

비용:
- 사용 시에만 지불
- 유휴 시간 비용 없음
```

### 예시 2: 프로덕션 환경
```
전략:
- RDS 예약형 인스턴스
- 읽기 전용 복제본 1개
- 자동 백업 7일
- 수동 스냅샷 주간

비용:
- 예약형 할인: 72%
- 필요한 복제본만 생성
- 백업 정책 최적화
```

### 예시 3: 마이크로서비스
```
전략:
- DynamoDB 온디맨드
- 각 서비스별 테이블
- 사용한 만큼만 지불

비용:
- 예측 불가능한 트래픽에 적합
- 자동 확장
- 유휴 비용 없음
```

## 모범 사례

### 1. 적절한 데이터베이스 선택
- 워크로드 특성 분석
- 관계형 vs NoSQL
- 서버리스 vs 전통적

### 2. 인스턴스 크기 최적화
- 사용량 분석
- 적절한 크기 선택
- 필요 시 확장

### 3. 백업 정책 최적화
- 필요한 기간만 보관
- 자동화된 정리
- 장기 보관은 S3 Glacier

### 4. 모니터링
- CloudWatch로 비용 추적
- 사용량 분석
- 최적화 기회 식별

## 관련 서비스

### ElastiCache
- 읽기 성능 향상
- 데이터베이스 부하 감소
- 비용 절감

### AWS Backup
- 중앙 집중식 백업
- 수명 주기 정책
- 비용 최적화

### Cost Explorer
- 비용 분석
- 데이터베이스 비용 추적

## 참고 자료
- [Aurora Serverless](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/aurora-serverless.html)
- [DynamoDB 요금](https://aws.amazon.com/dynamodb/pricing/)
- [RDS 요금](https://aws.amazon.com/rds/pricing/)

