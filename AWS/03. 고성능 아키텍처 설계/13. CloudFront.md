# CloudFront

## 개요
Amazon CloudFront는 전 세계에 분산된 엣지 로케이션을 통해 콘텐츠를 전달하는 CDN (Content Delivery Network) 서비스입니다. 사용자에게 가장 가까운 위치에서 콘텐츠를 제공하여 지연 시간을 최소화합니다.

## 핵심 개념

### CloudFront란?
**정의**: 글로벌 콘텐츠 전송 네트워크 (CDN)

**주요 기능**:
- 정적 콘텐츠 전송
- 동적 콘텐츠 가속
- 비디오 스트리밍
- API 가속
- DDoS 보호 (Shield 통합)

**작동 원리**:
```
사용자 요청
  ↓
가장 가까운 엣지 로케이션
  ├── 캐시 히트 → 즉시 반환
  └── 캐시 미스 → 오리진에서 가져와 캐싱 → 반환
```

### CDN이란?
**정의**: Content Delivery Network, 콘텐츠를 전 세계에 분산된 서버에 캐싱하여 사용자에게 빠르게 전달하는 네트워크

**왜 필요한가?**:
- 지리적 거리로 인한 지연 시간 감소
- 오리진 서버 부하 감소
- 대역폭 비용 절감
- 가용성 향상

## CloudFront 구성 요소

### 1. 배포 (Distribution)
**정의**: CloudFront 설정의 컨테이너

**유형**:
- **Web Distribution**: HTTP/HTTPS 콘텐츠
- **RTMP Distribution**: 미디어 스트리밍 (레거시)

### 2. 오리진 (Origin)
**정의**: 콘텐츠의 원본 소스

**오리진 유형**:
- **S3 버킷**: 정적 웹사이트, 파일
- **Custom Origin**: HTTP 서버
  - EC2 인스턴스
  - ALB
  - 온프레미스 서버
- **MediaStore**: 미디어 스트리밍

### 3. 캐시 동작 (Cache Behavior)
**정의**: 특정 경로 패턴에 대한 캐싱 규칙

**설정**:
- 경로 패턴 (예: /images/*)
- 캐싱 정책
- 오리진 지정
- 뷰어 프로토콜 정책

### 4. 엣지 로케이션
**정의**: 전 세계에 분산된 캐시 서버

**특징**:
- 수백 개의 엣지 로케이션
- 사용자와 가장 가까운 위치
- 자동 라우팅

## 캐싱 동작

### 정적 콘텐츠 캐싱
**정의**: 변경되지 않는 콘텐츠를 캐싱

**예시**:
- 이미지
- CSS 파일
- JavaScript 파일
- 비디오 파일

**캐싱 설정**:
- **TTL**: 캐시 유지 시간
- **Cache-Control 헤더**: HTTP 헤더로 TTL 제어
- **최소 TTL**: 최소 캐시 시간
- **최대 TTL**: 최대 캐시 시간
- **기본 TTL**: 기본 캐시 시간

**작동 원리**:
```
1. 사용자 요청 → 엣지 로케이션
2. 캐시 확인
   - 캐시 히트 → 즉시 반환
   - 캐시 미스 → 오리진에서 가져옴 → 캐싱 → 반환
3. TTL 동안 캐시 유지
```

### 동적 콘텐츠 가속
**정의**: 동적 콘텐츠도 CloudFront를 통해 전달하여 성능 향상

**예시**:
- API 응답
- 개인화된 콘텐츠
- 실시간 데이터

**가속 방법**:
- **AWS 백본 네트워크**: 최적화된 네트워크 경로
- **연결 최적화**: TCP 최적화
- **압축**: 응답 압축

**캐싱 전략**:
- 쿼리 문자열 기반 캐싱
- 헤더 기반 캐싱
- 쿠키 기반 캐싱

## CloudFront 기능

### 1. SSL/TLS 지원
**인증서**:
- AWS 관리형 인증서 사용
- 커스텀 인증서 사용 가능
- SNI (Server Name Indication) 지원

**프로토콜 정책**:
- **HTTP Only**: HTTP만 허용
- **HTTPS Only**: HTTPS만 허용
- **Redirect HTTP to HTTPS**: HTTP를 HTTPS로 리디렉션
- **Match Viewer**: 뷰어 프로토콜과 일치

### 2. 지리적 제한 (Geo-Restriction)
**정의**: 특정 국가에서의 액세스 허용/차단

**사용 사례**:
- 라이선스 제한
- 규정 준수
- 보안

**설정**:
- 화이트리스트: 허용할 국가
- 블랙리스트: 차단할 국가

### 3. 서명된 URL/쿠키
**정의**: 인증된 사용자만 콘텐츠에 접근

**사용 사례**:
- 프리미엄 콘텐츠
- 비공개 파일
- 시간 제한 액세스

**작동 원리**:
```
1. 서버가 서명된 URL 생성
2. 사용자가 서명된 URL로 요청
3. CloudFront가 서명 검증
4. 유효하면 콘텐츠 제공
```

### 4. 필드 레벨 암호화
**정의**: 특정 필드만 암호화하여 전송

**사용 사례**:
- 신용카드 정보
- 개인정보
- 민감한 데이터

### 5. Lambda@Edge
**정의**: 엣지 로케이션에서 Lambda 함수 실행

**사용 사례**:
- 요청/응답 변환
- A/B 테스트
- 사용자 인증
- 헤더 조작

**실행 시점**:
- Viewer Request: 뷰어 요청 시
- Origin Request: 오리진 요청 전
- Origin Response: 오리진 응답 후
- Viewer Response: 뷰어 응답 전

## CloudFront와 S3 통합

### S3를 오리진으로 사용
**구성**:
```
CloudFront
  ↓
S3 버킷 (오리진)
```

**장점**:
- S3 직접 액세스 비용 절감
- 전 세계 빠른 전송
- OAI (Origin Access Identity)로 보안 강화

**OAI란?**:
- CloudFront만 S3에 접근 가능하도록 제한
- S3 버킷을 비공개로 설정
- CloudFront를 통해서만 접근 가능

## CloudFront와 ALB 통합

### ALB를 오리진으로 사용
**구성**:
```
CloudFront
  ↓
ALB (오리진)
  ↓
EC2/ECS
```

**장점**:
- 전 세계 사용자에게 빠른 응답
- ALB 부하 감소
- 동적 콘텐츠 가속

**설정**:
- ALB를 Custom Origin으로 추가
- 헬스 체크 설정
- 캐싱 정책 설정

## 비용 최적화

### 캐싱 최적화
- 적절한 TTL 설정
- 불필요한 캐시 무효화 최소화
- 정적 콘텐츠는 긴 TTL

### 데이터 전송 최적화
- 압축 활성화
- 적절한 오리진 선택
- 지역별 엣지 로케이션 활용

### 캐시 무효화
- 필요한 경우만 사용 (비용 발생)
- 경로별 무효화
- 와일드카드 사용 가능

## 비용

### 데이터 전송
- 첫 10TB/월: GB당 $0.085
- 다음 40TB/월: GB당 $0.080
- 다음 100TB/월: GB당 $0.060

### 요청
- HTTP 요청: 10,000개당 $0.0075
- HTTPS 요청: 10,000개당 $0.0100

### 캐시 무효화
- 처음 1,000개/월: 무료
- 이후: 경로당 $0.005

## 모범 사례

### 1. 캐싱 전략
- 정적 콘텐츠: 긴 TTL
- 동적 콘텐츠: 짧은 TTL 또는 캐싱 비활성화
- 버전 관리: 파일명에 버전 포함

### 2. 보안
- HTTPS 사용
- OAI로 S3 보호
- 서명된 URL/쿠키 사용

### 3. 성능
- 압축 활성화
- 적절한 오리진 선택
- Lambda@Edge 최적화

### 4. 모니터링
- CloudWatch 지표 모니터링
- 액세스 로그 분석
- 캐시 히트율 추적

## 관련 서비스

### S3
- 정적 콘텐츠 저장
- CloudFront 오리진

### ALB
- 동적 콘텐츠 오리진
- CloudFront와 통합

### Lambda@Edge
- 엣지에서 코드 실행
- 요청/응답 변환

### Shield
- DDoS 보호
- CloudFront와 통합

## 참고 자료
- [CloudFront 공식 문서](https://docs.aws.amazon.com/cloudfront/)
- [CloudFront 모범 사례](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/best-practices.html)

