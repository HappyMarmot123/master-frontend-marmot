# Batch & EMR

## 개요
AWS Batch와 Amazon EMR은 대규모 데이터 처리 및 분석을 위한 관리형 서비스입니다. Batch는 배치 작업을 실행하고, EMR은 빅 데이터 분석을 위한 Hadoop 클러스터를 제공합니다.

## AWS Batch

### Batch란?
**정의**: 수천 개의 배치 컴퓨팅 작업을 효율적으로 실행하는 완전 관리형 서비스

**특징**:
- 서버 관리 불필요
- 자동 확장
- 작업 스케줄링
- 다양한 컴퓨팅 리소스 활용

**작동 원리**:
```
작업 제출
  ↓
Batch 큐
  ↓
컴퓨팅 환경 (EC2, Fargate)
  ↓
작업 실행
```

### Batch 구성 요소

#### 1. 작업 정의 (Job Definition)
**정의**: 작업 실행 방법을 정의

**포함 내용**:
- 컨테이너 이미지
- CPU/메모리 요구사항
- 환경 변수
- IAM 역할

**예시**:
```json
{
  "jobDefinitionName": "data-processing",
  "type": "container",
  "containerProperties": {
    "image": "my-image:latest",
    "vcpus": 4,
    "memory": 8192,
    "jobRoleArn": "arn:aws:iam::..."
  }
}
```

#### 2. 작업 큐 (Job Queue)
**정의**: 작업을 보관하고 스케줄링하는 큐

**특징**:
- 우선순위 설정 가능
- 여러 컴퓨팅 환경 연결 가능
- 작업 순서 관리

#### 3. 컴퓨팅 환경 (Compute Environment)
**정의**: 작업을 실행하는 인프라

**유형**:

1. **관리형 (Managed)**
   - Batch가 인프라 관리
   - EC2 인스턴스 자동 프로비저닝
   - 스팟 인스턴스 사용 가능

2. **비관리형 (Unmanaged)**
   - 사용자가 인프라 관리
   - 기존 EC2 인스턴스 사용

**설정**:
- 인스턴스 유형
- 최소/최대 vCPU
- 스팟 인스턴스 사용 여부

### Batch 사용 사례

#### 시나리오 1: 데이터 변환
```
S3에 원본 데이터 업로드
  ↓
Batch 작업 제출 (데이터 변환)
  ↓
여러 작업 병렬 실행
  ↓
변환된 데이터 S3에 저장
```

#### 시나리오 2: 이미지 처리
```
이미지 업로드
  ↓
Batch 작업 (이미지 리사이징)
  ↓
처리된 이미지 저장
```

#### 시나리오 3: 과학 컴퓨팅
```
입력 데이터 준비
  ↓
Batch 작업 (시뮬레이션)
  ↓
결과 분석
```

### Batch 장점

1. **자동 확장**
   - 작업 수에 따라 자동 확장
   - 작업 완료 시 자동 축소

2. **비용 최적화**
   - 스팟 인스턴스 활용
   - 사용한 만큼만 지불

3. **서버 관리 불필요**
   - 인프라 관리 자동화
   - 패치 및 업데이트 자동

## Amazon EMR

### EMR이란?
**정의**: 빅 데이터 분석을 위한 관리형 Hadoop 클러스터

**특징**:
- Hadoop, Spark, Hive 등 지원
- 자동 확장
- 완전 관리형
- 빠른 시작 (분 단위)

**작동 원리**:
```
EMR 클러스터 생성
  ↓
마스터 노드 + 코어 노드 + 작업 노드
  ↓
데이터 처리 (Hadoop/Spark)
  ↓
결과 저장
```

### EMR 구성 요소

#### 1. 마스터 노드 (Master Node)
**정의**: 클러스터를 관리하는 노드

**역할**:
- 작업 스케줄링
- 클러스터 관리
- 모니터링

**특징**:
- 단일 마스터 노드 (기본)
- 고가용성 옵션 (3개 마스터 노드)

#### 2. 코어 노드 (Core Node)
**정의**: 데이터를 저장하고 처리하는 노드

**역할**:
- HDFS 데이터 저장
- 작업 실행
- 데이터 복제

**특징**:
- 데이터 저장 (종료 시 데이터 손실)
- 자동 확장 불가 (수동 조정)

#### 3. 작업 노드 (Task Node)
**정의**: 데이터 처리만 수행하는 노드

**역할**:
- 작업 실행
- 데이터 처리

**특징**:
- 데이터 저장 안 함
- 자동 확장 가능
- 스팟 인스턴스 사용 가능

### EMR 애플리케이션

#### 1. Hadoop
**정의**: 대규모 데이터 분산 처리 프레임워크

**구성 요소**:
- **HDFS**: 분산 파일 시스템
- **MapReduce**: 분산 처리 프레임워크
- **YARN**: 리소스 관리

**사용 사례**:
- 대규모 데이터 처리
- 배치 분석
- 데이터 변환

#### 2. Spark
**정의**: 인메모리 데이터 처리 엔진

**특징**:
- 빠른 처리 속도
- 실시간 스트리밍
- 머신러닝 지원

**사용 사례**:
- 실시간 분석
- 머신러닝
- 스트리밍 처리

#### 3. Hive
**정의**: SQL 인터페이스를 제공하는 데이터 웨어하우스

**특징**:
- SQL 쿼리
- 대규모 데이터 분석
- 테이블 메타데이터 관리

**사용 사례**:
- 데이터 웨어하우스
- SQL 기반 분석
- 리포트 생성

#### 4. Presto
**정의**: 분산 SQL 쿼리 엔진

**특징**:
- 빠른 쿼리 성능
- 다양한 데이터 소스
- 대화형 쿼리

**사용 사례**:
- 대화형 분석
- 데이터 탐색
- 빠른 쿼리

### EMR 클러스터 유형

#### 1. 장기 실행 클러스터
**정의**: 지속적으로 실행되는 클러스터

**특징**:
- 24/7 실행
- 지속적인 데이터 처리
- 높은 비용

**사용 사례**:
- 실시간 데이터 처리
- 지속적인 분석
- 데이터 파이프라인

#### 2. 임시 클러스터
**정의**: 작업 완료 후 종료되는 클러스터

**특징**:
- 작업 완료 시 자동 종료
- 비용 효율적
- 필요 시에만 실행

**사용 사례**:
- 일회성 분석
- 주기적인 배치 작업
- 비용 최적화

### EMR 스토리지 옵션

#### 1. HDFS (Hadoop Distributed File System)
**정의**: EMR 클러스터 내부 분산 파일 시스템

**특징**:
- 클러스터 내부 스토리지
- 클러스터 종료 시 데이터 손실
- 빠른 액세스

**사용 사례**:
- 중간 데이터 저장
- 처리 중 데이터
- 임시 데이터

#### 2. EMRFS (EMR File System)
**정의**: S3를 HDFS처럼 사용

**특징**:
- S3를 기본 스토리지로 사용
- 영구 스토리지
- 클러스터 종료 후에도 데이터 유지

**사용 사례**:
- 입력 데이터 저장
- 결과 데이터 저장
- 영구 스토리지 필요

#### 3. 로컬 스토리지
**정의**: 인스턴스 스토어 또는 EBS

**특징**:
- 빠른 액세스
- 임시 데이터
- 인스턴스 종료 시 손실 가능

## Batch vs EMR 비교

| 항목 | Batch | EMR |
|------|-------|-----|
| **목적** | 일반 배치 작업 | 빅 데이터 분석 |
| **프레임워크** | 컨테이너 기반 | Hadoop/Spark 등 |
| **사용 사례** | 데이터 변환, 이미지 처리 | 빅 데이터 분석, 머신러닝 |
| **복잡도** | 낮음 | 높음 |
| **비용** | 작업 기반 | 클러스터 시간 기반 |

## 사용 사례

### Batch 사용 예시
```
일일 리포트 생성:
1. 데이터 수집 (S3)
2. Batch 작업 제출 (데이터 처리)
3. 여러 작업 병렬 실행
4. 결과 저장 (S3)
5. 클러스터 자동 종료
```

### EMR 사용 예시
```
로그 분석:
1. 로그 파일 S3에 저장
2. EMR 클러스터 시작
3. Spark 작업 실행 (로그 분석)
4. 결과 저장 (S3 또는 데이터베이스)
5. 클러스터 종료
```

## 모범 사례

### Batch 모범 사례
1. **작업 크기 최적화**: 적절한 작업 단위로 분할
2. **스팟 인스턴스 활용**: 비용 절감
3. **우선순위 설정**: 중요한 작업 우선 처리
4. **재시도 정책**: 실패한 작업 자동 재시도

### EMR 모범 사례
1. **임시 클러스터 사용**: 비용 최적화
2. **S3 사용**: 영구 스토리지
3. **스팟 인스턴스 활용**: 작업 노드에 사용
4. **자동 확장**: 워크로드에 따라 조정

## 비용

### Batch
- 컴퓨팅 리소스 비용만 지불
- 스팟 인스턴스 활용 시 최대 90% 할인

### EMR
- EC2 인스턴스 비용
- EMR 관리 비용 (인스턴스 시간당 $0.10)
- 스토리지 비용 (S3 사용 시)

## 관련 서비스

### S3
- 입력 데이터 저장
- 결과 데이터 저장
- EMRFS로 사용

### Lambda
- EMR 클러스터 시작
- Batch 작업 제출

### CloudWatch
- 모니터링
- 로그 수집

## 참고 자료
- [AWS Batch 공식 문서](https://docs.aws.amazon.com/batch/)
- [EMR 공식 문서](https://docs.aws.amazon.com/emr/)
- [EMR 모범 사례](https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-best-practices.html)

