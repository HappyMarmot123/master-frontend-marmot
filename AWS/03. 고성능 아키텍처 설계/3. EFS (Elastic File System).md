# EFS (Elastic File System)

## 개요
Amazon EFS는 AWS 클라우드와 온프레미스 리소스에서 사용할 수 있는 완전 관리형 탄력적인 파일 스토리지 서비스입니다. 여러 EC2 인스턴스가 동시에 접근할 수 있는 공유 파일 시스템을 제공합니다.

## 핵심 개념

### EFS란?
**정의**: 여러 인스턴스가 동시에 접근할 수 있는 공유 파일 시스템

**특징**:
- **NFS 프로토콜**: 표준 NFSv4 프로토콜 사용
- **동시 접근**: 여러 EC2 인스턴스가 동시에 접근 가능
- **자동 확장**: 페타바이트 규모까지 자동 확장
- **완전 관리형**: 서버 관리 불필요

**작동 원리**:
```
EC2 인스턴스 1
  ↓ (NFS 마운트)
EC2 인스턴스 2 → EFS 파일 시스템 (공유)
  ↓ (NFS 마운트)
EC2 인스턴스 3
```

### 파일 스토리지란?
**정의**: 파일과 디렉토리 계층 구조로 데이터를 저장하는 스토리지

**특징**:
- 파일 시스템 인터페이스
- 표준 파일 시스템 명령어 사용
- 여러 프로세스/인스턴스가 동시 접근 가능

**EBS와의 차이**:
- **EBS**: 단일 인스턴스 전용, 블록 스토리지
- **EFS**: 여러 인스턴스 공유, 파일 스토리지

## EFS 성능 모드

### 1. General Purpose (범용)
**정의**: 대부분의 워크로드에 적합한 성능 모드

**특징**:
- 낮은 지연 시간
- 높은 처리량
- 대부분의 워크로드에 적합

**사용 사례**:
- 웹 서버
- 콘텐츠 관리 시스템
- 홈 디렉토리
- 일반 파일 공유

### 2. Max I/O (최대 I/O)
**정의**: 높은 병렬성과 처리량이 필요한 워크로드용

**특징**:
- 매우 높은 처리량
- 높은 병렬성
- 지연 시간 증가 가능

**사용 사례**:
- 빅 데이터 분석
- 미디어 처리
- 과학 컴퓨팅
- 높은 병렬성 요구

## EFS 처리량 모드

### 1. 버스트 (Bursting)
**정의**: 파일 시스템 크기에 따라 처리량이 자동으로 조정

**특징**:
- 파일 시스템 크기에 비례
- 버스트 크레딧 시스템
- 작은 파일 시스템에 적합

**처리량 계산**:
```
기본 처리량: 파일 시스템 크기 (GB) × 0.1 MB/s
최대 버스트: 100 MB/s + (크기 × 0.1 MB/s)
```

**예시**:
- 100GB 파일 시스템: 10 MB/s 기본, 최대 110 MB/s 버스트
- 1TB 파일 시스템: 100 MB/s 기본, 최대 200 MB/s 버스트

### 2. 프로비저닝 (Provisioned)
**정의**: 필요한 처리량을 명시적으로 프로비저닝

**특징**:
- 일관된 처리량 보장
- 예측 가능한 성능
- 추가 비용 발생

**사용 사례**:
- 일관된 성능 필요
- 예측 가능한 워크로드
- 높은 처리량 요구

## EFS 스토리지 클래스

### 1. Standard (표준)
**정의**: 자주 액세스하는 파일용

**특징**:
- 빠른 액세스
- 높은 비용
- 자동으로 IA로 이동 가능

### 2. Standard-IA (Infrequent Access)
**정의**: 가끔 액세스하는 파일용

**특징**:
- 낮은 비용
- 액세스 시 검색 비용
- 자동으로 Standard에서 이동

**이동 조건**:
- 30일 이상 액세스하지 않은 파일
- 자동으로 Standard-IA로 이동

## EFS 아키텍처

### 기본 구조
```
VPC
  ├── 가용 영역 A
  │   └── EFS 마운트 타겟
  ├── 가용 영역 B
  │   └── EFS 마운트 타겟
  └── 가용 영역 C
      └── EFS 마운트 타겟

EC2 인스턴스들
  ↓ (NFS 마운트)
EFS 파일 시스템 (모든 AZ에서 접근 가능)
```

### 마운트 타겟
**정의**: 각 가용 영역에서 EFS에 접근하기 위한 네트워크 인터페이스

**특징**:
- 서브넷별로 하나씩 생성
- 보안 그룹으로 액세스 제어
- 여러 AZ에 배치 권장 (고가용성)

## 사용 사례

### 시나리오 1: 웹 서버 공유 스토리지
```
ALB
  ├── EC2 웹 서버 1
  │   └── EFS 마운트 (/var/www/html)
  ├── EC2 웹 서버 2
  │   └── EFS 마운트 (/var/www/html)
  └── EC2 웹 서버 3
      └── EFS 마운트 (/var/www/html)

→ 모든 웹 서버가 동일한 콘텐츠 공유
```

### 시나리오 2: 콘텐츠 관리 시스템
```
CMS 서버들
  ↓
EFS (이미지, 문서 저장)
  ↓
여러 서버에서 동시 접근
```

### 시나리오 3: 데이터 분석
```
분석 워커 노드들
  ↓
EFS (입력 데이터, 결과 저장)
  ↓
병렬 처리
```

## EFS vs EBS vs S3 비교

### 비교표

| 항목 | EFS | EBS | S3 |
|------|-----|-----|-----|
| **타입** | 파일 스토리지 | 블록 스토리지 | 객체 스토리지 |
| **접근** | 여러 인스턴스 동시 접근 | 단일 인스턴스 | HTTP/HTTPS API |
| **프로토콜** | NFS | 블록 디바이스 | REST API |
| **확장성** | 페타바이트 | 볼륨당 최대 16TB | 무제한 |
| **지연 시간** | 낮음 | 매우 낮음 | 높음 |
| **비용** | GB당 | GB당 | GB당 (저장소 클래스별) |
| **사용 사례** | 공유 파일 시스템 | 데이터베이스, 부트 볼륨 | 백업, 아카이브, 정적 웹사이트 |

### 선택 기준

#### EFS를 선택하는 경우
- 여러 인스턴스가 동시에 접근해야 함
- 공유 파일 시스템 필요
- 자동 확장 필요
- NFS 프로토콜 사용

#### EBS를 선택하는 경우
- 단일 인스턴스 전용
- 높은 IOPS 필요
- 낮은 지연 시간 필요
- 데이터베이스 스토리지

#### S3를 선택하는 경우
- 객체 스토리지 필요
- HTTP/HTTPS 접근
- 무제한 확장
- 백업 및 아카이브

## 모범 사례

### 1. 고가용성
- 여러 가용 영역에 마운트 타겟 생성
- 최소 2개 이상의 AZ 사용

### 2. 보안
- 보안 그룹으로 액세스 제어
- VPC 내부에서만 접근
- 암호화 활성화

### 3. 성능
- 적절한 성능 모드 선택
- 처리량 모드 최적화
- 인스턴스와 같은 리전에 배치

### 4. 비용 최적화
- Standard-IA 활용
- 불필요한 파일 정리
- 적절한 처리량 모드 선택

## 비용

### 저장 비용 (GB당 월 비용)
- **Standard**: $0.30
- **Standard-IA**: $0.025 (저장), $0.01/GB (검색)

### 처리량 비용
- **버스트**: 저장 비용에 포함
- **프로비저닝**: MB/s당 $0.06/시간

### 데이터 전송
- 리전 내: 무료
- 리전 간: GB당 $0.02

## 관련 서비스

### EC2
- EFS 마운트
- 여러 인스턴스 공유

### Lambda
- EFS 마운트 (VPC 내)
- 대용량 파일 처리

### ECS/EKS
- 컨테이너 간 파일 공유
- 영구 스토리지

## 참고 자료
- [EFS 공식 문서](https://docs.aws.amazon.com/efs/)
- [EFS 성능 모드](https://docs.aws.amazon.com/efs/latest/ug/performance.html)

