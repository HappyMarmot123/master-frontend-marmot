# S3 (Simple Storage Service)

## 개요
Amazon S3는 확장 가능한 객체 스토리지 서비스로, 데이터를 버킷에 객체로 저장합니다. 웹 스케일의 데이터 저장 및 검색에 사용됩니다.

## 핵심 개념

### 버킷 (Bucket)
- **정의**: 객체를 저장하는 컨테이너
- **특징**:
  - 전역적으로 고유한 이름
  - 리전별로 생성
  - 무제한 저장 용량
  - 버전 관리 가능

### 객체 (Object)
- **정의**: 버킷에 저장되는 데이터 단위
- **구성 요소**:
  - 키 (Key): 객체 이름
  - 값 (Value): 실제 데이터
  - 메타데이터: 객체에 대한 정보
  - 버전 ID: 버전 관리 시 사용

### 스토리지 클래스

#### 1. 표준 스토리지 클래스
- **S3 Standard**: 자주 액세스하는 데이터
- **S3 Intelligent-Tiering**: 액세스 패턴에 따라 자동 이동
- **S3 Standard-IA**: 자주 액세스하지 않는 데이터
- **S3 One Zone-IA**: 단일 AZ에 저장 (저렴하지만 덜 내구적)

#### 2. 아카이브 스토리지 클래스
- **S3 Glacier Instant Retrieval**: 즉시 검색 가능한 아카이브
- **S3 Glacier Flexible Retrieval**: 1-5분 또는 5-12시간 검색
- **S3 Glacier Deep Archive**: 가장 저렴, 12시간 검색

#### 3. 특수 목적
- **S3 Outposts**: 온프레미스에 S3 스토리지

## 주요 기능

### 1. 버전 관리 (Versioning)
- 객체의 모든 버전 유지
- 실수로 삭제한 객체 복원 가능
- MFA Delete로 추가 보안

### 2. 수명 주기 정책 (Lifecycle Policy)
- 객체를 자동으로 다른 스토리지 클래스로 이동
- 오래된 객체 자동 삭제
- 비용 최적화

### 3. Cross-Region Replication (CRR)
- 다른 리전으로 자동 복제
- 재해 복구 및 지연 시간 감소
- 버전 관리 활성화 필요

### 4. 이벤트 알림
- S3 이벤트 발생 시 알림
- Lambda, SQS, SNS로 전송
- 예: 객체 업로드 시 Lambda 실행

### 5. 정적 웹사이트 호스팅
- 버킷을 웹사이트로 사용
- HTML, CSS, JavaScript 호스팅
- CloudFront와 함께 사용

## 사용 사례

### 1. 데이터 레이크
- 대용량 데이터 저장
- 다양한 데이터 형식 지원
- 분석 도구와 통합

### 2. 백업 및 아카이브
- 정기적인 백업 저장
- 수명 주기 정책으로 자동 아카이브
- 장기 보관

### 3. 콘텐츠 배포
- 이미지, 비디오 등 미디어 파일
- CloudFront와 함께 CDN 구성
- 정적 웹사이트 호스팅

### 4. 애플리케이션 데이터
- 로그 파일 저장
- 사용자 생성 콘텐츠
- 설정 파일 저장

## 중요 개념

### 1. 일관성 모델 (Consistency Model)
S3는 분산 시스템이기 때문에 데이터 일관성에 특별한 특성이 있습니다.

**즉시 읽기 일관성 (Read-After-Write Consistency)**
- **새 객체 PUT**: 새 객체를 업로드하면 즉시 읽을 수 있음
- **예시**: 
  ```
  1. 사용자가 "photo.jpg" 업로드
  2. 즉시 "photo.jpg"를 읽을 수 있음 (일관성 보장)
  ```

**최종 일관성 (Eventual Consistency)**
- **객체 덮어쓰기 PUT**: 기존 객체를 덮어쓰면 일시적으로 이전 버전이 보일 수 있음
- **객체 삭제**: 삭제 후 일시적으로 객체가 보일 수 있음
- **예시**:
  ```
  1. 사용자가 "photo.jpg" 업로드 (버전 1)
  2. 사용자가 "photo.jpg"를 새 버전으로 덮어쓰기 (버전 2)
  3. 일시적으로 버전 1이 보일 수 있음
  4. 곧 버전 2만 보이게 됨 (최종 일관성 달성)
  ```

**왜 이런 일관성 모델인가?**
- S3는 전 세계에 분산된 데이터 센터에 데이터를 저장
- 고가용성과 성능을 위해 여러 위치에 복제
- 복제 완료 전에 읽기 요청이 발생할 수 있음
- 대부분의 경우 몇 초 내에 일관성 달성

**실제 영향**:
- 새 객체 업로드: 문제 없음 (즉시 읽기 가능)
- 객체 업데이트: 업데이트 직후 읽기 시 이전 버전이 보일 수 있음 (드물게 발생)
- 객체 삭제: 삭제 직후 읽기 시 객체가 보일 수 있음 (드물게 발생)

### 2. 스토리지 클래스 선택 가이드
각 스토리지 클래스는 특정 사용 패턴에 최적화되어 있습니다.

**선택 기준**:

1. **S3 Standard**
   - **사용 패턴**: 자주 액세스하는 데이터
   - **특징**: 
     - 가장 빠른 액세스 속도
     - 가장 높은 비용
     - 99.99% 가용성
     - 99.999999999% (11개 9) 내구성
   - **예시**: 
     - 웹사이트 이미지
     - 실시간 데이터 처리
     - 콘텐츠 배포

2. **S3 Intelligent-Tiering**
   - **사용 패턴**: 액세스 패턴을 예측하기 어려운 데이터
   - **특징**:
     - 자동으로 적절한 스토리지 클래스로 이동
     - 모니터링 비용 발생 (월 $0.0025/1,000 객체)
     - 액세스 패턴 분석 후 자동 최적화
   - **예시**:
     - 새로운 애플리케이션 (사용 패턴 불명확)
     - 액세스 패턴이 변하는 데이터

3. **S3 Standard-IA (Infrequent Access)**
   - **사용 패턴**: 가끔 액세스하지만 필요할 때 빠르게 접근해야 하는 데이터
   - **특징**:
     - Standard보다 저렴 (약 50% 절감)
     - 검색 비용 발생 (GB당 비용)
     - 최소 저장 기간: 30일
     - 최소 청구 크기: 128KB
   - **예시**:
     - 백업 데이터
     - 장기 저장이 필요한 데이터
     - 재해 복구 데이터

4. **S3 One Zone-IA**
   - **사용 패턴**: Standard-IA와 유사하지만 단일 AZ 장애를 감수할 수 있는 데이터
   - **특징**:
     - Standard-IA보다 약 20% 저렴
     - 단일 AZ에만 저장 (내구성 낮음)
     - 재생성 가능한 데이터에 적합
   - **예시**:
     - 재생성 가능한 백업
     - 중간 단계 데이터 변환 결과

5. **S3 Glacier Instant Retrieval**
   - **사용 패턴**: 아카이브 데이터이지만 즉시 접근이 필요한 경우
   - **특징**:
     - 즉시 검색 (밀리초 단위)
     - Standard-IA보다 저렴
     - 최소 저장 기간: 90일
   - **예시**:
     - 의료 이미지
     - 뉴스 미디어 아카이브

6. **S3 Glacier Flexible Retrieval**
   - **사용 패턴**: 아카이브 데이터, 검색 시간에 유연함
   - **특징**:
     - 검색 옵션:
       - Expedited: 1-5분
       - Standard: 3-5시간
       - Bulk: 5-12시간
     - 가장 저렴한 아카이브 옵션
     - 최소 저장 기간: 90일
   - **예시**:
     - 장기 백업
     - 규정 준수를 위한 아카이브

7. **S3 Glacier Deep Archive**
   - **사용 패턴**: 장기 보관, 거의 액세스하지 않는 데이터
   - **특징**:
     - 가장 저렴한 스토리지 클래스
     - 검색 시간: 12시간
     - 최소 저장 기간: 180일
   - **예시**:
     - 규정 준수 아카이브 (7년 이상 보관)
     - 디지털 보존

**비용 비교 예시** (GB당 월 비용, 리전별 다름):
```
Standard: $0.023
Standard-IA: $0.0125
Glacier Flexible Retrieval: $0.004
Glacier Deep Archive: $0.00099
```

### 3. 비용 최적화 전략
S3 비용을 최적화하는 여러 방법이 있습니다.

**수명 주기 정책 (Lifecycle Policy)**
- 객체를 자동으로 다른 스토리지 클래스로 이동
- 오래된 객체 자동 삭제
- 규칙 기반 자동화

**예시 정책**:
```
규칙 1: 객체 생성 후 30일
  → Standard → Standard-IA 이동

규칙 2: 객체 생성 후 90일
  → Standard-IA → Glacier 이동

규칙 3: 객체 생성 후 365일
  → Glacier → Glacier Deep Archive 이동

규칙 4: 객체 생성 후 2555일 (7년)
  → 삭제
```

**버전 관리 비용 최적화**
- 버전 관리 활성화 시 모든 버전이 저장됨
- 오래된 버전도 스토리지 비용 발생
- 수명 주기 정책으로 오래된 버전 자동 삭제

**예시**:
```
파일: "document.pdf"
- 버전 1 (1년 전): Glacier Deep Archive로 이동
- 버전 2 (6개월 전): Glacier로 이동
- 버전 3 (현재): Standard 유지
```

**적절한 스토리지 클래스 선택**
- 액세스 패턴 분석
- CloudWatch 지표 활용
- 비용 및 성능 균형

### 4. 보안 모범 사례
S3는 다양한 보안 기능을 제공합니다.

**액세스 제어**:
- **버킷 정책**: 버킷 레벨 액세스 제어
- **IAM 정책**: 사용자/역할 레벨 액세스 제어
- **ACL (Access Control List)**: 객체 레벨 액세스 제어 (레거시, 권장하지 않음)
- **퍼블릭 액세스 차단**: 실수로 퍼블릭 설정하는 것 방지

**버전 관리 + MFA Delete**:
- 실수로 삭제한 객체 복원 가능
- MFA Delete로 삭제 시 추가 인증 요구
- 중요한 데이터 보호

**암호화 옵션**:
- **SSE-S3**: AWS 관리형 키, 무료
- **SSE-KMS**: 고객 관리형 키, 키 사용 제어 가능
- **SSE-C**: 고객 제공 키, 키 관리 책임

**모니터링**:
- CloudTrail: 모든 API 호출 로깅
- S3 Access Logs: 객체 레벨 액세스 로깅
- CloudWatch: 지표 모니터링 및 알람

### 5. 성능 최적화
대용량 파일이나 전역 배포 시 성능 최적화가 중요합니다.

**멀티파트 업로드 (Multipart Upload)**
- **목적**: 대용량 파일(100MB 이상) 업로드 최적화
- **작동 원리**:
  ```
  1. 파일을 여러 부분으로 분할 (예: 5MB씩)
  2. 각 부분을 병렬로 업로드
  3. 모든 부분 업로드 완료 후 조립
  ```
- **장점**:
  - 업로드 실패 시 재시도 용이 (실패한 부분만 재업로드)
  - 병렬 업로드로 속도 향상
  - 대용량 파일 처리 가능

**Transfer Acceleration**
- **목적**: 전 세계에서 S3로 업로드 속도 향상
- **작동 원리**:
  ```
  1. 사용자 → 가장 가까운 엣지 로케이션 (CloudFront)
  2. 엣지 로케이션 → S3 버킷 (AWS 백본 네트워크)
  ```
- **장점**:
  - 지리적으로 멀리 떨어진 사용자도 빠른 업로드
  - AWS 백본 네트워크 활용 (최적화된 경로)
- **비용**: 추가 비용 발생

**CloudFront 통합**
- **목적**: 전 세계 사용자에게 빠른 콘텐츠 전송
- **작동 원리**:
  ```
  1. 사용자 요청 → 가장 가까운 엣지 로케이션
  2. 캐시 확인 → 있으면 즉시 반환, 없으면 S3에서 가져옴
  3. 다음 요청 시 캐시에서 즉시 반환
  ```
- **장점**:
  - 지연 시간 감소
  - S3 요청 비용 절감
  - 대역폭 비용 절감

## 모범 사례

1. **버킷 명명**
   - 전역적으로 고유한 이름
   - DNS 호환 이름
   - 소문자 및 하이픈만 사용

2. **버전 관리**
   - 프로덕션 버킷에 활성화
   - MFA Delete 설정
   - 오래된 버전 정리 (수명 주기 정책)

3. **암호화**
   - 기본 암호화 활성화
   - 중요한 데이터는 SSE-KMS 사용
   - 버킷 정책으로 암호화 강제

4. **액세스 제어**
   - 최소 권한 원칙
   - 버킷 정책 + IAM 정책 조합
   - 퍼블릭 액세스 차단 (필요 시만 허용)

5. **모니터링**
   - CloudTrail로 API 호출 로깅
   - S3 Access Logs 활성화
   - CloudWatch 지표 모니터링

## S3 수명 주기 정책 예시

```
1. 객체 생성 → Standard
2. 30일 후 → Standard-IA
3. 90일 후 → Glacier
4. 365일 후 → Glacier Deep Archive
5. 2555일 후 → 삭제
```

## 관련 서비스
- **CloudFront**: CDN (S3 오리진)
- **Lambda**: S3 이벤트 처리
- **Glacier**: 아카이브 스토리지
- **Athena**: S3 데이터 쿼리
- **Transfer Acceleration**: 전역 업로드 가속

## 참고 자료
- [S3 공식 문서](https://docs.aws.amazon.com/s3/)
- [S3 모범 사례](https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html)
- [S3 스토리지 클래스](https://aws.amazon.com/s3/storage-classes/)

