# 읽기 전용 복제본 (Read Replica)

## 개요
읽기 전용 복제본은 데이터베이스의 읽기 성능을 향상시키고 재해 복구를 지원하는 기능입니다. 원본 데이터베이스의 복사본을 생성하여 읽기 작업을 분산시킬 수 있습니다.

## 핵심 개념

### 읽기 전용 복제본이란?
**정의**: 원본 데이터베이스의 읽기 전용 복사본

**특징**:
- 원본 데이터베이스의 비동기 복제
- 읽기 작업만 수행 가능
- 쓰기 작업 불가
- 독립적으로 확장 가능

**작동 원리**:
```
원본 데이터베이스 (Primary)
  ↓ (비동기 복제)
읽기 전용 복제본 (Read Replica)
  ↓
읽기 요청 분산
```

### 왜 필요한가?

#### 1. 읽기 성능 향상
**문제**: 읽기 집약적 워크로드에서 원본 데이터베이스 부하

**해결**:
- 읽기 요청을 복제본으로 분산
- 원본 데이터베이스 부하 감소
- 전체 처리량 증가

#### 2. 지리적 분산
**문제**: 전 세계 사용자에게 빠른 응답 필요

**해결**:
- 사용자와 가까운 리전에 복제본 배치
- 지연 시간 감소

#### 3. 재해 복구
**문제**: 원본 데이터베이스 장애 시 복구 필요

**해결**:
- 복제본을 원본으로 승격
- 빠른 복구

## RDS 읽기 전용 복제본

### RDS 복제본 특징

#### 1. 비동기 복제
**정의**: 원본에서 복제본으로 데이터를 비동기적으로 복제

**특징**:
- 원본 쓰기 성능 영향 최소
- 복제 지연 발생 가능
- 최종 일관성

**복제 지연**:
- 일반적으로 수초 이내
- 네트워크 지연, 부하에 따라 다름
- CloudWatch에서 모니터링 가능

#### 2. 자동 백업
**특징**:
- 복제본도 자동 백업 가능
- 원본과 독립적인 백업 윈도우

#### 3. 독립적 확장
**특징**:
- 복제본은 원본과 다른 인스턴스 클래스 사용 가능
- 읽기 전용 복제본에 읽기 전용 복제본 생성 가능 (계단식 복제)

### 복제본 생성

#### 생성 방법
1. **콘솔에서 생성**
   - 원본 데이터베이스 선택
   - "Create read replica" 클릭
   - 설정 구성

2. **CLI/API로 생성**
   ```bash
   aws rds create-db-instance-read-replica \
     --db-instance-identifier my-replica \
     --source-db-instance-identifier my-primary
   ```

#### 설정 옵션
- **인스턴스 클래스**: 원본과 다를 수 있음
- **가용 영역**: 다른 AZ에 배치 권장
- **리전**: 다른 리전에 배치 가능 (크로스 리전 복제)
- **퍼블릭 액세스**: 필요 시 활성화

### 복제본 승격 (Promotion)

#### 승격이란?
**정의**: 읽기 전용 복제본을 독립적인 읽기/쓰기 데이터베이스로 변환

**사용 사례**:
- 재해 복구
- 리전 마이그레이션
- 독립적인 데이터베이스 필요

**과정**:
```
1. 복제본 승격 시작
2. 복제 중지
3. 읽기/쓰기 활성화
4. 독립적인 데이터베이스로 변환
```

**주의사항**:
- 승격 후 원본과의 복제 관계 종료
- 되돌릴 수 없음
- 승격 중 일시적 중단 가능

### 계단식 복제 (Cascading Replication)

**정의**: 읽기 전용 복제본에 다시 읽기 전용 복제본 생성

**구조**:
```
Primary
  ↓
Read Replica 1
  ↓
Read Replica 2 (Read Replica 1의 복제본)
```

**사용 사례**:
- 여러 리전에 복제본 배치
- 복제 지연 분산

**주의사항**:
- 복제 지연 누적
- 관리 복잡도 증가

## Aurora 읽기 전용 복제본

### Aurora 복제본 특징

#### 1. 자동 확장
**특징**:
- 최대 15개의 읽기 전용 복제본
- 빠른 복제본 추가 (분 단위)
- 자동 장애 조치

#### 2. 빠른 복제
**특징**:
- 스토리지 레벨 복제
- 낮은 복제 지연
- 높은 성능

#### 3. 자동 장애 조치
**특징**:
- 복제본이 자동으로 Primary로 승격
- 30초 이내 장애 조치
- 애플리케이션 변경 최소

### Aurora 복제본 vs RDS 복제본

| 항목 | RDS 복제본 | Aurora 복제본 |
|------|-----------|---------------|
| **복제본 수** | 최대 5개 | 최대 15개 |
| **복제 지연** | 수초 | 밀리초 |
| **장애 조치** | 수동 승격 | 자동 (30초) |
| **성능** | 인스턴스 레벨 | 스토리지 레벨 |
| **비용** | 인스턴스 비용 | 스토리지 공유 |

## 읽기 전용 복제본 사용 패턴

### 패턴 1: 읽기 분산
```
애플리케이션
  ├── 쓰기 → Primary
  ├── 읽기 → Read Replica 1
  ├── 읽기 → Read Replica 2
  └── 읽기 → Read Replica 3
```

**구현**:
- 애플리케이션에서 읽기/쓰기 분리
- 읽기 연결 풀: 복제본
- 쓰기 연결 풀: Primary

### 패턴 2: 리전별 복제본
```
Primary (서울)
  ├── Read Replica (도쿄)
  ├── Read Replica (싱가포르)
  └── Read Replica (버지니아)
```

**장점**:
- 지역별 사용자에게 빠른 응답
- 재해 복구

### 패턴 3: 보고서 생성
```
Primary (프로덕션)
  ↓
Read Replica (보고서 전용)
  ↓
보고서 생성 작업
```

**장점**:
- 프로덕션 부하 영향 없음
- 독립적인 리소스 사용

## 모범 사례

### 1. 복제본 배치
- 다른 가용 영역에 배치 (고가용성)
- 필요 시 다른 리전에 배치 (재해 복구)

### 2. 모니터링
- 복제 지연 모니터링
- 복제본 상태 확인
- 성능 지표 추적

### 3. 애플리케이션 설계
- 읽기/쓰기 분리
- 복제 지연 고려
- 최신 데이터 필요 시 Primary 사용

### 4. 비용 최적화
- 필요한 만큼만 복제본 생성
- 적절한 인스턴스 클래스 선택
- 사용하지 않는 복제본 제거

## 주의사항

### 1. 복제 지연
**문제**: 복제본이 원본보다 최신이 아닐 수 있음

**해결**:
- 최신 데이터 필요 시 Primary 사용
- 복제 지연 모니터링
- 애플리케이션에서 복제 지연 고려

### 2. 일관성
**문제**: 읽기 전용 복제본은 최종 일관성

**해결**:
- 강한 일관성 필요 시 Primary 사용
- 애플리케이션 로직에서 처리

### 3. 쓰기 불가
**문제**: 복제본에 쓰기 시도 시 오류

**해결**:
- 애플리케이션에서 읽기 전용 연결 사용
- 연결 문자열 분리

## 비용

### RDS 복제본
- 인스턴스 비용: 원본과 동일 또는 다를 수 있음
- 스토리지 비용: 별도 비용
- 데이터 전송: 크로스 리전 복제 시 비용

### Aurora 복제본
- 인스턴스 비용: 복제본 인스턴스 비용
- 스토리지: Primary와 공유 (추가 비용 없음)

## 관련 서비스

### RDS Proxy
- 연결 풀링
- 읽기/쓰기 분리
- 장애 조치

### Route 53
- DNS 기반 라우팅
- 리전별 복제본 라우팅

### CloudWatch
- 복제 지연 모니터링
- 성능 지표 수집

## 참고 자료
- [RDS 읽기 전용 복제본](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_ReadRepl.html)
- [Aurora 복제본](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/Aurora.Replication.html)

