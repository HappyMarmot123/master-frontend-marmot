# EBS (Elastic Block Store)

## 개요
Amazon EBS는 EC2 인스턴스에 사용할 영구 블록 스토리지 볼륨을 제공하는 서비스입니다. 데이터베이스, 파일 시스템, 애플리케이션 데이터를 저장하는 데 사용됩니다.

## 핵심 개념

### EBS란?
**정의**: EC2 인스턴스에 연결할 수 있는 영구 블록 스토리지

**특징**:
- 영구 스토리지 (인스턴스 종료 후에도 유지)
- EC2 인스턴스에 직접 연결
- 여러 인스턴스에 동시 연결 불가 (단일 인스턴스 전용)
- 스냅샷을 통한 백업 및 복제

**작동 원리**:
```
EC2 인스턴스
  ↓ (연결)
EBS 볼륨
  ↓ (마운트)
파일 시스템
```

### 블록 스토리지란?
**정의**: 데이터를 고정 크기의 블록 단위로 저장하는 스토리지

**특징**:
- 운영 체제가 블록 레벨에서 접근
- 파일 시스템 필요 (ext4, xfs 등)
- 낮은 지연 시간
- 높은 IOPS (Input/Output Operations Per Second)

**S3와의 차이**:
- **EBS**: 블록 스토리지, 파일 시스템 필요, 낮은 지연 시간
- **S3**: 객체 스토리지, HTTP API, 높은 지연 시간

## EBS 볼륨 유형

### SSD 기반 볼륨

#### 1. gp3 (General Purpose SSD)
**정의**: 범용 SSD 볼륨, 가장 비용 효율적

**특징**:
- **기본 IOPS**: 3,000 IOPS
- **최대 IOPS**: 16,000 IOPS (프로비저닝 가능)
- **기본 처리량**: 125 MB/s
- **최대 처리량**: 1,000 MB/s
- **지연 시간**: 1ms 미만
- **사용 사례**: 대부분의 워크로드

**비용**: 가장 저렴한 SSD 옵션

**예시**:
- 부트 볼륨
- 개발/테스트 환경
- 중소규모 데이터베이스
- 웹 서버

#### 2. gp2 (General Purpose SSD)
**정의**: 범용 SSD 볼륨 (레거시, gp3 권장)

**특징**:
- **IOPS**: 볼륨 크기에 비례 (3 IOPS/GB, 최대 16,000 IOPS)
- **버스트**: 3,000 IOPS까지 버스트 가능
- **처리량**: 250 MB/s
- **지연 시간**: 1ms 미만

**gp3 vs gp2**:
- **gp3**: 더 낮은 비용, 독립적인 IOPS/처리량 설정
- **gp2**: 볼륨 크기에 IOPS 종속

#### 3. io1/io2 (Provisioned IOPS SSD)
**정의**: 높은 성능이 필요한 워크로드를 위한 SSD 볼륨

**특징**:
- **IOPS**: 4 ~ 256,000 IOPS (프로비저닝)
- **처리량**: 최대 4,000 MB/s (io2 Block Express)
- **지연 시간**: 1ms 미만
- **일관성**: 99.8% ~ 99.9% IOPS 일관성

**io1 vs io2**:
- **io2**: 더 높은 내구성, 더 낮은 비용
- **io2 Block Express**: 최대 성능 (256,000 IOPS)

**사용 사례**:
- 대규모 데이터베이스
- I/O 집약적 애플리케이션
- 트랜잭션 처리 시스템
- 실시간 분석

**비용**: 가장 높음

### HDD 기반 볼륨

#### 1. st1 (Throughput Optimized HDD)
**정의**: 처리량 최적화 HDD 볼륨

**특징**:
- **IOPS**: 500 IOPS (기본), 500 IOPS (최대)
- **처리량**: 500 MB/s (기본), 500 MB/s (최대)
- **지연 시간**: 높음 (수십 ms)
- **사용 사례**: 빅 데이터, 데이터 웨어하우스, 로그 처리

**버스트**:
- 볼륨 크기에 따라 버스트 크레딧 축적
- 버스트 시 최대 500 MB/s 처리량

**예시**:
- Hadoop 클러스터
- Kafka 로그 스토리지
- ETL 작업

#### 2. sc1 (Cold HDD)
**정의**: 가장 저렴한 HDD 볼륨

**특징**:
- **IOPS**: 250 IOPS (기본), 250 IOPS (최대)
- **처리량**: 250 MB/s (기본), 250 MB/s (최대)
- **지연 시간**: 매우 높음
- **사용 사례**: 자주 액세스하지 않는 데이터, 아카이브

**비용**: 가장 저렴

**예시**:
- 로그 아카이브
- 백업 데이터
- 장기 저장 데이터

## 볼륨 유형 비교

### 성능 비교표

| 볼륨 유형 | IOPS | 처리량 | 지연 시간 | 비용 |
|-----------|------|--------|-----------|------|
| **gp3** | 3,000-16,000 | 125-1,000 MB/s | <1ms | 낮음 |
| **gp2** | 3-16,000 | 250 MB/s | <1ms | 중간 |
| **io1/io2** | 4-256,000 | 최대 4,000 MB/s | <1ms | 높음 |
| **st1** | 500 | 500 MB/s | 높음 | 낮음 |
| **sc1** | 250 | 250 MB/s | 매우 높음 | 매우 낮음 |

### 선택 기준

#### SSD 선택 시
**성능이 중요한 경우**:
- 데이터베이스
- 트랜잭션 처리
- 실시간 애플리케이션

**볼륨 유형 선택**:
- **일반 워크로드**: gp3
- **높은 IOPS 필요**: io1/io2
- **비용 최적화**: gp3

#### HDD 선택 시
**처리량이 중요한 경우**:
- 빅 데이터 처리
- 로그 분석
- 순차 읽기/쓰기

**볼륨 유형 선택**:
- **처리량 최적화**: st1
- **아카이브**: sc1

## EBS 주요 기능

### 1. 스냅샷 (Snapshot)
**정의**: 특정 시점의 볼륨 백업

**특징**:
- 증분 백업 (변경된 블록만 저장)
- 다른 리전으로 복사 가능
- 다른 AZ에 볼륨 생성 가능
- AMI 생성 가능

**작동 원리**:
```
볼륨 (100GB)
  ├── 첫 스냅샷: 100GB 저장
  ├── 두 번째 스냅샷: 변경된 블록만 저장 (예: 10GB)
  └── 세 번째 스냅샷: 변경된 블록만 저장 (예: 5GB)
```

**사용 사례**:
- 정기 백업
- 볼륨 복제
- 다른 리전으로 마이그레이션
- AMI 생성

### 2. 암호화
**정의**: 볼륨 데이터 암호화

**특징**:
- 기본 암호화 활성화 가능
- KMS를 사용한 키 관리
- 스냅샷도 자동 암호화
- 성능 영향 없음

**암호화 옵션**:
- **기본 암호화**: AWS 관리형 키
- **고객 관리형 키**: KMS CMK

### 3. 멀티 어태치 (Multi-Attach)
**정의**: io1/io2 볼륨을 여러 인스턴스에 동시 연결

**특징**:
- 최대 16개 인스턴스에 연결
- 클러스터 파일 시스템 필요
- 고가용성 애플리케이션

**사용 사례**:
- Oracle RAC
- Windows Failover Cluster
- 고가용성 데이터베이스

### 4. EBS 최적화 인스턴스
**정의**: EBS I/O 성능을 최적화한 EC2 인스턴스

**특징**:
- 전용 네트워크 대역폭
- 일관된 성능
- 추가 비용 없음

**최적화 인스턴스 유형**:
- 대부분의 최신 인스턴스 유형
- C, M, R 시리즈 등

## 성능 최적화

### 1. IOPS 최적화
**방법**:
- 적절한 볼륨 유형 선택 (io1/io2)
- 프로비저닝된 IOPS 설정
- EBS 최적화 인스턴스 사용
- 여러 볼륨 스트라이핑 (RAID 0)

**스트라이핑 예시**:
```
4개의 io1 볼륨 (각 10,000 IOPS)
  ↓ (RAID 0)
총 40,000 IOPS
```

### 2. 처리량 최적화
**방법**:
- 적절한 볼륨 유형 선택 (st1, gp3)
- 처리량 프로비저닝 (gp3)
- 여러 볼륨 스트라이핑

### 3. 지연 시간 최적화
**방법**:
- SSD 볼륨 사용 (gp3, io1/io2)
- EBS 최적화 인스턴스 사용
- 인스턴스와 볼륨을 같은 AZ에 배치

## 사용 사례

### 시나리오 1: 데이터베이스
```
RDS 또는 EC2 데이터베이스
  ↓
io1/io2 볼륨 (높은 IOPS)
  ├── 데이터 파일
  └── 로그 파일
```

### 시나리오 2: 웹 서버
```
EC2 웹 서버
  ↓
gp3 볼륨 (범용)
  ├── 애플리케이션 파일
  └── 로그 파일
```

### 시나리오 3: 빅 데이터
```
EMR 클러스터
  ↓
st1 볼륨 (처리량 최적화)
  └── 데이터 저장
```

## 모범 사례

### 1. 볼륨 유형 선택
- 워크로드 특성에 맞는 유형 선택
- 비용과 성능 균형
- 필요 시 업그레이드

### 2. 스냅샷 관리
- 정기적인 스냅샷 생성
- 자동화된 스냅샷 정책
- 다른 리전에 복사

### 3. 암호화
- 모든 볼륨 암호화
- 중요한 데이터는 CMK 사용

### 4. 모니터링
- CloudWatch 지표 모니터링
- IOPS, 처리량, 지연 시간 추적
- 알람 설정

## 비용

### 볼륨 비용 (GB당 월 비용, 예시)
- **gp3**: $0.08
- **gp2**: $0.10
- **io1**: $0.125 + IOPS 비용
- **io2**: $0.125 + IOPS 비용
- **st1**: $0.045
- **sc1**: $0.015

### IOPS 비용 (io1/io2)
- **io1**: 프로비저닝된 IOPS당 $0.10/월
- **io2**: 프로비저닝된 IOPS당 $0.10/월

### 스냅샷 비용
- GB당 $0.05/월
- 증분 백업이므로 실제 비용은 낮음

## 관련 서비스

### EC2
- EBS 볼륨 연결
- 인스턴스 스토어와 비교

### RDS
- EBS를 백엔드 스토리지로 사용
- 자동 백업 및 스냅샷

### EMR
- st1 볼륨 사용
- 빅 데이터 처리

## 참고 자료
- [EBS 공식 문서](https://docs.aws.amazon.com/ebs/)
- [EBS 볼륨 유형](https://docs.aws.amazon.com/ebs/latest/userguide/ebs-volume-types.html)

